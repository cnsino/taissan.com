<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘åäºŒ æ–‡ä»¶ç³»ç»Ÿ</title>
      <link href="/news/1682515447413.html"/>
      <url>/news/1682515447413.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ–‡ä»¶è¯»å†™">1. æ–‡ä»¶è¯»å†™</h2><h3 id="1-1-è¯»å–æ–‡ä»¶çš„å­—ç¬¦ä¸²è¡Œ">1.1 è¯»å–æ–‡ä»¶çš„å­—ç¬¦ä¸²è¡Œ</h3><p>â€ƒâ€ƒå‘æ–‡ä»¶å†™å…¥ä¸‰è¡Œä¿¡æ¯ï¼Œç„¶åä½¿ç”¨ <code>BufRead::lines</code> åˆ›å»ºçš„è¿­ä»£å™¨ <code>Lines</code> è¯»å–æ–‡ä»¶ï¼Œä¸€æ¬¡è¯»å›ä¸€è¡Œã€‚<code>File</code> æ¨¡å—å®ç°äº†æä¾› <code>BufReader</code> ç»“æ„ä½“çš„ <code>Read</code> traitã€‚<code>File::create</code> æ‰“å¼€æ–‡ä»¶ File è¿›è¡Œå†™å…¥ï¼Œ<code>File::open</code> åˆ™è¿›è¡Œè¯»å–ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BufRead</span><span class="token punctuation">,</span> <span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"lines.txt"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> output <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">write!</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"Rust\nğŸ’–\nå‘µå‘µ"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> buffered <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> line <span class="token keyword">in</span> buffered<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> line<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">RustğŸ’–å‘µå‘µ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-2-é¿å…è¯»å–å†™å…¥åŒä¸€æ–‡ä»¶">1.2 é¿å…è¯»å–å†™å…¥åŒä¸€æ–‡ä»¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>same-file</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add same-file</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">same-file</span> <span class="token punctuation">=</span> <span class="token string">"1.0.6"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå¯¹æ–‡ä»¶ä½¿ç”¨ <code>same_file::Handle</code> ç»“æ„ä½“ï¼Œå¯ä»¥æµ‹è¯•æ–‡ä»¶å¥æŸ„æ˜¯å¦ç­‰åŒã€‚åœ¨æœ¬å®ä¾‹ä¸­ï¼Œå°†å¯¹è¦è¯»å–å’Œå†™å…¥çš„æ–‡ä»¶å¥æŸ„è¿›è¡Œç›¸ç­‰æ€§æµ‹è¯•ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">same_file<span class="token punctuation">::</span></span><span class="token class-name">Handle</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BufRead</span><span class="token punctuation">,</span> <span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">ErrorKind</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> path_to_read <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"new.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> stdout_handle <span class="token operator">=</span> <span class="token class-name">Handle</span><span class="token punctuation">::</span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> handle <span class="token operator">=</span> <span class="token class-name">Handle</span><span class="token punctuation">::</span><span class="token function">from_path</span><span class="token punctuation">(</span>path_to_read<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> stdout_handle <span class="token operator">==</span> handle <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">Error</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">Other</span><span class="token punctuation">,</span> <span class="token string">"æ‚¨æ­£åœ¨è¯»å–å’Œå†™å…¥åŒä¸€ä¸ªæ–‡ä»¶"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>path_to_read<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span>num<span class="token punctuation">,</span> line<span class="token punctuation">)</span> <span class="token keyword">in</span> file<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; : &#123;&#125;"</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> line<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">to_uppercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>è¿è¡Œ<code>cargo run</code>è¾“å‡ºæ˜¾ç¤ºæ–‡ä»¶ <code>new.txt</code> çš„å†…å®¹ã€‚</p></li><li><p>è¿è¡Œ<code>cargo run &gt;&gt; ./new.txt</code>æŠ¥é”™ï¼Œå› ä¸ºæ˜¯åŒä¸€æ–‡ä»¶ã€‚è¾“å‡º</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error: Custom <span class="token punctuation">&#123;</span> kind: Other, error: <span class="token string">"æ‚¨æ­£åœ¨è¯»å–å’Œå†™å…¥åŒä¸€ä¸ªæ–‡ä»¶"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-3-ä½¿ç”¨å†…å­˜æ˜ å°„éšæœºè®¿é—®æ–‡ä»¶">1.3 ä½¿ç”¨å†…å­˜æ˜ å°„éšæœºè®¿é—®æ–‡ä»¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>memmap</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add memmap</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">memmap</span> <span class="token punctuation">=</span> <span class="token string">"0.7.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>memmap</code> åˆ›å»ºæ–‡ä»¶çš„å†…å­˜æ˜ å°„ï¼Œå¹¶æ¨¡æ‹Ÿæ–‡ä»¶çš„ä¸€äº›éåºåˆ—è¯»å–ã€‚ä½¿ç”¨å†…å­˜æ˜ å°„æ„å‘³ç€æ‚¨ä»…éœ€ç´¢å¼•ä¸€ä¸ªåˆ‡ç‰‡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ <code>seek</code> æ–¹æ³•æ¥å¯¼èˆªæ•´ä¸ªæ–‡ä»¶ã€‚<code>Mmap::map</code> å‡½æ•°å‡å®šå†…å­˜æ˜ å°„åçš„æ–‡ä»¶æ²¡æœ‰è¢«å¦ä¸€ä¸ªè¿›ç¨‹åŒæ—¶æ›´æ”¹ï¼Œå¦åˆ™ä¼šå‡ºç°ç«æ€æ¡ä»¶ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">memmap<span class="token punctuation">::</span></span><span class="token class-name">Mmap</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Write</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token macro property">write!</span><span class="token punctuation">(</span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"content.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token string">"My hovercraft is full of eels!"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"content.txt"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span> <span class="token class-name">Mmap</span><span class="token punctuation">::</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>file<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> random_indexes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>map<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">..</span><span class="token number">13</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">b"hovercraft"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> random_bytes<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token operator">=</span> random_indexes<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>idx<span class="token closure-punctuation punctuation">|</span></span> map<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>random_bytes<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">b"My loaf!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h2 id="2-ç›®å½•éå†">2 ç›®å½•éå†</h2><h3 id="2-1-è¿‡å»-24-å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶å">2.1 è¿‡å» 24 å°æ—¶å†…ä¿®æ”¹è¿‡çš„æ–‡ä»¶å</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>error_chain</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add error_chain</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒé€šè¿‡è°ƒç”¨ <code>env::current_dir</code> è·å–å½“å‰å·¥ä½œç›®å½•ï¼Œç„¶åé€šè¿‡ <code>fs::read_dir</code> è¯»å–ç›®å½•ä¸­çš„æ¯ä¸ªæ¡ç›®ï¼Œé€šè¿‡ <code>DirEntry::path</code> æå–æ¡ç›®è·¯å¾„ï¼Œä»¥åŠé€šè¿‡é€šè¿‡ <code>fs::Metadata</code> è·å–æ¡ç›®å…ƒæ•°æ®ã€‚<code>Metadata::modified</code> è¿”å›æ¡ç›®è‡ªä¸Šæ¬¡æ›´æ”¹ä»¥æ¥çš„è¿è¡Œæ—¶é—´ <code>SystemTime::elapsedã€‚Duration::as_secs</code> å°†æ—¶é—´è½¬æ¢ä¸ºç§’ï¼Œå¹¶ä¸ 24 å°æ—¶ï¼ˆ24 <em>60</em> 60 ç§’ï¼‰è¿›è¡Œæ¯”è¾ƒã€‚<code>Metadata::is_file</code> ç”¨äºç­›é€‰å‡ºç›®å½•ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>env<span class="token punctuation">,</span> fs<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SystemTimeError</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">SystemTimeError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> current_dir <span class="token operator">=</span> <span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">current_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"åœ¨è¿‡å» 24 å°æ—¶å†…ä¿®æ”¹çš„æ¡ç›®&#123;:?&#125;:"</span><span class="token punctuation">,</span> current_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">read_dir</span><span class="token punctuation">(</span>current_dir<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> entry <span class="token operator">=</span> entry<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> path <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> metadata <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> last_modified <span class="token operator">=</span> metadata<span class="token punctuation">.</span><span class="token function">modified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">as_secs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> last_modified <span class="token operator">&lt;</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">3600</span> <span class="token operator">&amp;&amp;</span> metadata<span class="token punctuation">.</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span>                <span class="token string">"æœ€åä¿®æ”¹ï¼š&#123;:?&#125; ç§’ï¼Œåªè¯»ï¼š&#123;:?&#125;ï¼Œå¤§å°ï¼š&#123;:?&#125; å­—èŠ‚ï¼Œæ–‡ä»¶åï¼š&#123;:?&#125;"</span><span class="token punctuation">,</span>                last_modified<span class="token punctuation">,</span>                metadata<span class="token punctuation">.</span><span class="token function">permissions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readonly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                metadata<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                path<span class="token punctuation">.</span><span class="token function">file_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰æ–‡ä»¶å"</span><span class="token punctuation">)</span><span class="token operator">?</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">åœ¨è¿‡å» <span class="token number">24</span> å°æ—¶å†…ä¿®æ”¹çš„æ¡ç›®<span class="token string">"/root/rustcookbook/filetest"</span><span class="token builtin class-name">:</span>æœ€åä¿®æ”¹ï¼š118 ç§’ï¼Œåªè¯»ï¼šfalseï¼Œå¤§å°ï¼š237 å­—èŠ‚ï¼Œæ–‡ä»¶åï¼š<span class="token string">"Cargo.toml"</span>æœ€åä¿®æ”¹ï¼š107 ç§’ï¼Œåªè¯»ï¼šfalseï¼Œå¤§å°ï¼š4336 å­—èŠ‚ï¼Œæ–‡ä»¶åï¼š<span class="token string">"Cargo.lock"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-2-æŸ¥æ‰¾ç»™å®šè·¯å¾„çš„å¾ªç¯">2.2 æŸ¥æ‰¾ç»™å®šè·¯å¾„çš„å¾ªç¯</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>same_file::is_same_file</code> æ£€æµ‹ç»™å®šè·¯å¾„çš„å¾ªç¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡è½¯è¿æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰åœ¨ <code>Unix</code> ç³»ç»Ÿä¸Šåˆ›å»ºå¾ªç¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /tmp/foo/bar/baz<span class="token function">ln</span> <span class="token parameter variable">-s</span> /tmp/foo/  /tmp/foo/bar/baz/qux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>ä¸‹é¢çš„å®ä¾‹å°†æ–­è¨€å­˜åœ¨ä¸€ä¸ªå¾ªç¯ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">same_file<span class="token punctuation">::</span></span>is_same_file<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Path</span><span class="token punctuation">,</span> <span class="token class-name">PathBuf</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">contains_loop</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">AsRef</span><span class="token operator">&lt;</span><span class="token class-name">Path</span><span class="token operator">>></span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">PathBuf</span><span class="token punctuation">,</span> <span class="token class-name">PathBuf</span><span class="token punctuation">)</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> path_buf <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">to_path_buf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> path_buf<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token function">is_same_file</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>path_buf<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>path_buf<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">to_path_buf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>looped_paths<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">contains_loop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>path_buf<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>looped_paths<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        <span class="token function">contains_loop</span><span class="token punctuation">(</span><span class="token string">"/tmp/foo/bar/baz/qux/bar/baz"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>            <span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"/tmp/foo"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"/tmp/foo/bar/baz/qux"</span><span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="2-3-é€’å½’æŸ¥æ‰¾é‡åæ–‡ä»¶">2.3 é€’å½’æŸ¥æ‰¾é‡åæ–‡ä»¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>walkdir</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add walkdir</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">walkdir</span> <span class="token punctuation">=</span> <span class="token string">"2.3.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒåœ¨å½“å‰ç›®å½•ä¸­é€’å½’æŸ¥æ‰¾é‡å¤çš„æ–‡ä»¶åï¼Œåªæ‰“å°ä¸€æ¬¡ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token class-name">WalkDir</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> filenames <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token class-name">WalkDir</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token punctuation">::</span>ok<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">file_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> f_name <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">file_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> counter <span class="token operator">=</span> filenames<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span>f_name<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span>counter <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token operator">*</span>counter <span class="token operator">==</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> f_name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º(åŸºæœ¬ä¸Šæ˜¯<code>target</code>ç›®å½•ä¸‹çš„æ–‡ä»¶)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">invoked.timestamproot-outputoutputstderr<span class="token punctuation">..</span>.dep-lib-adler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-ä½¿ç”¨ç»™å®šæ–­è¨€é€’å½’æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶">2.4 ä½¿ç”¨ç»™å®šæ–­è¨€é€’å½’æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶</h3><p>â€ƒâ€ƒåœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾æœ€è¿‘ä¸€å¤©å†…ä¿®æ”¹çš„ <code>JSON</code> æ–‡ä»¶ã€‚ä½¿ç”¨ <code>follow_links</code> ç¡®ä¿è½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰åƒæ™®é€šç›®å½•å’Œæ–‡ä»¶ä¸€æ ·è¢«æŒ‰ç…§å½“å‰æŸ¥æ‰¾è§„åˆ™æ‰§è¡Œã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token class-name">WalkDir</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">WalkDir</span><span class="token punctuation">(</span><span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SystemTime</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">SystemTimeError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token class-name">WalkDir</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">follow_links</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> e<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> f_name <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">file_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> sec <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">modified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> f_name<span class="token punctuation">.</span><span class="token function">ends_with</span><span class="token punctuation">(</span><span class="token string">".json"</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> sec<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">as_secs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">86400</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> f_name<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º(åŸºæœ¬ä¸Šæ˜¯<code>target</code>ç›®å½•ä¸‹çš„æ–‡ä»¶)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.rustc_info.jsonlib-gimli.json<span class="token punctuation">..</span>.lib-adler.jsonbin-filetest.json<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-5-è·³è¿‡éšè—æ–‡ä»¶éå†ç›®å½•">2.5 è·³è¿‡éšè—æ–‡ä»¶éå†ç›®å½•</h3><p>â€ƒâ€ƒé€’å½’ä¸‹è¡Œåˆ°å­ç›®å½•çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ <code>filter_entry</code> å¯¹ç›®å½•ä¸­çš„æ¡ç›®ä¼ é€’ <code>is_not_hidden</code> æ–­è¨€ï¼Œä»è€Œè·³è¿‡éšè—çš„æ–‡ä»¶å’Œç›®å½•ã€‚<code>Iterator::filter</code> å¯åº”ç”¨åˆ°è¦æ£€ç´¢çš„ä»»ä½•ç›®å½• <code>WalkDir::DirEntry</code>ï¼Œå³ä½¿çˆ¶ç›®å½•æ˜¯éšè—ç›®å½•ã€‚æ ¹ç›®å½• â€œ.â€ çš„æ£€ç´¢ç»“æœï¼Œé€šè¿‡åœ¨æ–­è¨€ <code>is_not_hidden</code> ä¸­ä½¿ç”¨ <code>WalkDir::depth</code> å‚æ•°ç”Ÿæˆã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">DirEntry</span><span class="token punctuation">,</span> <span class="token class-name">WalkDir</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">is_not_hidden</span><span class="token punctuation">(</span>entry<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DirEntry</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>    entry        <span class="token punctuation">.</span><span class="token function">file_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">to_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> entry<span class="token punctuation">.</span><span class="token function">depth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span>s<span class="token punctuation">.</span><span class="token function">starts_with</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">WalkDir</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_entry</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">is_not_hidden</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>v<span class="token closure-punctuation punctuation">|</span></span> v<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º(åŸºæœ¬ä¸Šæ˜¯<code>target</code>ç›®å½•ä¸‹çš„æ–‡ä»¶)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./Cargo.toml./src./src/main.rs./target./target/debug./target/debug/build<span class="token punctuation">..</span>../Cargo.lock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-6-åœ¨ç»™å®šæ·±åº¦çš„ç›®å½•ï¼Œé€’å½’è®¡ç®—æ–‡ä»¶å¤§å°">2.6 åœ¨ç»™å®šæ·±åº¦çš„ç›®å½•ï¼Œé€’å½’è®¡ç®—æ–‡ä»¶å¤§å°</h3><p>â€ƒâ€ƒé€šè¿‡<code>WalkDir::min_depth</code> å’Œ <code>WalkDir::max_depth</code> æ–¹æ³•ï¼Œå¯ä»¥çµæ´»è®¾ç½®ç›®å½•çš„é€’å½’æ·±åº¦ã€‚ä¸‹é¢çš„å®ä¾‹è®¡ç®—äº† 3 å±‚å­æ–‡ä»¶å¤¹æ·±åº¦çš„æ‰€æœ‰æ–‡ä»¶çš„å¤§å°æ€»å’Œï¼Œè®¡ç®—ä¸­å¿½ç•¥æ ¹æ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token class-name">WalkDir</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> total_size <span class="token operator">=</span> <span class="token class-name">WalkDir</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">min_depth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">max_depth</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>entry<span class="token closure-punctuation punctuation">|</span></span> entry<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>entry<span class="token closure-punctuation punctuation">|</span></span> entry<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>metadata<span class="token closure-punctuation punctuation">|</span></span> metadata<span class="token punctuation">.</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> m<span class="token closure-punctuation punctuation">|</span></span> acc <span class="token operator">+</span> m<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ€»å¤§å°: &#123;&#125; bytes."</span><span class="token punctuation">,</span> total_size<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ€»å¤§å°: <span class="token number">5247240</span> bytes.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-7-é€’å½’æŸ¥æ‰¾æ‰€æœ‰-png-æ–‡ä»¶">2.7 é€’å½’æŸ¥æ‰¾æ‰€æœ‰ <code>png</code> æ–‡ä»¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>glob&quot;</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add glob</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">glob</span> <span class="token punctuation">=</span> <span class="token string">"0.3.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒé€’å½’åœ°æŸ¥æ‰¾å½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰ <code>PNG</code> æ–‡ä»¶ã€‚åœ¨æœ¬å®ä¾‹ä¸­ï¼Œ<code>**</code> æ¨¡å¼ç”¨äºåŒ¹é…å½“å‰ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚åœ¨è·¯å¾„ä»»æ„éƒ¨åˆ†ä½¿ç”¨ <code>**</code> æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œ<code>/media/**/*.png</code> åŒ¹é… <code>media</code> åŠå…¶å­ç›®å½•ä¸­çš„æ‰€æœ‰ <code>PNG</code> æ–‡ä»¶ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">glob<span class="token punctuation">::</span></span>glob<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Glob</span><span class="token punctuation">(</span><span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token class-name">GlobError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Pattern</span><span class="token punctuation">(</span><span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token class-name">PatternError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">"**/*.png"</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> entry<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">src/test.pngtest.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-8-å¿½ç•¥æ–‡ä»¶åå¤§å°å†™ï¼Œä½¿ç”¨ç»™å®šæ¨¡å¼æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶">2.8 å¿½ç•¥æ–‡ä»¶åå¤§å°å†™ï¼Œä½¿ç”¨ç»™å®šæ¨¡å¼æŸ¥æ‰¾æ‰€æœ‰æ–‡ä»¶</h3><p>â€ƒâ€ƒåœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ä¸æ­£åˆ™è¡¨è¾¾æ¨¡å¼ <code>img_[0-9]*.png</code> åŒ¹é…çš„æ‰€æœ‰å›¾åƒæ–‡ä»¶ã€‚ä¸€ä¸ªè‡ªå®šä¹‰ <code>MatchOptions</code> ç»“æ„ä½“è¢«ä¼ é€’ç»™ <code>glob_with</code> å‡½æ•°ï¼Œä½¿å…¨å±€å‘½ä»¤æ¨¡å¼ä¸‹ä¸åŒºåˆ†å¤§å°å†™ï¼ŒåŒæ—¶ä¿æŒå…¶ä»–é€‰é¡¹çš„é»˜è®¤å€¼ <code>Default</code>ï¼Œæ³¨ï¼šåŸæ•™ç¨‹æŸ¥çœ‹<code>/media/</code>ç›®å½•ä¸‹çš„å›¾ç‰‡ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>glob_with<span class="token punctuation">,</span> <span class="token class-name">MatchOptions</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Glob</span><span class="token punctuation">(</span><span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token class-name">GlobError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Pattern</span><span class="token punctuation">(</span><span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token class-name">PatternError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token class-name">MatchOptions</span> <span class="token punctuation">&#123;</span>        case_sensitive<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        <span class="token punctuation">..</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token function">glob_with</span><span class="token punctuation">(</span><span class="token string">"./**/img_[0-9]*.png"</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> entry<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">img_0.pngsrc/img_9.png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘åä¸€ é”™è¯¯å¤„ç†</title>
      <link href="/news/1682254869915.html"/>
      <url>/news/1682254869915.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å¤„ç†é”™è¯¯å˜é‡">1. å¤„ç†é”™è¯¯å˜é‡</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>error-chain</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add error-chain</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-1-åœ¨-main-æ–¹æ³•ä¸­å¯¹é”™è¯¯é€‚å½“å¤„ç†">1.1 åœ¨ <code>main</code> æ–¹æ³•ä¸­å¯¹é”™è¯¯é€‚å½“å¤„ç†</h3><p>â€ƒâ€ƒå¤„ç†å°è¯•æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶å‘ç”Ÿçš„é”™è¯¯ï¼Œæ˜¯é€šè¿‡ä½¿ç”¨ <code>error-chain</code> crate æ¥å®ç°çš„ã€‚<code>error-chain</code> crate åŒ…å«å¤§é‡çš„æ¨¡æ¿ä»£ç ï¼Œç”¨äº Rust ä¸­çš„é”™è¯¯å¤„ç†ã€‚<code>foreign_links</code> ä»£ç å—å†…çš„ <code>Io(std::io::Error)</code> å‡½æ•°å…è®¸ç”± <code>std::io::Error</code> æ‰€æŠ¥é”™è¯¯ä¿¡æ¯åˆ° <code>error_chain!</code> æ‰€å®šä¹‰é”™è¯¯ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ï¼Œ<code>error_chain!</code> æ‰€å®šä¹‰é”™è¯¯ç±»å‹å°†å®ç° <code>Error</code> traitã€‚ä¸‹æ–‡çš„å®ä¾‹å°†é€šè¿‡æ‰“å¼€ Unix æ–‡ä»¶ <code>/proc/uptime</code> å¹¶è§£æå†…å®¹ä»¥è·å¾—å…¶ä¸­ç¬¬ä¸€ä¸ªæ•°å­—ï¼Œä»è€Œå‘Šè¯‰ç³»ç»Ÿè¿è¡Œäº†å¤šé•¿æ—¶é—´ã€‚é™¤éå‡ºç°é”™è¯¯ï¼Œå¦åˆ™è¿”å›æ­£å¸¸è¿è¡Œæ—¶é—´ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Read</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ParseInt</span><span class="token punctuation">(</span><span class="token punctuation">::</span><span class="token namespace">std<span class="token punctuation">::</span>num<span class="token punctuation">::</span></span><span class="token class-name">ParseIntError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">read_uptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> uptime <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/proc/uptime"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> uptime<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>uptime        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"æ— æ³•è§£ææ­£å¸¸è¿è¡Œæ—¶é—´æ•°æ®"</span><span class="token punctuation">)</span><span class="token operator">?</span>        <span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> <span class="token function">read_uptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>uptime<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ­£å¸¸è¿è¡Œæ—¶é—´: &#123;&#125; ç§’"</span><span class="token punctuation">,</span> uptime<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"é”™è¯¯: &#123;&#125;"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ­£å¸¸è¿è¡Œæ—¶é—´: <span class="token number">3204645</span> ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-é¿å…åœ¨é”™è¯¯è½¬å˜è¿‡ç¨‹ä¸­é—æ¼é”™è¯¯">1.2 é¿å…åœ¨é”™è¯¯è½¬å˜è¿‡ç¨‹ä¸­é—æ¼é”™è¯¯</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>reqwest</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add reqwest --features blocking</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">reqwest</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.11.16"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"blocking"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒ<code>error-chain</code> crate ä½¿å¾—åŒ¹é…å‡½æ•°è¿”å›çš„ä¸åŒé”™è¯¯ç±»å‹æˆä¸ºå¯èƒ½ï¼Œå¹¶ä¸”ç›¸å¯¹ç®€æ´ã€‚<code>ErrorKind</code> æ˜¯æšä¸¾ç±»å‹ï¼Œå¯ä»¥ç¡®å®šé”™è¯¯ç±»å‹ã€‚ä¸‹æ–‡å®ä¾‹ä½¿ç”¨ <code>reqwest::blocking</code> æ¥æŸ¥è¯¢ä¸€ä¸ªéšæœºæ•´æ•°ç”Ÿæˆå™¨çš„ web æœåŠ¡ï¼Œå¹¶å°†æœåŠ¡å™¨å“åº”çš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ã€‚Rust æ ‡å‡†åº“ <code>reqwest</code> å’Œ web æœåŠ¡éƒ½å¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥ä½¿ç”¨ <code>foreign_links</code> å®šä¹‰æ˜“äºè¾¨è®¤ç†è§£çš„ Rust é”™è¯¯ã€‚å¦å¤–ï¼Œç”¨äº web æœåŠ¡é”™è¯¯ä¿¡æ¯çš„ <code>ErrorKind</code> å˜é‡ï¼Œä½¿ç”¨ <code>error_chain!</code> å®çš„ <code>errors</code> ä»£ç å—å®šä¹‰ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Reqwest</span><span class="token punctuation">(</span><span class="token namespace">reqwest<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ParseIntError</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>num<span class="token punctuation">::</span></span><span class="token class-name">ParseIntError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    errors <span class="token punctuation">&#123;</span> <span class="token class-name">RandomResponseError</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">parse_response</span><span class="token punctuation">(</span>response<span class="token punctuation">:</span> <span class="token namespace">reqwest<span class="token punctuation">::</span>blocking<span class="token punctuation">::</span></span><span class="token class-name">Response</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> body <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    body<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    body<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">chain_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">RandomResponseError</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> url <span class="token operator">=</span>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"https://www.random.org/integers/?num=1&amp;min=0&amp;max=10&amp;col=1&amp;base=10&amp;format=plain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token namespace">reqwest<span class="token punctuation">::</span>blocking<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>url<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> random_value<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> <span class="token function">parse_response</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"0 åˆ° 10 ä¹‹é—´çš„éšæœºæ•°: &#123;&#125;"</span><span class="token punctuation">,</span> random_value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">match</span> <span class="token operator">*</span>error<span class="token punctuation">.</span><span class="token function">kind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">Io</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ ‡å‡† IO é”™è¯¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">Reqwest</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"reqwest è¯·æ±‚é”™è¯¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">ParseIntError</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ ‡å‡†è§£æ int é”™è¯¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">ErrorKind</span><span class="token punctuation">::</span><span class="token class-name">RandomResponseError</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å®šä¹‰é”™è¯¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>            _ <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å…¶ä»–é”™è¯¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">0</span> åˆ° <span class="token number">10</span> ä¹‹é—´çš„éšæœºæ•°: <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-3-è·å–å¤æ‚é”™è¯¯åœºæ™¯çš„å›æº¯">1.3 è·å–å¤æ‚é”™è¯¯åœºæ™¯çš„å›æº¯</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>csv</code>å’Œ<code>serde</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add csv</code>å’Œ<code>cargo add serde --features derive</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">csv</span> <span class="token punctuation">=</span> <span class="token string">"1.2.1"</span><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.160"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒæœ¬å®ä¾‹å±•ç¤ºäº†å¦‚ä½•å¤„ç†ä¸€ä¸ªå¤æ‚çš„é”™è¯¯åœºæ™¯ï¼Œå¹¶ä¸”æ‰“å°å‡ºé”™è¯¯å›æº¯ã€‚ä¾èµ–äº <code>chain_err</code>ï¼Œé€šè¿‡é™„åŠ æ–°çš„é”™è¯¯æ¥æ‰©å±•é”™è¯¯ä¿¡æ¯ã€‚ä»è€Œå¯ä»¥å±•å¼€é”™è¯¯å †æ ˆï¼Œè¿™æ ·æä¾›äº†æ›´å¥½çš„ä¸Šä¸‹æ–‡æ¥ç†è§£é”™è¯¯çš„äº§ç”ŸåŸå› ã€‚ä¸‹è¿°ä»£ç å°è¯•å°†å€¼ <code>256</code> ååºåˆ—åŒ–ä¸º <code>u8</code>ã€‚é¦–å…ˆ <code>Serde</code> äº§ç”Ÿé”™è¯¯ï¼Œç„¶åæ˜¯ <code>csv</code>ï¼Œæœ€åæ˜¯ç”¨æˆ·ä»£ç ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Reader</span><span class="token punctuation">(</span><span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Rgb</span> <span class="token punctuation">&#123;</span>    red<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    blue<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    green<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">Rgb</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">from_reader</span><span class="token punctuation">(</span>csv_data<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Rgb</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> color<span class="token punctuation">:</span> <span class="token class-name">Rgb</span> <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>csv_data<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">ok_or</span><span class="token punctuation">(</span><span class="token string">"æ— æ³•ååºåˆ—åŒ–ç¬¬ä¸€ä¸ª CSV è®°å½•"</span><span class="token punctuation">)</span><span class="token operator">?</span>            <span class="token punctuation">.</span><span class="token function">chain_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token string">"æ— æ³•ååºåˆ—åŒ– RGB é¢œè‰²"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">UpperHex</span> <span class="token keyword">for</span> <span class="token class-name">Rgb</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> hexa <span class="token operator">=</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>red<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span> <span class="token operator">|</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>blue<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span> <span class="token operator">|</span> <span class="token keyword">u32</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>green<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"&#123;:X&#125;"</span><span class="token punctuation">,</span> hexa<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> csv <span class="token operator">=</span> <span class="token string">"red,blue,green102,256,204"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rgb <span class="token operator">=</span> <span class="token class-name">Rgb</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token string">"æ— æ³•è¯»å– CSV æ•°æ®"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125; åå…­è¿›åˆ¶ #&#123;:X&#125;"</span><span class="token punctuation">,</span> rgb<span class="token punctuation">,</span> rgb<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token keyword">ref</span> errors<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"é”™è¯¯çº§åˆ« - æè¿°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        errors            <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"â””> &#123;&#125; - &#123;&#125;"</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>backtrace<span class="token punctuation">)</span> <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> backtrace<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//åœ¨å®é™…ç”¨ä¾‹ä¸­ï¼Œåº”è¯¥å¤„ç†é”™è¯¯ã€‚ ä¾‹å¦‚ï¼š</span>        <span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">é”™è¯¯çº§åˆ« - æè¿°â””<span class="token operator">></span> <span class="token number">0</span> - æ— æ³•è¯»å– CSV æ•°æ®â””<span class="token operator">></span> <span class="token number">1</span> - æ— æ³•ååºåˆ—åŒ– RGB é¢œè‰²â””<span class="token operator">></span> <span class="token number">2</span> - CSV deserialize error: record <span class="token number">1</span> <span class="token punctuation">(</span>line: <span class="token number">2</span>, byte: <span class="token number">15</span><span class="token punctuation">)</span>: field <span class="token number">1</span>: number too large to fit <span class="token keyword">in</span> target <span class="token builtin class-name">type</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘å ç¼–ç </title>
      <link href="/news/1682091000481.html"/>
      <url>/news/1682091000481.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å­—ç¬¦é›†">1. å­—ç¬¦é›†</h2><h3 id="1-1-ç™¾åˆ†æ¯”ç¼–ç ï¼ˆURL-ç¼–ç ï¼‰å­—ç¬¦ä¸²">1.1 ç™¾åˆ†æ¯”ç¼–ç ï¼ˆ<code>URL</code> ç¼–ç ï¼‰å­—ç¬¦ä¸²</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>percent-encoding</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add percent-encoding</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">percent-encoding</span> <span class="token punctuation">=</span> <span class="token string">"2.2.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>percent-encoding</code> crate ä¸­çš„ <code>utf8_percent_encode</code> å‡½æ•°å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œç™¾åˆ†æ¯”ç¼–ç ï¼ˆ<code>URL</code> ç¼–ç ï¼‰ã€‚è§£ç ä½¿ç”¨ <code>percent_decode</code> å‡½æ•°ã€‚ç¼–ç é›†å®šä¹‰å“ªäº›å­—èŠ‚ï¼ˆé™¤äº†é <code>ASCII</code> å­—èŠ‚å’Œæ§åˆ¶é”®ä¹‹å¤–ï¼‰éœ€è¦è¿›è¡Œç™¾åˆ†æ¯”ç¼–ç ï¼ˆ<code>URL</code> ç¼–ç ï¼‰ï¼Œè¿™ä¸ªé›†åˆçš„é€‰æ‹©å–å†³äºä¸Šä¸‹æ–‡ã€‚ä¾‹å¦‚ï¼Œ<code>url</code>å¯¹ <code>URL</code> è·¯å¾„ä¸­çš„ <code>?</code> ç¼–ç ï¼Œè€Œä¸å¯¹æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„ <code>?</code> ç¼–ç ã€‚ç¼–ç çš„è¿”å›å€¼æ˜¯ <code>&amp;str</code> åˆ‡ç‰‡çš„è¿­ä»£å™¨ï¼Œç„¶åèšé›†ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² <code>String</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">percent_encoding<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>percent_decode<span class="token punctuation">,</span> utf8_percent_encode<span class="token punctuation">,</span> <span class="token class-name">AsciiSet</span><span class="token punctuation">,</span> <span class="token constant">CONTROLS</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">Utf8Error</span><span class="token punctuation">;</span><span class="token comment">/// https://url.spec.whatwg.org/#fragment-percent-encode-set</span><span class="token keyword">const</span> <span class="token constant">FRAGMENT</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">AsciiSet</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">CONTROLS</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b' '</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b'"'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b'&lt;'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b'>'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b'`'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token char">b','</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Utf8Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token string">"confident, productive systems programming"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">utf8_percent_encode</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token constant">FRAGMENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> encoded<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> <span class="token string">"confident%2C%20productive%20systems%20programming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> iter <span class="token operator">=</span> <span class="token function">percent_decode</span><span class="token punctuation">(</span>encoded<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> decoded <span class="token operator">=</span> iter<span class="token punctuation">.</span><span class="token function">decode_utf8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>decoded<span class="token punctuation">,</span> <span class="token string">"confident, productive systems programming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="1-2-å°†å­—ç¬¦ä¸²ç¼–ç ä¸º-application-x-www-form-urlencoded">1.2 å°†å­—ç¬¦ä¸²ç¼–ç ä¸º <code>application/x-www-form-urlencoded</code></h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>url</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add url</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">url</span> <span class="token punctuation">=</span> <span class="token string">"2.3.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå¦‚ä¸‹å®ä¾‹ä½¿ç”¨ <code>form_urlencoded::byte_serialize</code> å°†å­—ç¬¦ä¸²ç¼–ç ä¸º <code>application/x-www-form-urlencoded</code> è¡¨å•è¯­æ³•ï¼Œéšåä½¿ç”¨ <code>form_urlencoded::parse</code> å¯¹å…¶è¿›è¡Œè§£ç ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½è¿”å›è¿­ä»£å™¨ï¼Œç„¶åè¿™äº›è¿­ä»£å™¨èšé›†ä¸º <code>String</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">url<span class="token punctuation">::</span>form_urlencoded<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>byte_serialize<span class="token punctuation">,</span> parse<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> urlencoded<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token function">byte_serialize</span><span class="token punctuation">(</span><span class="token string">"What is â¤?"</span><span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>urlencoded<span class="token punctuation">,</span> <span class="token string">"What+is+%E2%9D%A4%3F"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"urlencoded:'&#123;&#125;'"</span><span class="token punctuation">,</span> urlencoded<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> decoded<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>urlencoded<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> val<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>decoded<span class="token punctuation">,</span> <span class="token string">"What is â¤?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"decoded:'&#123;&#125;'"</span><span class="token punctuation">,</span> decoded<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">urlencoded:<span class="token string">'What+is+%E2%9D%A4%3F'</span>decoded:<span class="token string">'What is â¤?'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-3-ç¼–ç å’Œè§£ç åå…­è¿›åˆ¶">1.3 ç¼–ç å’Œè§£ç åå…­è¿›åˆ¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>data_encoding</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add data_encoding</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">data-encoding</span> <span class="token punctuation">=</span> <span class="token string">"2.3.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒ<code>data_encoding</code> crate æä¾›äº† <code>HEXUPPER::encode</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å— <code>&amp;[u8]</code> å‚æ•°å¹¶è¿”å›åå…­è¿›åˆ¶æ•°æ®çš„å­—ç¬¦ä¸² <code>String</code>ã€‚ç±»ä¼¼åœ°ï¼Œ<code>data_encoding</code>crate æä¾›äº† <code>HEXUPPER::decode</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥å— <code>&amp;[u8]</code> å‚æ•°ã€‚å¦‚æœè¾“å…¥æ•°æ®è¢«æˆåŠŸè§£ç ï¼Œåˆ™è¿”å› <code>Vec&lt;u8&gt;</code>ã€‚ä¸‹é¢çš„å®ä¾‹å°† <code>&amp;[u8]</code> æ•°æ®è½¬æ¢ä¸ºç­‰æ•ˆçš„åå…­è¿›åˆ¶æ•°æ®ï¼Œç„¶åå°†æ­¤å€¼ä¸é¢„æœŸå€¼è¿›è¡Œæ¯”è¾ƒã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">data_encoding<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token constant">HEXUPPER</span><span class="token punctuation">,</span> <span class="token class-name">DecodeError</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">DecodeError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> original <span class="token operator">=</span> <span class="token string">b"The quick brown fox jumps over the lazy dog."</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> expected <span class="token operator">=</span> <span class="token string">"54686520717569636B2062726F776E20666F78206A756D7073206F76\        657220746865206C617A7920646F672E"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> encoded <span class="token operator">=</span> <span class="token constant">HEXUPPER</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>encoded<span class="token punctuation">,</span> expected<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> decoded <span class="token operator">=</span> <span class="token constant">HEXUPPER</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>encoded<span class="token punctuation">.</span><span class="token function">into_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>decoded<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>original<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="1-4-ç¼–ç å’Œè§£ç -base64">1.4 ç¼–ç å’Œè§£ç  <code>base64</code></h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>base64</code>ã€<code>error-chain</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add base64</code>ã€<code>cargo add error-chain</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">base64</span> <span class="token punctuation">=</span> <span class="token string">"0.21.0"</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>encode</code> å°†å­—èŠ‚åˆ‡ç‰‡ç¼–ç ä¸º <code>base64</code> å­—ç¬¦ä¸²ï¼Œå¯¹ <code>base64</code> å­—ç¬¦ä¸²è§£ç ä½¿ç”¨ <code>decode</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">base64<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token namespace">engine<span class="token punctuation">::</span></span>general_purpose<span class="token punctuation">,</span> <span class="token class-name">Engine</span> <span class="token keyword">as</span> _<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Base64</span><span class="token punctuation">(</span><span class="token namespace">base64<span class="token punctuation">::</span></span><span class="token class-name">DecodeError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Utf8Error</span><span class="token punctuation">(</span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">Utf8Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> hello <span class="token operator">=</span> <span class="token string">b"hello rustaceans"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> encoded <span class="token operator">=</span> <span class="token namespace">general_purpose<span class="token punctuation">::</span></span><span class="token constant">STANDARD_NO_PAD</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> decoded <span class="token operator">=</span> <span class="token namespace">general_purpose<span class="token punctuation">::</span></span><span class="token constant">STANDARD_NO_PAD</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>encoded<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"åŸå§‹: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"base64 ç¼–ç å: &#123;&#125;"</span><span class="token punctuation">,</span> encoded<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"è§£ç åˆ°åŸå§‹: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">str</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>decoded<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">åŸå§‹: hello rustaceansbase64 ç¼–ç å: aGVsbG8gcnVzdGFjZWFucwè§£ç åˆ°åŸå§‹: hello rustaceans<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2-CSV-å¤„ç†">2. <code>CSV</code> å¤„ç†</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>csv</code>ã€<code>serde</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add csv</code>ã€<code>cargo add serde --features derive</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">csv</span> <span class="token punctuation">=</span> <span class="token string">"1.2.1"</span><span class="token key property">serde</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"1.0.160"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-1-è¯»å–-CSV-è®°å½•">2.1 è¯»å– <code>CSV</code> è®°å½•</h3><p>â€ƒâ€ƒå°†æ ‡å‡†çš„ <code>CSV</code> è®°å½•è¯»å…¥ <code>csv::StringRecord</code>â€”â€”ä¸€ç§å¼±ç±»å‹çš„æ•°æ®è¡¨ç¤ºæ–¹å¼ï¼Œå®ƒéœ€è¦ <code>CSV</code> ä¸­çš„è¡Œæ•°æ®æ˜¯æœ‰æ•ˆçš„ <code>UTF-8</code> å­—ç¬¦ç¼–ç ã€‚å¦å¤–ï¼Œ<code>csv::ByteRecord</code> å¯¹ UTF-8 ä¸åšä»»ä½•é¢„è®¾ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> csv <span class="token operator">=</span> <span class="token string">"year,make,model,description1948,Porsche,356,Luxury sports car1967,Ford,Mustang fastback 1967,American car"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> reader <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> record <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> record <span class="token operator">=</span> record<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span>            <span class="token string">"åœ¨ &#123;&#125;, &#123;&#125; å»ºç«‹äº†&#123;&#125;æ¨¡å‹, æ˜¯ &#123;&#125;."</span><span class="token punctuation">,</span>            <span class="token operator">&amp;</span>record<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>record<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>record<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>record<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">åœ¨ <span class="token number">1948</span>, Porsche å»ºç«‹äº†356æ¨¡å‹, æ˜¯ Luxury sports car.åœ¨ <span class="token number">1967</span>, Ford å»ºç«‹äº†Mustang fastback <span class="token number">1967</span>æ¨¡å‹, æ˜¯ American car.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒ<code>Serde</code> å°†æ•°æ®ååºåˆ—åŒ–ä¸ºå¼ºç±»å‹ç»“æ„ä½“ã€‚å…·ä½“æŸ¥é˜… <code>csv::Reader::deserialize</code> æ–¹æ³•</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Record</span> <span class="token punctuation">&#123;</span>    year<span class="token punctuation">:</span> <span class="token keyword">u16</span><span class="token punctuation">,</span>    make<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    model<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    description<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> csv <span class="token operator">=</span> <span class="token string">"year,make,model,description1948,Porsche,356,Luxury sports car1967,Ford,Mustang fastback 1967,American car"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> reader <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>csv<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> record <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> record<span class="token punctuation">:</span> <span class="token class-name">Record</span> <span class="token operator">=</span> record<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span>            <span class="token string">"åœ¨ &#123;&#125;, &#123;&#125; å»ºç«‹äº†&#123;&#125;æ¨¡å‹, æ˜¯ &#123;&#125;."</span><span class="token punctuation">,</span>            record<span class="token punctuation">.</span>year<span class="token punctuation">,</span> record<span class="token punctuation">.</span>make<span class="token punctuation">,</span> record<span class="token punctuation">.</span>model<span class="token punctuation">,</span> record<span class="token punctuation">.</span>description        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">åœ¨ <span class="token number">1948</span>, Porsche å»ºç«‹äº†356æ¨¡å‹, æ˜¯ Luxury sports car.åœ¨ <span class="token number">1967</span>, Ford å»ºç«‹äº†Mustang fastback <span class="token number">1967</span>æ¨¡å‹, æ˜¯ American car.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-2-è¯»å–æœ‰ä¸åŒåˆ†éš”ç¬¦çš„-CSV-è®°å½•">2.2 è¯»å–æœ‰ä¸åŒåˆ†éš”ç¬¦çš„ <code>CSV</code> è®°å½•</h3><p>â€ƒâ€ƒä½¿ç”¨åˆ¶è¡¨ï¼ˆtabï¼‰åˆ†éš”ç¬¦ <code>delimiter</code> è¯»å– <code>CSV</code> è®°å½•ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Record</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    place<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    <span class="token attribute attr-name">#[serde(deserialize_with = <span class="token string">"csv::invalid_option"</span>)]</span>    id<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">use</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">ReaderBuilder</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">"name\tplace\tidMark\tMelbourne\t46Ashley\tZurich\t92"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> reader <span class="token operator">=</span> <span class="token class-name">ReaderBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">delimiter</span><span class="token punctuation">(</span><span class="token char">b'\t'</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">from_reader</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Record</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> result<span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Record <span class="token punctuation">&#123;</span> name: <span class="token string">"Mark"</span>, place: <span class="token string">"Melbourne"</span>, id: Some<span class="token punctuation">(</span><span class="token number">46</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>Record <span class="token punctuation">&#123;</span> name: <span class="token string">"Ashley"</span>, place: <span class="token string">"Zurich"</span>, id: Some<span class="token punctuation">(</span><span class="token number">92</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-3-ç­›é€‰åŒ¹é…æ–­è¨€çš„-CSV-è®°å½•">2.3 ç­›é€‰åŒ¹é…æ–­è¨€çš„ CSV è®°å½•</h3><p>â€ƒâ€ƒä»…ä»… è¿”å› <code>data</code> ä¸­å­—æ®µï¼ˆ<code>field</code>ï¼‰ä¸ <code>query</code> åŒ¹é…çš„çš„è¡Œã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CsvError</span><span class="token punctuation">(</span><span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> query <span class="token operator">=</span> <span class="token string">"CA"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">"\City,State,Population,Latitude,LongitudeKenai,AK,7610,60.5544444,-151.2583333Oakman,AL,,33.7133333,-87.3886111Sandfort,AL,,32.3380556,-85.2233333West Hollywood,CA,37031,34.0900000,-118.3608333"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rdr <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">ReaderBuilder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from_reader</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> wtr <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Writer</span><span class="token punctuation">::</span><span class="token function">from_writer</span><span class="token punctuation">(</span><span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">write_record</span><span class="token punctuation">(</span>rdr<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> rdr<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> record <span class="token operator">=</span> result<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> record<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>field<span class="token closure-punctuation punctuation">|</span></span> field <span class="token operator">==</span> query<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            wtr<span class="token punctuation">.</span><span class="token function">write_record</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>record<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    wtr<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">City,State,Population,Latitude,LongitudeWest Hollywood,CA,37031,34.0900000,-118.3608333<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-4-ç”¨-Serde-å¤„ç†æ— æ•ˆçš„-CSV-æ•°æ®">2.4 ç”¨ <code>Serde</code> å¤„ç†æ— æ•ˆçš„ <code>CSV</code> æ•°æ®</h3><p>â€ƒâ€ƒ<code>CSV</code> æ–‡ä»¶é€šå¸¸åŒ…å«æ— æ•ˆæ•°æ®ã€‚å¯¹äºè¿™äº›æƒ…å½¢ï¼Œ<code>csv</code> crate æä¾›äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„ååºåˆ—åŒ–ç¨‹åº <code>csv::invalid_option</code>ï¼Œå®ƒè‡ªåŠ¨å°†æ— æ•ˆæ•°æ®è½¬æ¢ä¸º <code>None</code> å€¼ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Record</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    place<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    <span class="token attribute attr-name">#[serde(deserialize_with = <span class="token string">"csv::invalid_option"</span>)]</span>    id<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">u64</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">"name,place,idmark,sydney,46.5 ashley,zurich,92akshat,delhi,37alisha,colombo,xyz"</span><span class="token punctuation">;</span> <span class="token comment">//46.5,xyz->None</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rdr <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> rdr<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> record<span class="token punctuation">:</span> <span class="token class-name">Record</span> <span class="token operator">=</span> result<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Record <span class="token punctuation">&#123;</span> name: <span class="token string">"mark"</span>, place: <span class="token string">"sydney"</span>, id: None <span class="token punctuation">&#125;</span>Record <span class="token punctuation">&#123;</span> name: <span class="token string">"ashley"</span>, place: <span class="token string">"zurich"</span>, id: Some<span class="token punctuation">(</span><span class="token number">92</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>Record <span class="token punctuation">&#123;</span> name: <span class="token string">"akshat"</span>, place: <span class="token string">"delhi"</span>, id: Some<span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>Record <span class="token punctuation">&#123;</span> name: <span class="token string">"alisha"</span>, place: <span class="token string">"colombo"</span>, id: None <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-5-å°†è®°å½•åºåˆ—åŒ–ä¸º-CSV">2.5 å°†è®°å½•åºåˆ—åŒ–ä¸º <code>CSV</code></h3><p>â€ƒâ€ƒæœ¬å®ä¾‹å±•ç¤ºäº†å¦‚ä½•åºåˆ—åŒ– Rust å…ƒç»„ã€‚<code>csv::writer</code> æ”¯æŒä» Rust ç±»å‹åˆ° <code>CSV</code> è®°å½•çš„è‡ªåŠ¨åºåˆ—åŒ–ã€‚<code>write_record</code> åªå†™å…¥åŒ…å«å­—ç¬¦ä¸²æ•°æ®çš„ç®€å•è®°å½•ã€‚å…·æœ‰æ›´å¤æ‚å€¼ï¼ˆå¦‚æ•°å­—ã€æµ®ç‚¹å’Œé€‰é¡¹ï¼‰çš„æ•°æ®ä½¿ç”¨ <code>serialize</code> è¿›è¡Œåºåˆ—åŒ–ã€‚å› ä¸º <code>csv::writer</code> ä½¿ç”¨å†…éƒ¨ç¼“å†²åŒºï¼Œæ‰€ä»¥åœ¨å®Œæˆæ—¶æ€»æ˜¯æ˜¾å¼åˆ·æ–° <code>flush</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">CSVError</span><span class="token punctuation">(</span><span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">IOError</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> wtr <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Writer</span><span class="token punctuation">::</span><span class="token function">from_writer</span><span class="token punctuation">(</span><span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">write_record</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token string">"Place"</span><span class="token punctuation">,</span> <span class="token string">"ID"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Mark"</span><span class="token punctuation">,</span> <span class="token string">"Sydney"</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"Ashley"</span><span class="token punctuation">,</span> <span class="token string">"Dublin"</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">456</span><span class="token punctuation">,</span> <span class="token string">"Delhi"</span><span class="token punctuation">,</span> <span class="token string">"A11"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    wtr<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Name,Place,IDMark,Sydney,87Ashley,Dublin,32<span class="token number">456</span>,Delhi,A11<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-6-è½¬æ¢-CSV-æ–‡ä»¶çš„åˆ—">2.6 è½¬æ¢ <code>CSV</code> æ–‡ä»¶çš„åˆ—</h3><p>â€ƒâ€ƒå°†åŒ…å«é¢œè‰²åç§°å’Œåå…­è¿›åˆ¶é¢œè‰²å€¼çš„ <code>CSV</code> æ–‡ä»¶è½¬æ¢ä¸ºå…·æœ‰é¢œè‰²åç§°å’Œ <code>rgb</code> é¢œè‰²å€¼çš„ <code>CSV</code> æ–‡ä»¶ã€‚ä½¿ç”¨ <code>csv</code> crate è¯»å†™ <code>csv</code> æ–‡ä»¶ï¼Œä½¿ç”¨ <code>serde</code> crate å¯¹è¡Œè¾“å…¥å­—èŠ‚è¿›è¡Œååºåˆ—åŒ–ï¼Œå¯¹è¡Œè¾“å‡ºå­—èŠ‚è¿›è¡Œåºåˆ—åŒ–ã€‚è¯¦ç»†è¯·å‚é˜… <code>csv::Reader::deserialize</code>ã€<code>serde::Deserialize</code>ï¼Œä»¥åŠ <code>std::str::FromStr</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Reader</span><span class="token punctuation">,</span> <span class="token class-name">Writer</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>de<span class="token punctuation">,</span> <span class="token class-name">Deserialize</span><span class="token punctuation">,</span> <span class="token class-name">Deserializer</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">str</span><span class="token punctuation">::</span><span class="token class-name">FromStr</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>   foreign_links <span class="token punctuation">&#123;</span>       <span class="token class-name">CsvError</span><span class="token punctuation">(</span><span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">ParseInt</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>num<span class="token punctuation">::</span></span><span class="token class-name">ParseIntError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">CsvInnerError</span><span class="token punctuation">(</span><span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">IntoInnerError</span><span class="token operator">&lt;</span><span class="token class-name">Writer</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">>></span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token constant">IO</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token constant">UTF8</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>string<span class="token punctuation">::</span></span><span class="token class-name">FromUtf8Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[derive(Debug)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">HexColor</span> <span class="token punctuation">&#123;</span>    red<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    green<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    blue<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[derive(Debug, Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Row</span> <span class="token punctuation">&#123;</span>    color_name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    color<span class="token punctuation">:</span> <span class="token class-name">HexColor</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">FromStr</span> <span class="token keyword">for</span> <span class="token class-name">HexColor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">type</span> <span class="token type-definition class-name">Err</span> <span class="token operator">=</span> <span class="token class-name">Error</span><span class="token punctuation">;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">from_str</span><span class="token punctuation">(</span>hex_color<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token class-name">Err</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> trimmed <span class="token operator">=</span> hex_color<span class="token punctuation">.</span><span class="token function">trim_matches</span><span class="token punctuation">(</span><span class="token char">'#'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> trimmed<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">6</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"Invalid length of hex string"</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">HexColor</span> <span class="token punctuation">&#123;</span>                red<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">::</span><span class="token function">from_str_radix</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>trimmed<span class="token punctuation">[</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>                green<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">::</span><span class="token function">from_str_radix</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>trimmed<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">..</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>                blue<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">::</span><span class="token function">from_str_radix</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>trimmed<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'de</span><span class="token operator">></span> <span class="token class-name">Deserialize</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'de</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">HexColor</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">deserialize</span><span class="token operator">&lt;</span><span class="token class-name">D</span><span class="token operator">></span><span class="token punctuation">(</span>deserializer<span class="token punctuation">:</span> <span class="token class-name">D</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">std<span class="token punctuation">::</span>result<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token keyword">Self</span><span class="token punctuation">,</span> <span class="token class-name">D</span><span class="token punctuation">::</span><span class="token class-name">Error</span><span class="token operator">></span>    <span class="token keyword">where</span>        <span class="token class-name">D</span><span class="token punctuation">:</span> <span class="token class-name">Deserializer</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'de</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">deserialize</span><span class="token punctuation">(</span>deserializer<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token class-name">FromStr</span><span class="token punctuation">::</span><span class="token function">from_str</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token namespace">de<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">::</span>custom<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token string">"color_name,colorçº¢è‰²,#ff0000ç»¿è‰²,#00ff00è“è‰²,#0000FFé•¿æ˜¥èŠ±è‰²,#ccccffå“çº¢è‰²,#ff00ff"</span>        <span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> out <span class="token operator">=</span> <span class="token class-name">Writer</span><span class="token punctuation">::</span><span class="token function">from_writer</span><span class="token punctuation">(</span><span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> reader <span class="token operator">=</span> <span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_reader</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">deserialize</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Row</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> res <span class="token operator">=</span> result<span class="token operator">?</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token punctuation">(</span>            res<span class="token punctuation">.</span>color_name<span class="token punctuation">,</span>            res<span class="token punctuation">.</span>color<span class="token punctuation">.</span>red<span class="token punctuation">,</span>            res<span class="token punctuation">.</span>color<span class="token punctuation">.</span>green<span class="token punctuation">,</span>            res<span class="token punctuation">.</span>color<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> written <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"å“çº¢è‰²,255,0,255"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> written<span class="token punctuation">.</span><span class="token function">lines</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> written<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">çº¢è‰²,255,0,0ç»¿è‰²,0,255,0è“è‰²,0,0,255é•¿æ˜¥èŠ±è‰²,204,204,255å“çº¢è‰²,255,0,255<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-ç»“æ„åŒ–æ•°æ®">3. ç»“æ„åŒ–æ•°æ®</h2><h3 id="3-1-å¯¹éç»“æ„åŒ–-JSON-åºåˆ—åŒ–å’Œååºåˆ—åŒ–">3.1 å¯¹éç»“æ„åŒ– <code>JSON</code> åºåˆ—åŒ–å’Œååºåˆ—åŒ–</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>serde_json</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add serde_json</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">serde_json</span> <span class="token punctuation">=</span> <span class="token string">"1.0.96"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒ<code>serde_json</code> crate æä¾›äº† <code>from_str</code> å‡½æ•°æ¥è§£æ <code>JSON</code> åˆ‡ç‰‡ <code>&amp;str</code>ã€‚éç»“æ„åŒ– <code>JSON</code> å¯ä»¥è¢«è§£æä¸ºä¸€ä¸ªé€šç”¨çš„ <code>serde_json::Value</code> ç±»å‹ï¼Œè¯¥ç±»å‹èƒ½å¤Ÿè¡¨ç¤ºä»»ä½•æœ‰æ•ˆçš„ <code>JSON</code> æ•°æ®ã€‚ä¸‹é¢çš„å®ä¾‹å±•ç¤ºå¦‚ä½•è§£æ <code>JSON</code> åˆ‡ç‰‡ <code>&amp;str</code>ï¼ŒæœŸæœ›å€¼è¢« <code>json!</code> å®å£°æ˜ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span>json<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Value</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token string">r#"&#123;                 "userid": 103609,                 "verified": true,                 "access_privileges": [                   "ç”¨æˆ·",                   "ç®¡ç†å‘˜"                 ]               &#125;"#</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> parsed<span class="token punctuation">:</span> <span class="token class-name">Value</span> <span class="token operator">=</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> expected <span class="token operator">=</span> <span class="token macro property">json!</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token string">"userid"</span><span class="token punctuation">:</span> <span class="token number">103609</span><span class="token punctuation">,</span>        <span class="token string">"verified"</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token string">"access_privileges"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>            <span class="token string">"ç”¨æˆ·"</span><span class="token punctuation">,</span>            <span class="token string">"ç®¡ç†å‘˜"</span>        <span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>parsed<span class="token punctuation">,</span> expected<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="3-2-ååºåˆ—åŒ–-TOML-é…ç½®æ–‡ä»¶">3.2 ååºåˆ—åŒ– <code>TOML</code> é…ç½®æ–‡ä»¶</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>toml</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add toml</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">toml</span> <span class="token punctuation">=</span> <span class="token string">"0.7.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå°†ä¸€äº› <code>TOML</code> é…ç½®é¡¹è§£æä¸ºä¸€ä¸ªé€šç”¨çš„å€¼ <code>toml::Value</code>ï¼Œè¯¥å€¼èƒ½å¤Ÿè¡¨ç¤ºä»»ä½•æœ‰æ•ˆçš„ <code>TOML</code> æ•°æ®ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">toml<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Value</span><span class="token punctuation">,</span> <span class="token namespace">de<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> toml_content <span class="token operator">=</span> <span class="token string">r#"          [package]          name = "your_package"          version = "0.1.0"          authors = ["You! &lt;you@example.org>"]          [dependencies]          serde = "1.0"          "#</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> package_info<span class="token punctuation">:</span> <span class="token class-name">Value</span> <span class="token operator">=</span> <span class="token namespace">toml<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>toml_content<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">[</span><span class="token string">"dependencies"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">[</span><span class="token string">"package"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>               <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"your_package"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><p>â€ƒâ€ƒä½¿ç”¨ <code>Serde</code> crate å°† <code>TOML</code> è§£æä¸ºè‡ªå®šä¹‰çš„ç»“æ„ä½“ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Deserialize</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">toml<span class="token punctuation">::</span>de<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">&#123;</span>    package<span class="token punctuation">:</span> <span class="token class-name">Package</span><span class="token punctuation">,</span>    dependencies<span class="token punctuation">:</span> <span class="token class-name">HashMap</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[derive(Deserialize)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Package</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    version<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    authors<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> toml_content <span class="token operator">=</span> <span class="token string">r#"          [package]          name = "your_package"          version = "0.1.0"          authors = ["You! &lt;you@example.org>"]          [dependencies]          serde = "1.0"          "#</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> package_info<span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token namespace">toml<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">(</span>toml_content<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">.</span>package<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">"your_package"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">.</span>package<span class="token punctuation">.</span>version<span class="token punctuation">,</span> <span class="token string">"0.1.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">.</span>package<span class="token punctuation">.</span>authors<span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"You! &lt;you@example.org>"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>package_info<span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span><span class="token string">"serde"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"1.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="3-3-ä»¥å°ç«¯æ¨¡å¼ï¼ˆä½ä½æ¨¡å¼ï¼‰å­—èŠ‚é¡ºåºè¯»å†™æ•´æ•°">3.3 ä»¥å°ç«¯æ¨¡å¼ï¼ˆä½ä½æ¨¡å¼ï¼‰å­—èŠ‚é¡ºåºè¯»å†™æ•´æ•°</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>byteorder</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add byteorder</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">byteorder</span> <span class="token punctuation">=</span> <span class="token string">"1.4.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå­—èŠ‚åº <code>byteorder</code> å¯ä»¥åè½¬ç»“æ„åŒ–æ•°æ®çš„æœ‰æ•ˆå­—èŠ‚ã€‚å½“é€šè¿‡ç½‘ç»œæ¥æ”¶ä¿¡æ¯æ—¶ï¼Œè¿™å¯èƒ½æ˜¯å¿…è¦çš„ï¼Œä¾‹å¦‚æ¥æ”¶åˆ°çš„å­—èŠ‚æ¥è‡ªå¦ä¸€ä¸ªç³»ç»Ÿã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">byteorder<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">LittleEndian</span><span class="token punctuation">,</span> <span class="token class-name">ReadBytesExt</span><span class="token punctuation">,</span> <span class="token class-name">WriteBytesExt</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Default, PartialEq, Debug)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Payload</span> <span class="token punctuation">&#123;</span>    kind<span class="token punctuation">:</span> <span class="token keyword">u8</span><span class="token punctuation">,</span>    value<span class="token punctuation">:</span> <span class="token keyword">u16</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> original_payload <span class="token operator">=</span> <span class="token class-name">Payload</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> encoded_bytes <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>original_payload<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> decoded_payload <span class="token operator">=</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>encoded_bytes<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>original_payload<span class="token punctuation">,</span> decoded_payload<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">encode</span><span class="token punctuation">(</span>payload<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Payload</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> bytes <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    bytes<span class="token punctuation">.</span><span class="token function">write_u8</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>kind<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    bytes<span class="token punctuation">.</span><span class="token function">write_u16</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">LittleEndian</span><span class="token operator">></span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token keyword">mut</span> bytes<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Payload</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> payload <span class="token operator">=</span> <span class="token class-name">Payload</span> <span class="token punctuation">&#123;</span>        kind<span class="token punctuation">:</span> bytes<span class="token punctuation">.</span><span class="token function">read_u8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>        value<span class="token punctuation">:</span> bytes<span class="token punctuation">.</span><span class="token function">read_u16</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">LittleEndian</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘ä¹ å¼€å‘å·¥å…·</title>
      <link href="/news/1681997809879.html"/>
      <url>/news/1681997809879.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-è°ƒè¯•å·¥å…·">1. è°ƒè¯•å·¥å…·</h2><h3 id="1-1-æ—¥å¿—ä¿¡æ¯">1.1 æ—¥å¿—ä¿¡æ¯</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>log</code>ã€<code>env_logger</code>2ä¸ªåº“ï¼Œå¯é€šè¿‡<code>cargo add chrono</code>ã€<code>cargo add env_logger</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">"0.10.0"</span> <span class="token comment"># åŠå¹´æœªæ›´æ–°</span><span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.17"</span> <span class="token comment"># ä¸€å¹´æœªæ›´æ–°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="1-1-1-è®°å½•è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°">1.1.1 è®°å½•è°ƒè¯•ä¿¡æ¯åˆ°æ§åˆ¶å°</h4><p>â€ƒâ€ƒ<code>log</code> crate æä¾›äº†æ—¥å¿—å·¥å…·ï¼Œ<code>env_logger</code> crate é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®æ—¥å¿—è®°å½•ã€‚<code>log::debug!</code> å®çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºå…¶å®ƒ <code>std::fmt</code> æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">execute_query</span><span class="token punctuation">(</span>query<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œæ“ä½œ: &#123;&#125;"</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">execute_query</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤å­¦ç”Ÿè¡¨"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>RUST_LOG=debug cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2023</span>-04-17T13:03:21Z DEBUG development<span class="token punctuation">]</span> æ‰§è¡Œæ“ä½œ: åˆ é™¤å­¦ç”Ÿè¡¨<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-1-2-è®°å½•é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°">1.1.2 è®°å½•é”™è¯¯ä¿¡æ¯åˆ°æ§åˆ¶å°</h4><p>â€ƒâ€ƒæ­£ç¡®çš„é”™è¯¯å¤„ç†ä¼šå°†å¼‚å¸¸è§†ä¸ºé”™è¯¯ã€‚ä¸‹è¿°å®ä¾‹ä¸­ï¼Œé€šè¿‡ <code>log</code> ä¾¿æ·å® <code>log::error!</code>ï¼Œå°†é”™è¯¯è®°å½•åˆ° <code>stderr</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">execute_query</span><span class="token punctuation">(</span>_query<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">"ææ€•åšä¸åˆ°"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token function">execute_query</span><span class="token punctuation">(</span><span class="token string">"DROP TABLE students"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span> response <span class="token punctuation">&#123;</span>        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œæ“ä½œå¤±è´¥: &#123;&#125;"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2023</span>-04-17T13:07:33Z ERROR development<span class="token punctuation">]</span> æ‰§è¡Œæ“ä½œå¤±è´¥: ææ€•åšä¸åˆ°<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-1-3-è®°å½•ä¿¡æ¯æ—¶ï¼Œç”¨æ ‡å‡†è¾“å‡º-stdout-æ›¿æ¢æ ‡å‡†é”™è¯¯-stderr">1.1.3 è®°å½•ä¿¡æ¯æ—¶ï¼Œç”¨æ ‡å‡†è¾“å‡º <code>stdout</code> æ›¿æ¢æ ‡å‡†é”™è¯¯ <code>stderr</code></h4><p>â€ƒâ€ƒä½¿ç”¨ <code>Builder::target</code> åˆ›å»ºè‡ªå®šä¹‰çš„æ—¥å¿—è®°å½•å™¨é…ç½®ï¼Œå°†æ—¥å¿—è¾“å‡ºçš„ç›®æ ‡è®¾ç½®ä¸º <code>Target::Stdout</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Builder</span><span class="token punctuation">,</span> <span class="token class-name">Target</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">target</span><span class="token punctuation">(</span><span class="token class-name">Target</span><span class="token punctuation">::</span><span class="token class-name">Stdout</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"æ­¤é”™è¯¯å·²æ‰“å°åˆ°æ ‡å‡†è¾“å‡º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2023</span>-04-17T13:10:37Z ERROR development<span class="token punctuation">]</span> æ­¤é”™è¯¯å·²æ‰“å°åˆ°æ ‡å‡†è¾“å‡º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-1-4-è®°å½•ä¿¡æ¯æ—¶ï¼Œç”¨æ ‡å‡†è¾“å‡º-stdout-æ›¿æ¢æ ‡å‡†é”™è¯¯-stderr">1.1.4 è®°å½•ä¿¡æ¯æ—¶ï¼Œç”¨æ ‡å‡†è¾“å‡º <code>stdout</code> æ›¿æ¢æ ‡å‡†é”™è¯¯ <code>stderr</code></h4><p>â€ƒâ€ƒå®ç°ä¸€ä¸ªæ‰“å°åˆ° <code>stdout</code> çš„è‡ªå®šä¹‰è®°å½•å™¨ <code>ConsoleLogger</code>ã€‚ä¸ºäº†ä½¿ç”¨æ—¥å¿—å®ï¼Œ<code>ConsoleLogger</code>å®ç°äº† <code>log::Log trait</code>ï¼Œé€šè¿‡ <code>log::set_logger</code> å®‰ç½®ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Level</span><span class="token punctuation">,</span> <span class="token class-name">LevelFilter</span><span class="token punctuation">,</span> <span class="token class-name">Metadata</span><span class="token punctuation">,</span> <span class="token class-name">Record</span><span class="token punctuation">,</span> <span class="token class-name">SetLoggerError</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">static</span> <span class="token constant">CONSOLE_LOGGER</span><span class="token punctuation">:</span> <span class="token class-name">ConsoleLogger</span> <span class="token operator">=</span> <span class="token class-name">ConsoleLogger</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">ConsoleLogger</span><span class="token punctuation">;</span><span class="token keyword">impl</span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">Log</span> <span class="token keyword">for</span> <span class="token class-name">ConsoleLogger</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">enabled</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> metadata<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Metadata</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>        metadata<span class="token punctuation">.</span><span class="token function">level</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token class-name">Level</span><span class="token punctuation">::</span><span class="token class-name">Info</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">log</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> record<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Record</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">enabled</span><span class="token punctuation">(</span>record<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Rust says: &#123;&#125; - &#123;&#125;"</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">level</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> record<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">flush</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SetLoggerError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token function">set_logger</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token constant">CONSOLE_LOGGER</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token function">set_max_level</span><span class="token punctuation">(</span><span class="token class-name">LevelFilter</span><span class="token punctuation">::</span><span class="token class-name">Info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"ä¿¡æ¯æ—¥å¿—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"è­¦å‘Šæ—¥å¿—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"é”™è¯¯æ—¥å¿—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Rust says: INFO - ä¿¡æ¯æ—¥å¿—Rust says: WARN - è­¦å‘Šæ—¥å¿—Rust says: ERROR - é”™è¯¯æ—¥å¿—<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="1-1-5-è®°å½•åˆ°-Unix-ç³»ç»Ÿæ—¥å¿—">1.1.5 è®°å½•åˆ° Unix ç³»ç»Ÿæ—¥å¿—</h4><p>â€ƒâ€ƒéœ€è¦é¢å¤–å®‰è£…<code>syslog</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add syslog</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">"0.10.0"</span> <span class="token comment"># åŠå¹´æœªæ›´æ–°</span><span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.17"</span> <span class="token comment"># ä¸€å¹´æœªæ›´æ–°</span><span class="token key property">syslog</span> <span class="token punctuation">=</span> <span class="token string">"6.0.1"</span> <span class="token comment"># ä¸€å¹´æœªæ›´æ–°</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå®ç°å°†ä¿¡æ¯è®°å½•åˆ° <code>UNIX</code> <code>syslog</code>ã€‚ä½¿ç”¨ <code>syslog::init</code> åˆå§‹åŒ–è®°å½•å™¨åç«¯ã€‚<code>syslog::Facility</code> è®°å½•æäº¤æ—¥å¿—é¡¹åˆ†ç±»çš„ç¨‹åºï¼Œ<code>log::LevelFilter</code> è¡¨ç¤ºæ¬²è®°å½•æ—¥å¿—çš„ç­‰çº§ï¼Œ<code>Option&lt;&amp;str&gt;</code> å®šä¹‰åº”ç”¨ç¨‹åºåç§°ï¼ˆå¯é€‰ï¼‰ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token attribute attr-name">#[cfg(target_os = <span class="token string">"linux"</span>)]</span><span class="token attribute attr-name">#[cfg(target_os = <span class="token string">"linux"</span>)]</span><span class="token keyword">use</span> <span class="token namespace">syslog<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Facility</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[cfg(target_os = <span class="token string">"linux"</span>)]</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token namespace">syslog<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span>        <span class="token class-name">Facility</span><span class="token punctuation">::</span><span class="token constant">LOG_USER</span><span class="token punctuation">,</span>        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">LevelFilter</span><span class="token punctuation">::</span><span class="token class-name">Debug</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">"æµ‹è¯•ç³»ç»Ÿæ—¥å¿—"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯debugä¿¡æ¯ &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ä¸€ä¸ªErrorä¿¡æ¯!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token attribute attr-name">#[cfg(not(target_os = <span class="token string">"linux"</span>))]</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"So far, only Linux systems are supported."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºåˆ°ç³»ç»Ÿæ—¥å¿—ï¼Œå¯é€šè¿‡<code>tail -f /var/log/syslog</code>ç³»ç»Ÿå‘½ä»¤æŸ¥çœ‹è¾“å‡ºçš„æ—¥å¿—å†…å®¹ï¼Œå¦‚ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Apr <span class="token number">17</span> <span class="token number">14</span>:50:34 dynasty dynasty æµ‹è¯•ç³»ç»Ÿæ—¥å¿—<span class="token punctuation">[</span><span class="token number">838264</span><span class="token punctuation">]</span>: è¿™æ˜¯debugä¿¡æ¯ messageApr <span class="token number">17</span> <span class="token number">14</span>:50:34 dynasty dynasty æµ‹è¯•ç³»ç»Ÿæ—¥å¿—<span class="token punctuation">[</span><span class="token number">838264</span><span class="token punctuation">]</span>: è¿™æ˜¯ä¸€ä¸ªErrorä¿¡æ¯<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-2-æ—¥å¿—é…ç½®">1.2 æ—¥å¿—é…ç½®</h3><h4 id="1-2-1-å¯ç”¨æ¯ä¸ªæ¨¡å—çš„æ—¥å¿—çº§åˆ«">1.2.1 å¯ç”¨æ¯ä¸ªæ¨¡å—çš„æ—¥å¿—çº§åˆ«</h4><p>â€ƒâ€ƒåˆ›å»ºä¸¤ä¸ªæ¨¡å—ï¼š<code>foo</code> å’Œå…¶åµŒå¥—çš„ <code>foo::bar</code>ï¼Œæ—¥å¿—è®°å½•æŒ‡ä»¤åˆ†åˆ«ç”± <code>RUST_LOG</code> ç¯å¢ƒå˜é‡æ§åˆ¶ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">foo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">mod</span> <span class="token module-declaration namespace">bar</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"[bar] warn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"[bar] info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"[bar] debug"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"[foo] warn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"[foo] info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"[foo] debug"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token namespace">bar<span class="token punctuation">::</span></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"[root] warn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"[root] info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"[root] debug"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">foo<span class="token punctuation">::</span></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>RUST_LOG=&quot;warn,development::foo=info,development::foo::bar=debug&quot; cargo run</code>(æ³¨æ„è¿™å—çš„<code>development</code>ä¸ºé¡¹ç›®åç§°)å‘½ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z WARN  development<span class="token punctuation">]</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span> warn<span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z WARN  development::foo<span class="token punctuation">]</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> warn<span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z INFO  development::foo<span class="token punctuation">]</span> <span class="token punctuation">[</span>foo<span class="token punctuation">]</span> info<span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z WARN  development::foo::bar<span class="token punctuation">]</span> <span class="token punctuation">[</span>bar<span class="token punctuation">]</span> warn<span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z INFO  development::foo::bar<span class="token punctuation">]</span> <span class="token punctuation">[</span>bar<span class="token punctuation">]</span> info<span class="token punctuation">[</span><span class="token number">2023</span>-04-17T15:00:37Z DEBUG development::foo::bar<span class="token punctuation">]</span> <span class="token punctuation">[</span>bar<span class="token punctuation">]</span> debug<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-2-ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡è®¾ç½®æ—¥å¿—è®°å½•">1.2.2 ç”¨è‡ªå®šä¹‰ç¯å¢ƒå˜é‡è®¾ç½®æ—¥å¿—è®°å½•</h4><p>â€ƒâ€ƒ<code>Builder</code> é…ç½®æ—¥å¿—è®°å½•ã€‚<code>Builder::parse</code> ä»¥ <code>RUST_LOG</code> è¯­æ³•çš„å½¢å¼è§£æ <code>MY_APP_LOG</code> ç¯å¢ƒå˜é‡çš„å†…å®¹ã€‚ç„¶åï¼Œ<code>Builder::init</code> åˆå§‹åŒ–è®°å½•å™¨ã€‚æ‰€æœ‰è¿™äº›æ­¥éª¤é€šå¸¸ç”± <code>env_logger::init</code> åœ¨å†…éƒ¨å®Œæˆã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>env<span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">parse_filters</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">env<span class="token punctuation">::</span></span><span class="token function">var</span><span class="token punctuation">(</span><span class="token string">"MY_APP_LOG"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//parse_filtersä»£æ›¿parseæ–¹æ³•</span>        <span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"ä¿¡æ¯æ¶ˆæ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"è­¦å‘Šæ¶ˆæ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯ä¸ªé”™è¯¯ &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token string">"message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>MY_APP_LOG=info cargo run</code>å‘½ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span><span class="token number">2023</span>-04-18T13:41:21Z INFO  development<span class="token punctuation">]</span> ä¿¡æ¯æ¶ˆæ¯<span class="token punctuation">[</span><span class="token number">2023</span>-04-18T13:41:21Z WARN  development<span class="token punctuation">]</span> è­¦å‘Šæ¶ˆæ¯<span class="token punctuation">[</span><span class="token number">2023</span>-04-18T13:41:21Z ERROR development<span class="token punctuation">]</span> è¿™æ˜¯ä¸ªé”™è¯¯ message<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="1-2-3-åœ¨æ—¥å¿—ä¿¡æ¯ä¸­åŒ…å«æ—¶é—´æˆ³">1.2.3 åœ¨æ—¥å¿—ä¿¡æ¯ä¸­åŒ…å«æ—¶é—´æˆ³</h4><p>â€ƒâ€ƒéœ€è¦é¢å¤–å®‰è£…<code>chrono</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add chrono</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">env_logger</span> <span class="token punctuation">=</span> <span class="token string">"0.10.0"</span> <span class="token comment"># åŠå¹´æœªæ›´æ–°</span><span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.17"</span> <span class="token comment"># ä¸€å¹´æœªæ›´æ–°</span><span class="token key property">chrono</span> <span class="token punctuation">=</span> <span class="token string">"0.4.24"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>Builder</code> åˆ›å»ºè‡ªå®šä¹‰è®°å½•å™¨é…ç½®ã€‚æ¯ä¸ªæ—¥å¿—é¡¹è°ƒç”¨ <code>Local::now</code> ä»¥è·å–æœ¬åœ°æ—¶åŒºä¸­çš„å½“å‰ <code>DateTime</code>ï¼Œå¹¶ä½¿ç”¨ <code>DateTime::format</code> å’Œ <code>strftime::specifiers</code> æ¥æ ¼å¼åŒ–æœ€ç»ˆæ—¥å¿—ä¸­ä½¿ç”¨çš„æ—¶é—´æˆ³ã€‚å¦‚ä¸‹å®ä¾‹è°ƒç”¨ <code>Builder::format</code> è®¾ç½®ä¸€ä¸ªé—­åŒ…ï¼Œè¯¥é—­åŒ…ç”¨æ—¶é—´æˆ³ã€<code>Record::level</code> å’Œæ­£æ–‡ï¼ˆ<code>Record::args</code>ï¼‰å¯¹æ¯ä¸ªä¿¡æ¯æ–‡æœ¬è¿›è¡Œæ ¼å¼åŒ–ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token class-name">Local</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">env_logger<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">LevelFilter</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Write</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>buf<span class="token punctuation">,</span> record<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token macro property">writeln!</span><span class="token punctuation">(</span>                buf<span class="token punctuation">,</span>                <span class="token string">"&#123;&#125; [&#123;&#125;] - &#123;&#125;"</span><span class="token punctuation">,</span>                <span class="token class-name">Local</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                record<span class="token punctuation">.</span><span class="token function">level</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                record<span class="token punctuation">.</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">None</span><span class="token punctuation">,</span> <span class="token class-name">LevelFilter</span><span class="token punctuation">::</span><span class="token class-name">Info</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">warn!</span><span class="token punctuation">(</span><span class="token string">"warn"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">debug!</span><span class="token punctuation">(</span><span class="token string">"debug"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>å‘½ä»¤ï¼Œè¾“å‡ºå¦‚ä¸‹:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2023</span>-04-18 <span class="token number">13</span>:47:50 <span class="token punctuation">[</span>WARN<span class="token punctuation">]</span> - warn<span class="token number">2023</span>-04-18 <span class="token number">13</span>:47:50 <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> - info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="1-2-4-å°†ä¿¡æ¯è®°å½•åˆ°è‡ªå®šä¹‰ä½ç½®">1.2.4 å°†ä¿¡æ¯è®°å½•åˆ°è‡ªå®šä¹‰ä½ç½®</h4><p>â€ƒâ€ƒéœ€è¦é¢å¤–å®‰è£…<code>log4rs</code>å’Œ<code>error_chain</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add log4rs</code>ã€<code>cargo add error_chain</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">log</span> <span class="token punctuation">=</span> <span class="token string">"0.4.17"</span> <span class="token comment"># ä¸€å¹´æœªæ›´æ–°</span><span class="token key property">log4rs</span> <span class="token punctuation">=</span> <span class="token string">"1.2.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>Builder</code> åˆ›å»ºè‡ªå®šä¹‰è®°å½•å™¨é…ç½®ã€‚æ¯ä¸ªæ—¥å¿—é¡¹è°ƒç”¨ <code>Local::now</code> ä»¥è·å–æœ¬åœ°æ—¶åŒºä¸­çš„å½“å‰ <code>DateTime</code>ï¼Œå¹¶ä½¿ç”¨ <code>DateTime::format</code> å’Œ <code>strftime::specifiers</code> æ¥æ ¼å¼åŒ–æœ€ç»ˆæ—¥å¿—ä¸­ä½¿ç”¨çš„æ—¶é—´æˆ³ã€‚å¦‚ä¸‹å®ä¾‹è°ƒç”¨ <code>Builder::format</code> è®¾ç½®ä¸€ä¸ªé—­åŒ…ï¼Œè¯¥é—­åŒ…ç”¨æ—¶é—´æˆ³ã€<code>Record::level</code> å’Œæ­£æ–‡ï¼ˆ<code>Record::args</code>ï¼‰å¯¹æ¯ä¸ªä¿¡æ¯æ–‡æœ¬è¿›è¡Œæ ¼å¼åŒ–ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">LevelFilter</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">log4rs<span class="token punctuation">::</span>append<span class="token punctuation">::</span>file<span class="token punctuation">::</span></span><span class="token class-name">FileAppender</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">log4rs<span class="token punctuation">::</span>config<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Appender</span><span class="token punctuation">,</span> <span class="token class-name">Config</span><span class="token punctuation">,</span> <span class="token class-name">Root</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">log4rs<span class="token punctuation">::</span>encode<span class="token punctuation">::</span>pattern<span class="token punctuation">::</span></span><span class="token class-name">PatternEncoder</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">LogConfig</span><span class="token punctuation">(</span><span class="token namespace">log4rs<span class="token punctuation">::</span>config<span class="token punctuation">::</span></span><span class="token class-name">FormatError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SetLogger</span><span class="token punctuation">(</span><span class="token namespace">log<span class="token punctuation">::</span></span><span class="token class-name">SetLoggerError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> logfile <span class="token operator">=</span> <span class="token class-name">FileAppender</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">encoder</span><span class="token punctuation">(</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">PatternEncoder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"&#123;d&#125; -[&#123;l&#125;]: &#123;m&#125;&#123;n&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string">"log/output.log"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token class-name">Config</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">appender</span><span class="token punctuation">(</span><span class="token class-name">Appender</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token string">"logfile"</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>logfile<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">Root</span><span class="token punctuation">::</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appender</span><span class="token punctuation">(</span><span class="token string">"logfile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token class-name">LevelFilter</span><span class="token punctuation">::</span><span class="token class-name">Info</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">log4rs<span class="token punctuation">::</span></span><span class="token function">init_config</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"è¾“å‡ºæ—¥å¿—"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>å‘½ä»¤ç”Ÿæˆ<code>log</code>æ—¥å¿—ï¼Œå¯é€šè¿‡<code>cat log/output.log</code>å‘½ä»¤æŸ¥çœ‹è¾“å‡ºçš„æ—¥å¿—:</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2023</span>-04-18T14:03:39.703966199+00:00 -<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>: è¾“å‡ºæ—¥å¿—<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-ç‰ˆæœ¬æ§åˆ¶">2. ç‰ˆæœ¬æ§åˆ¶</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>semver</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add semver</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">semver</span> <span class="token punctuation">=</span> <span class="token string">"1.0.17"</span> <span class="token comment"># api å˜åŒ–å¤§</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-1-è§£æå¹¶é€’å¢ç‰ˆæœ¬å­—ç¬¦ä¸²">2.1 è§£æå¹¶é€’å¢ç‰ˆæœ¬å­—ç¬¦ä¸²</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>Version::parse</code> ä»å­—ç¬¦ä¸²å­—é¢é‡æ„é€ è¯­ä¹‰åŒ–ç‰ˆæœ¬ <code>semver::Version</code>ï¼Œç„¶åé€ä¸ªé€’å¢è¡¥ä¸ï¼ˆä¿®è®¢ï¼‰ç‰ˆæœ¬å·ã€å‰¯ï¼ˆæ¬¡è¦ï¼‰ç‰ˆæœ¬å·å’Œä¸»ç‰ˆæœ¬å·ã€‚**æ³¨æ„ï¼š**æ ¹æ®è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼Œå¢åŠ å‰¯ï¼ˆæ¬¡è¦ï¼‰ç‰ˆæœ¬å·æ—¶ä¼šå°†è¡¥ä¸ï¼ˆä¿®è®¢ï¼‰ç‰ˆæœ¬å·é‡ç½®ä¸º <code>0</code>ï¼Œå¢åŠ ä¸»ç‰ˆæœ¬å·æ—¶ä¼šå°†å‰¯ï¼ˆæ¬¡è¦ï¼‰ç‰ˆæœ¬å·å’Œè¡¥ä¸ï¼ˆä¿®è®¢ï¼‰ç‰ˆæœ¬å·éƒ½é‡ç½®ä¸º <code>0</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BuildMetadata</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Prerelease</span><span class="token punctuation">,</span> <span class="token class-name">Version</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> parsed_version <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"0.2.6"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        parsed_version<span class="token punctuation">,</span>        <span class="token class-name">Version</span> <span class="token punctuation">&#123;</span>            major<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            minor<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>            patch<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>            pre<span class="token punctuation">:</span> <span class="token class-name">Prerelease</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">,</span>            build<span class="token punctuation">:</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// parsed_version.increment_patch(); // å¼€å‘è€…åˆ é™¤è¯¥å®ç°ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å®ç°</span>    <span class="token function">increment_patch</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>parsed_version<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0.2.7"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„è¡¥ä¸å‘å¸ƒ: v&#123;&#125;"</span><span class="token punctuation">,</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// parsed_version.increment_minor(); // å¼€å‘è€…åˆ é™¤è¯¥å®ç°ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å®ç°</span>    <span class="token function">increment_minor</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>parsed_version<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"0.3.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„æ¬¡è¦ç‰ˆæœ¬: v&#123;&#125;"</span><span class="token punctuation">,</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// parsed_version.increment_major(); // å¼€å‘è€…åˆ é™¤è¯¥å®ç°ï¼Œéœ€è¦ç”¨æˆ·è‡ªå·±å®ç°</span>    <span class="token function">increment_major</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>parsed_version<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ–°çš„ä¸»è¦ç‰ˆæœ¬: v&#123;&#125;"</span><span class="token punctuation">,</span> parsed_version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">increment_patch</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Version</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    v<span class="token punctuation">.</span>patch <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token class-name">Prerelease</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>build <span class="token operator">=</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">increment_minor</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Version</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    v<span class="token punctuation">.</span>minor <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>patch <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token class-name">Prerelease</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>build <span class="token operator">=</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">increment_major</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Version</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    v<span class="token punctuation">.</span>major <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>minor <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>patch <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>pre <span class="token operator">=</span> <span class="token class-name">Prerelease</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span>build <span class="token operator">=</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ–°çš„è¡¥ä¸å‘å¸ƒ: v0.2.7æ–°çš„æ¬¡è¦ç‰ˆæœ¬: v0.3.0æ–°çš„ä¸»è¦ç‰ˆæœ¬: v1.0.0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-2-è§£æå¤æ‚çš„ç‰ˆæœ¬å­—ç¬¦ä¸²">2.2 è§£æå¤æ‚çš„ç‰ˆæœ¬å­—ç¬¦ä¸²</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>Version::parse</code> ä»å¤æ‚çš„ç‰ˆæœ¬å­—ç¬¦ä¸²æ„é€ è¯­ä¹‰åŒ–ç‰ˆæœ¬ <code>semver::Version</code>ã€‚è¯¥å­—ç¬¦ä¸²åŒ…å«è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒä¸­å®šä¹‰çš„é¢„å‘å¸ƒå’Œæ„å»ºå…ƒæ•°æ®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ ¹æ®è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼Œæ„å»ºå…ƒæ•°æ®æ˜¯è™½ç„¶è¢«è§£æï¼Œä½†åœ¨æ¯”è¾ƒç‰ˆæœ¬æ—¶ä¸è€ƒè™‘ã€‚æ¢å¥è¯è¯´ï¼Œå³ä½¿ä¸¤ä¸ªç‰ˆæœ¬çš„æ„å»ºå­—ç¬¦ä¸²ä¸åŒï¼Œä½†å®ƒä»¬çš„ç‰ˆæœ¬å¯èƒ½æ˜¯ç›¸ç­‰çš„ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BuildMetadata</span><span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Prerelease</span><span class="token punctuation">,</span> <span class="token class-name">Version</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> version_str <span class="token operator">=</span> <span class="token string">"1.0.49-125+g72ee7853"</span><span class="token punctuation">;</span>    <span class="token comment">// ä¸è€ƒè™‘buildç‰ˆæœ¬çš„æ¯”è¾ƒ</span>    <span class="token keyword">let</span> comparator_version <span class="token operator">=</span> <span class="token class-name">Comparator</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>version_str<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Comparator</span><span class="token punctuation">::</span><span class="token function">matches</span><span class="token punctuation">(</span>        <span class="token operator">&amp;</span>comparator_version<span class="token punctuation">,</span>        <span class="token operator">&amp;</span><span class="token class-name">Version</span> <span class="token punctuation">&#123;</span>            major<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>            minor<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            patch<span class="token punctuation">:</span> <span class="token number">49</span><span class="token punctuation">,</span>            pre<span class="token punctuation">:</span> <span class="token class-name">Prerelease</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"125"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>            build<span class="token punctuation">:</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token constant">EMPTY</span><span class="token punctuation">,</span> <span class="token comment">// ä¸è€ƒè™‘buildç‰ˆæœ¬çš„æ¯”è¾ƒ</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// // å°†ç‰ˆæœ¬å·å­—ç¬¦ä¸²è§£æä¸ºå®Œæ•´çš„ç‰ˆæœ¬å·å¯¹è±¡ï¼Œè€ƒè™‘buildç‰ˆæœ¬çš„æ¯”è¾ƒ</span>    <span class="token keyword">let</span> parsed_version <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>version_str<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>parsed_version<span class="token punctuation">.</span>build<span class="token punctuation">,</span> <span class="token class-name">BuildMetadata</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"g72ee7853"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> serialized_version <span class="token operator">=</span> parsed_version<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>serialized_version<span class="token punctuation">,</span> version_str<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="2-3-æ£€æŸ¥ç»™å®šç‰ˆæœ¬æ˜¯å¦ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬">2.3 æ£€æŸ¥ç»™å®šç‰ˆæœ¬æ˜¯å¦ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬</h3><p>â€ƒâ€ƒç»™å®šä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ <code>is_prerelease</code> æ–­è¨€ä¸€ä¸ªæ˜¯é¢„å‘å¸ƒï¼Œå¦ä¸€ä¸ªä¸æ˜¯ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Version</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> version_1 <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.0.0-alpha"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> version_2 <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token comment">// åŸå‡½æ•°is_prereleaseå·²åˆ é™¤é€šè¿‡version_1.preåˆ¤æ–­</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>version_1<span class="token punctuation">.</span>pre<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€version1ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>version_2<span class="token punctuation">.</span>pre<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€version2ä¸æ˜¯é¢„å‘å¸ƒç‰ˆæœ¬</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="2-4-æŸ¥è¯¢é€‚é…ç»™å®šèŒƒå›´çš„æœ€æ–°ç‰ˆæœ¬">2.4 æŸ¥è¯¢é€‚é…ç»™å®šèŒƒå›´çš„æœ€æ–°ç‰ˆæœ¬</h3><p>â€ƒâ€ƒç»™å®šä¸¤ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ <code>is_prerelease</code> æ–­è¨€ä¸€ä¸ªæ˜¯é¢„å‘å¸ƒï¼Œå¦ä¸€ä¸ªä¸æ˜¯ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">Version</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> version_1 <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.0.0-alpha"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> version_2 <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token comment">// åŸå‡½æ•°is_prereleaseå·²åˆ é™¤é€šè¿‡version_1.preåˆ¤æ–­</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>version_1<span class="token punctuation">.</span>pre<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€version1ä¸ºé¢„å‘å¸ƒç‰ˆæœ¬</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>version_2<span class="token punctuation">.</span>pre<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ–­è¨€version2ä¸æ˜¯é¢„å‘å¸ƒç‰ˆæœ¬</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="2-5-æŸ¥è¯¢é€‚é…ç»™å®šèŒƒå›´çš„æœ€æ–°ç‰ˆæœ¬">2.5 æŸ¥è¯¢é€‚é…ç»™å®šèŒƒå›´çš„æœ€æ–°ç‰ˆæœ¬</h3><p>â€ƒâ€ƒç»™å®šä¸€ä¸ªç‰ˆæœ¬å­—ç¬¦ä¸² <code>&amp;str</code> çš„åˆ—è¡¨ï¼ŒæŸ¥æ‰¾æœ€æ–°çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬ <code>semver::Version</code>ã€‚<code>semver::VersionReq</code> ç”¨ <code>VersionReq::matches</code> è¿‡æ»¤åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥å±•ç¤ºè¯­ä¹‰åŒ–ç‰ˆæœ¬ <code>semver</code> çš„é¢„å‘å¸ƒå‚æ•°è®¾ç½®ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Version</span><span class="token punctuation">,</span> <span class="token class-name">VersionReq</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">SemVer</span><span class="token punctuation">(</span><span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// SemVerReq(semver::Error);</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">find_max_matching_version</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">,</span> <span class="token class-name">I</span><span class="token operator">></span><span class="token punctuation">(</span>version_req_str<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> iterable<span class="token punctuation">:</span> <span class="token class-name">I</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">Version</span><span class="token operator">>></span><span class="token keyword">where</span>    <span class="token class-name">I</span><span class="token punctuation">:</span> <span class="token class-name">IntoIterator</span><span class="token operator">&lt;</span><span class="token class-name">Item</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> vreq <span class="token operator">=</span> <span class="token class-name">VersionReq</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>version_req_str<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>iterable        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> vreq<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        <span class="token function">find_max_matching_version</span><span class="token punctuation">(</span><span class="token string">"&lt;= 1.0.0"</span><span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"0.9.0"</span><span class="token punctuation">,</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span> <span class="token string">"1.0.1"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.0.0"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        <span class="token function">find_max_matching_version</span><span class="token punctuation">(</span>            <span class="token string">">1.2.3-alpha.3"</span><span class="token punctuation">,</span>            <span class="token macro property">vec!</span><span class="token punctuation">[</span>                <span class="token string">"1.2.3-alpha.3"</span><span class="token punctuation">,</span>                <span class="token string">"1.2.3-alpha.4"</span><span class="token punctuation">,</span>                <span class="token string">"1.2.3-alpha.10"</span><span class="token punctuation">,</span>                <span class="token string">"1.2.3-beta.4"</span><span class="token punctuation">,</span>                <span class="token string">"3.4.5-alpha.9"</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span>        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">"1.2.3-beta.4"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="2-6-æ£€æŸ¥å¤–éƒ¨å‘½ä»¤çš„ç‰ˆæœ¬å…¼å®¹æ€§">2.6 æ£€æŸ¥å¤–éƒ¨å‘½ä»¤çš„ç‰ˆæœ¬å…¼å®¹æ€§</h3><p>â€ƒâ€ƒå®ä¾‹ä½¿ç”¨ <code>Command</code> æ¨¡å—è¿è¡Œå‘½ä»¤ <code>git --version</code>ï¼Œç„¶åä½¿ç”¨ <code>Version::parse</code> å°†ç‰ˆæœ¬å·è§£æä¸ºè¯­ä¹‰åŒ–ç‰ˆæœ¬ <code>semver::Version</code>ã€‚<code>VersionReq::matches</code> å°† <code>semver::VersionReq</code> ä¸è§£æçš„è¯­ä¹‰åŒ–ç‰ˆæœ¬è¿›è¡Œæ¯”è¾ƒã€‚æœ€ç»ˆï¼Œå‘½ä»¤è¾“å‡ºç±»ä¼¼äºâ€œ<code>git version x.y.z</code>â€</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Version</span><span class="token punctuation">,</span> <span class="token class-name">VersionReq</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token class-name">Command</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Utf8</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>string<span class="token punctuation">::</span></span><span class="token class-name">FromUtf8Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SemVer</span><span class="token punctuation">(</span><span class="token namespace">semver<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> version_constraint <span class="token operator">=</span> <span class="token string">"> 1.12.0"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> version_test <span class="token operator">=</span> <span class="token class-name">VersionReq</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>version_constraint<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token class-name">Command</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"git"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span><span class="token string">"--version"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token operator">!</span>output<span class="token punctuation">.</span>status<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token namespace">error_chain<span class="token punctuation">::</span></span><span class="token macro property">bail!</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œå‘½ä»¤å¤±è´¥é”™è¯¯ä»£ç "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> stdout <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from_utf8</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>stdout<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> version <span class="token operator">=</span> stdout        <span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//å¤„ç†å¤šä½™çš„å›è½¦ç¬¦å·</span>        <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">ok_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token string">"å‘½ä»¤è¾“å‡ºæ— æ•ˆ"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> parsed_version <span class="token operator">=</span> <span class="token class-name">Version</span><span class="token punctuation">::</span><span class="token function">parse</span><span class="token punctuation">(</span>version<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token operator">!</span>version_test<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>parsed_version<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token namespace">error_chain<span class="token punctuation">::</span></span><span class="token macro property">bail!</span><span class="token punctuation">(</span>            <span class="token string">"å‘½ä»¤ç‰ˆæœ¬ä½äºæœ€ä½æ”¯æŒç‰ˆæœ¬ (æ‰¾åˆ° &#123;&#125;, éœ€è¦ &#123;&#125;)"</span><span class="token punctuation">,</span>            parsed_version<span class="token punctuation">,</span>            version_constraint        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2.34</span>.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-æ„å»ºå·¥å…·">3. æ„å»ºå·¥å…·</h2><p>â€ƒâ€ƒæœ¬èŠ‚ä»‹ç»åœ¨ç¼–è¯‘ <code>crate</code> æºä»£ç ä¹‹å‰è¿è¡Œçš„â€œæ„å»ºæ—¶â€å·¥å…·æˆ–ä»£ç ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œæ„å»ºæ—¶ä»£ç å­˜æ”¾åœ¨ <strong><a href="http://build.rs">build.rs</a></strong> æ–‡ä»¶ï¼Œé€šå¸¸ç§°ä¸ºâ€œæ„å»ºè„šæœ¬â€ã€‚å¸¸è§çš„ç”¨ä¾‹åŒ…æ‹¬ï¼šRust ä»£ç ç”Ÿæˆã€ç»‘å®šçš„ <strong>C/C++/asm</strong>ä»£ç çš„ç¼–è¯‘ã€‚è¦è·å–æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯»ï¼ˆCargo æ‰‹å†Œ ä¸­æ–‡ç‰ˆï¼‰ çš„æ„å»ºè„šæœ¬æ–‡æ¡£ã€‚</p><h3 id="3-1-ç¼–è¯‘å¹¶é™æ€é“¾æ¥åˆ°ç»‘å®šçš„-C-è¯­è¨€åº“">3.1 ç¼–è¯‘å¹¶é™æ€é“¾æ¥åˆ°ç»‘å®šçš„ <strong>C</strong> è¯­è¨€åº“</h3><p>â€ƒâ€ƒä¸ºäº†é€‚åº”é¡¹ç›®ä¸­éœ€è¦æ··åˆ <strong>Cã€C++ï¼Œæˆ– asm</strong>ç­‰è¯­è¨€çš„åœºæ™¯ï¼Œ<strong>cc crate</strong> æä¾›äº†ä¸€ä¸ªç®€å•çš„ APIï¼Œç”¨äºå°†ç»‘å®šçš„ <strong>C/C++/asm</strong> ä»£ç ç¼–è¯‘æˆé™æ€åº“ï¼ˆ<strong>.a</strong>ï¼‰ï¼Œé™æ€åº“å¯ä»¥é€šè¿‡ <strong>rustc</strong> é™æ€é“¾æ¥ã€‚ä¸‹é¢çš„å®ä¾‹æœ‰ä¸€äº›ç»‘å®šçš„ <strong>C</strong> è¯­è¨€ä»£ç ï¼ˆ<strong>src/hello.c</strong>ï¼‰ï¼Œå°†ä» rust ä¸­è°ƒç”¨å®ƒä»¬ã€‚åœ¨ç¼–è¯‘ rust æºä»£ç ä¹‹å‰ï¼Œ<strong>Cargo.toml</strong>ä¸­æŒ‡å®šçš„â€œæ„å»ºâ€æ–‡ä»¶ï¼ˆ<strong><a href="http://build.rs">build.rs</a></strong>ï¼‰é¢„å…ˆè¿è¡Œã€‚ä½¿ç”¨ <strong>cc</strong> crateï¼Œå°†ç”Ÿæˆä¸€ä¸ªé™æ€åº“æ–‡ä»¶ï¼ˆæœ¬å®ä¾‹ä¸­ä¸º <strong>libhello.a</strong>ï¼Œè¯·å‚é˜… compile æ–‡æ¡£ï¼‰ï¼Œé€šè¿‡åœ¨ <code>extern</code> ä»£ç å—ä¸­å£°æ˜å¤–éƒ¨å‡½æ•°ç­¾åï¼Œç„¶åå°±å¯ä»¥ä» <strong>rust</strong> ä¸­è°ƒç”¨è¯¥é™æ€åº“ã€‚<br>â€ƒâ€ƒæœ¬å®ä¾‹ä¸­ç»‘å®šçš„ <strong>C</strong> è¯­è¨€æ–‡ä»¶éå¸¸ç®€å•ï¼Œåªéœ€è¦å°†ä¸€ä¸ªæºæ–‡ä»¶ä¼ é€’ç»™ <code>cc::Build</code>ã€‚å¯¹äºæ›´å¤æ‚çš„æ„å»ºéœ€æ±‚ï¼Œ<code>cc::Build</code> æä¾›äº†ä¸€æ•´å¥—æ„å»ºå™¨æ–¹æ³•ï¼Œç”¨äºæŒ‡å®šï¼ˆåŒ…å«ï¼‰<strong>include</strong>è·¯å¾„å’Œæ‰©å±•ç¼–è¯‘å™¨æ ‡å¿—ï¼ˆflagï¼‰ã€‚</p><ul><li>éœ€è¦å®‰è£…<code>cc</code>åº“,<code>Cargo.toml</code>æ–‡ä»¶å†…å®¹é…ç½®å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token key property">build</span> <span class="token punctuation">=</span> <span class="token string">"build.rs"</span><span class="token punctuation">[</span><span class="token table class-name">build-dependencies</span><span class="token punctuation">]</span><span class="token key property">cc</span> <span class="token punctuation">=</span> <span class="token string">"1"</span><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>build.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">cc<span class="token punctuation">::</span></span><span class="token class-name">Build</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"src/hello.c"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// è¾“å‡º `libhello.a`</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/hello.c</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello from C!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"ä½ å¥½, %s!\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/main.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">CString</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>os<span class="token punctuation">::</span>raw<span class="token punctuation">::</span></span>c_char<span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">NulError</span><span class="token punctuation">(</span><span class="token punctuation">::</span><span class="token namespace">std<span class="token punctuation">::</span>ffi<span class="token punctuation">::</span></span><span class="token class-name">NulError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token punctuation">::</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">prompt</span><span class="token punctuation">(</span>s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Write</span><span class="token punctuation">;</span>    <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token function">stdout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> input <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token function">stdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read_line</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> input<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">greet</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token operator">*</span><span class="token keyword">const</span> c_char<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"ä½ å¨ƒå«å•¥? "</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> c_name <span class="token operator">=</span> <span class="token class-name">CString</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span> <span class="token function">greet</span><span class="token punctuation">(</span>c_name<span class="token punctuation">.</span><span class="token function">as_ptr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>,è¾“å…¥<strong>Rust</strong>ã€‚è¾“å‡ºå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Hello from C<span class="token operator">!</span>ä½ å¨ƒå«å•¥? Rustä½ å¥½, Rust<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æ³¨ï¼šè¿™é‡Œä¿®æ”¹<code>src/hello.c</code>æ–‡ä»¶å†…å®¹å,éœ€è¦åŒæ—¶ä¿®æ”¹<code>build.rs</code>ä¸­çš„å†…å®¹ï¼ˆå¯éšæ„ä¿®æ”¹åæ’¤å›å¹¶<strong>Ctrl+S</strong>ä¿å­˜ï¼‰ï¼Œå¦åˆ™è¿è¡Œæ—¶æ— æ³•è·å–æœ€æ–°ä¿®æ”¹åçš„ä¿¡æ¯ã€‚</li></ul><h3 id="3-2-ç¼–è¯‘å¹¶é™æ€é“¾æ¥åˆ°ç»‘å®šçš„-C-è¯­è¨€åº“">3.2 ç¼–è¯‘å¹¶é™æ€é“¾æ¥åˆ°ç»‘å®šçš„ <strong>C++</strong> è¯­è¨€åº“</h3><p>â€ƒâ€ƒé“¾æ¥ç»‘å®šçš„ <strong>C++</strong> è¯­è¨€åº“éå¸¸ç±»ä¼¼äºé“¾æ¥ç»‘å®šçš„ <strong>C</strong> è¯­è¨€åº“ã€‚ç¼–è¯‘å¹¶é™æ€é“¾æ¥ç»‘å®šçš„ <strong>C++</strong> åº“æ—¶ï¼Œä¸é“¾æ¥ç»‘å®šçš„ <strong>C</strong> è¯­è¨€åº“ç›¸æ¯”æœ‰ä¸¤ä¸ªæ ¸å¿ƒåŒºåˆ«ï¼šä¸€æ˜¯é€šè¿‡æ„é€ å™¨æ–¹æ³• <strong>cpp(true)</strong> æŒ‡å®š <strong>C++</strong> ç¼–è¯‘å™¨ï¼›äºŒæ˜¯é€šè¿‡åœ¨ <strong>C++</strong> æºæ–‡ä»¶é¡¶éƒ¨æ·»åŠ  <code>extern &quot;C&quot;</code> ä»£ç æ®µï¼Œä»¥é˜²æ­¢ <strong>C++</strong> ç¼–è¯‘å™¨çš„åç§°ç¯¡æ”¹ã€‚</p><ul><li><code>Cargo.toml</code>æ–‡ä»¶å†…å®¹é…ç½®å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token key property">build</span> <span class="token punctuation">=</span> <span class="token string">"build.rs"</span><span class="token punctuation">[</span><span class="token table class-name">build-dependencies</span><span class="token punctuation">]</span><span class="token key property">cc</span> <span class="token punctuation">=</span> <span class="token string">"1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>build.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">cc<span class="token punctuation">::</span></span><span class="token class-name">Build</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">cpp</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"src/foo.cpp"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/foo.cpp</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x<span class="token operator">*</span>y<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/main.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">multiply</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ä¹˜ç§¯ä¸ºï¼š&#123;&#125;"</span><span class="token punctuation">,</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ä¹˜ç§¯ä¸ºï¼š35<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-ç¼–è¯‘-C-è¯­è¨€åº“æ—¶è‡ªå®šä¹‰è®¾ç½®">3.3 ç¼–è¯‘ <strong>C</strong> è¯­è¨€åº“æ—¶è‡ªå®šä¹‰è®¾ç½®</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>cc::Build::define</code>è‡ªå®šä¹‰æ„å»ºç»‘å®šçš„ <strong>C</strong> è¯­è¨€ä»£ç éå¸¸ç®€å•ã€‚è¯¥æ–¹æ³•æ¥å— <code>Option</code> å€¼ï¼Œå› æ­¤å¯ä»¥åˆ›å»ºè¿™æ ·çš„å®šä¹‰ï¼š<code>#define APP_NAME &quot;foo&quot;</code>ã€<code>#define WELCOME</code>ï¼ˆå°† <code>None</code> ä½œä¸ºä¸ç¡®å®šå€¼ä¼ é€’ï¼‰ã€‚å¦‚ä¸‹å®ä¾‹æ„å»ºäº†ä¸€ä¸ªç»‘å®šçš„ <strong>C</strong> è¯­è¨€æ–‡ä»¶ï¼Œå…¶åœ¨ <strong><a href="http://build.rs">build.rs</a></strong> ä¸­è®¾ç½®äº†åŠ¨æ€å®šä¹‰ï¼Œå¹¶åœ¨è¿è¡Œæ—¶æ‰“å° â€œWelcome to foo - version 1.0.2â€ã€‚<strong>Cargo</strong> è®¾å®šäº†ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œè¿™äº›å˜é‡å¯èƒ½å¯¹æŸäº›è‡ªå®šä¹‰è®¾ç½®æœ‰ç”¨ã€‚</p><ul><li><code>Cargo.toml</code>æ–‡ä»¶å†…å®¹é…ç½®å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">package</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.1.0"</span><span class="token key property">build</span> <span class="token punctuation">=</span> <span class="token string">"build.rs"</span><span class="token punctuation">[</span><span class="token table class-name">build-dependencies</span><span class="token punctuation">]</span><span class="token key property">cc</span> <span class="token punctuation">=</span> <span class="token string">"1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>build.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">cc<span class="token punctuation">::</span></span><span class="token class-name">Build</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"APP_NAME"</span><span class="token punctuation">,</span> <span class="token string">"\"æ— å\""</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>            <span class="token string">"VERSION"</span><span class="token punctuation">,</span>            <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"\"&#123;&#125;\""</span><span class="token punctuation">,</span> <span class="token macro property">env!</span><span class="token punctuation">(</span><span class="token string">"CARGO_PKG_VERSION"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">as_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"WELCOME"</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"src/foo.c"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/foo.c</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">print_app_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">WELCOME</span></span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"æ¬¢è¿ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s - ç‰ˆæœ¬ %s\n"</span><span class="token punctuation">,</span> APP_NAME<span class="token punctuation">,</span> VERSION<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>src/main.rs</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">print_app_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">unsafe</span> <span class="token punctuation">&#123;</span>        <span class="token function">print_app_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ¬¢è¿ï¼šæ— å - ç‰ˆæœ¬ <span class="token number">0.1</span>.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘å…« æ—¥æœŸä¸æ—¶é—´</title>
      <link href="/news/1681654162938.html"/>
      <url>/news/1681654162938.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æœŸé—´å’Œè®¡ç®—">1. æœŸé—´å’Œè®¡ç®—</h2><h3 id="1-1-æµ‹é‡è¿è¡Œæ—¶é—´">1.1 æµ‹é‡è¿è¡Œæ—¶é—´</h3><p>â€ƒâ€ƒæµ‹é‡ä» <code>time::Instant::now</code> å¼€å§‹è¿è¡Œçš„æ—¶é—´ <code>time::Instant::elapsed</code>ã€‚è°ƒç”¨ <code>time::Instant::elapsed</code> å°†è¿”å› <code>time::Duration</code>ï¼Œåœ¨å®ä¾‹æœ«å°¾æ‰“å°è¯¥æ—¶é—´ã€‚æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹æˆ–è€…é‡ç½® <code>time::Instant</code> å¯¹è±¡ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Duration</span><span class="token punctuation">,</span> <span class="token class-name">Instant</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">expensive_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">expensive_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> duration <span class="token operator">=</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"expensive_function() å‡½æ•°è¿è¡Œçš„æ—¶é—´æ˜¯: &#123;:?&#125;"</span><span class="token punctuation">,</span> duration<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">expensive_function<span class="token punctuation">(</span><span class="token punctuation">)</span> å‡½æ•°è¿è¡Œçš„æ—¶é—´æ˜¯: <span class="token number">2</span>.000175481s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-æ‰§è¡Œæ—¥æœŸæ£€æŸ¥å’Œæ—¶é—´è®¡ç®—">1.2 æ‰§è¡Œæ—¥æœŸæ£€æŸ¥å’Œæ—¶é—´è®¡ç®—</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>chrono</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add chrono</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">chrono</span> <span class="token punctuation">=</span> <span class="token string">"0.4.24"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>DateTime::checked_add_signed</code> è®¡ç®—å¹¶æ˜¾ç¤ºä¸¤å‘¨ä¹‹åçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œä½¿ç”¨ <code>DateTime::checked_sub_signed</code> è®¡ç®—å¹¶æ˜¾ç¤ºå‰ä¸€å¤©çš„æ—¥æœŸã€‚å¦‚æœæ— æ³•è®¡ç®—å‡ºæ—¥æœŸå’Œæ—¶é—´ï¼Œè¿™äº›æ–¹æ³•å°†è¿”å› <code>None</code>ã€‚å¯ä»¥åœ¨ <code>chrono::format::strftime</code> ä¸­æ‰¾åˆ°é€‚ç”¨äº <code>DateTime::format</code> çš„è½¬ä¹‰åºåˆ—ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">DateTime</span><span class="token punctuation">,</span> <span class="token class-name">Duration</span><span class="token punctuation">,</span> <span class="token class-name">Utc</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">day_earlier</span><span class="token punctuation">(</span>date_time<span class="token punctuation">:</span> <span class="token class-name">DateTime</span><span class="token operator">&lt;</span><span class="token class-name">Utc</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">DateTime</span><span class="token operator">&lt;</span><span class="token class-name">Utc</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>    date_time<span class="token punctuation">.</span><span class="token function">checked_sub_signed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">days</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Utc</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> almost_three_weeks_from_now <span class="token operator">=</span> now        <span class="token punctuation">.</span><span class="token function">checked_add_signed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">weeks</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>in_2weeks<span class="token closure-punctuation punctuation">|</span></span> in_2weeks<span class="token punctuation">.</span><span class="token function">checked_add_signed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">weeks</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and_then</span><span class="token punctuation">(</span>day_earlier<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">match</span> almost_three_weeks_from_now <span class="token punctuation">&#123;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"å°†è¿‘ä¸‰å‘¨å!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">match</span> now<span class="token punctuation">.</span><span class="token function">checked_add_signed</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">max_value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"æˆ‘ä»¬ä¸èƒ½ç”¨ chrono æ¥åˆ¤æ–­å¤ªé˜³ç³»ç»•é“¶æ²³ä¸­å¿ƒå®Œæˆè¶…è¿‡ä¸€åœˆå®Œæ•´è½¨é“çš„æ—¶é—´."</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2023</span>-04-16 <span class="token number">13</span>:23:26.368785736 UTC<span class="token number">2023</span>-05-07 <span class="token number">13</span>:23:26.368785736 UTCæˆ‘ä»¬ä¸èƒ½ç”¨ chrono æ¥åˆ¤æ–­å¤ªé˜³ç³»ç»•é“¶æ²³ä¸­å¿ƒå®Œæˆè¶…è¿‡ä¸€åœˆå®Œæ•´è½¨é“çš„æ—¶é—´.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-3-æ—¶é—´çš„æ—¶åŒºè½¬æ¢">1.3 æ—¶é—´çš„æ—¶åŒºè½¬æ¢</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>offset::Local::now</code> è·å–æœ¬åœ°æ—¶é—´å¹¶æ˜¾ç¤ºï¼Œç„¶åä½¿ç”¨ <code>DateTime::from_utc</code> ç»“æ„ä½“æ–¹æ³•å°†å…¶è½¬æ¢ä¸º <code>UTC</code> æ ‡å‡†æ ¼å¼ã€‚æœ€åï¼Œä½¿ç”¨ <code>offset::FixedOffset</code> ç»“æ„ä½“ï¼Œå¯ä»¥å°† <code>UTC</code> æ—¶é—´è½¬æ¢ä¸º <code>UTC+8</code> å’Œ <code>UTC-2</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">DateTime</span><span class="token punctuation">,</span> <span class="token class-name">FixedOffset</span><span class="token punctuation">,</span> <span class="token class-name">Local</span><span class="token punctuation">,</span> <span class="token class-name">Utc</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> local_time <span class="token operator">=</span> <span class="token class-name">Local</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> utc_time <span class="token operator">=</span> <span class="token class-name">DateTime</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Utc</span><span class="token operator">></span><span class="token punctuation">::</span><span class="token function">from_utc</span><span class="token punctuation">(</span>local_time<span class="token punctuation">.</span><span class="token function">naive_utc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Utc</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> china_timezone <span class="token operator">=</span> <span class="token class-name">FixedOffset</span><span class="token punctuation">::</span><span class="token function">east_opt</span><span class="token punctuation">(</span><span class="token number">8</span> <span class="token operator">*</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rio_timezone <span class="token operator">=</span> <span class="token class-name">FixedOffset</span><span class="token punctuation">::</span><span class="token function">west_opt</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç°åœ¨å½“åœ°æ—¶é—´æ˜¯ &#123;&#125;"</span><span class="token punctuation">,</span> local_time<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"UTC æ—¶é—´ç°åœ¨æ˜¯&#123;&#125;"</span><span class="token punctuation">,</span> utc_time<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç°åœ¨é¦™æ¸¯æ—¶é—´æ˜¯ &#123;&#125;"</span><span class="token punctuation">,</span> utc_time<span class="token punctuation">.</span><span class="token function">with_timezone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>china_timezone<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"ç°åœ¨é‡Œçº¦çƒ­å†…å¢æ—¶é—´æ˜¯ &#123;&#125;"</span><span class="token punctuation">,</span>        utc_time<span class="token punctuation">.</span><span class="token function">with_timezone</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>rio_timezone<span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ç°åœ¨å½“åœ°æ—¶é—´æ˜¯ <span class="token number">2023</span>-04-16 <span class="token number">13</span>:31:33.619954917 +00:00UTC æ—¶é—´ç°åœ¨æ˜¯2023-04-16 <span class="token number">13</span>:31:33.619954917 UTCç°åœ¨é¦™æ¸¯æ—¶é—´æ˜¯ <span class="token number">2023</span>-04-16 <span class="token number">21</span>:31:33.619954917 +08:00ç°åœ¨é‡Œçº¦çƒ­å†…å¢æ—¶é—´æ˜¯ <span class="token number">2023</span>-04-16 <span class="token number">11</span>:31:33.619954917 <span class="token parameter variable">-02:00</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-è§£æä¸æ˜¾ç¤º">2. è§£æä¸æ˜¾ç¤º</h2><h3 id="2-1-æ£€æŸ¥æ—¥æœŸå’Œæ—¶é—´">2.1 æ£€æŸ¥æ—¥æœŸå’Œæ—¶é—´</h3><p>â€ƒâ€ƒé€šè¿‡ <code>Timelike</code> è·å–å½“å‰ <code>UTC DateTime</code> åŠå…¶æ—¶/åˆ†/ç§’ï¼Œé€šè¿‡ <code>Datelike</code> è·å–å…¶å¹´/æœˆ/æ—¥/å·¥ä½œæ—¥ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Datelike</span><span class="token punctuation">,</span> <span class="token class-name">Timelike</span><span class="token punctuation">,</span> <span class="token class-name">Utc</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> now <span class="token operator">=</span> <span class="token class-name">Utc</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>is_pm<span class="token punctuation">,</span> hour<span class="token punctuation">)</span> <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">hour12</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"å½“å‰çš„ UTC æ—¶é—´æ˜¯ &#123;:02&#125;:&#123;:02&#125;:&#123;:02&#125; &#123;&#125;"</span><span class="token punctuation">,</span>        hour<span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">minute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">second</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">if</span> is_pm <span class="token punctuation">&#123;</span> <span class="token string">"ä¸‹åˆ"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"ä¸Šåˆ"</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"è‡ªåˆå¤œä»¥æ¥å·²æœ‰ &#123;&#125; ç§’"</span><span class="token punctuation">,</span> now<span class="token punctuation">.</span><span class="token function">num_seconds_from_midnight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>is_common_era<span class="token punctuation">,</span> year<span class="token punctuation">)</span> <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">year_ce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"å½“å‰çš„ UTC æ—¶é—´æ˜¯ &#123;&#125;-&#123;:02&#125;-&#123;:02&#125; &#123;:?&#125; (&#123;&#125;)"</span><span class="token punctuation">,</span>        year<span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">month</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">day</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">weekday</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token keyword">if</span> is_common_era <span class="token punctuation">&#123;</span> <span class="token string">"AD"</span> <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token string">"BC"</span> <span class="token punctuation">&#125;</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å…¬å…ƒäº &#123;&#125; å¤©å‰å¼€å§‹"</span><span class="token punctuation">,</span> now<span class="token punctuation">.</span><span class="token function">num_days_from_ce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å½“å‰çš„ UTC æ—¶é—´æ˜¯ 01:39:35 ä¸‹åˆè‡ªåˆå¤œä»¥æ¥å·²æœ‰ <span class="token number">49175</span> ç§’å½“å‰çš„ UTC æ—¶é—´æ˜¯ <span class="token number">2023</span>-04-16 Sun <span class="token punctuation">(</span>AD<span class="token punctuation">)</span>å…¬å…ƒäº <span class="token number">738626</span> å¤©å‰å¼€å§‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-æ—¥æœŸå’Œ-UNIX-æ—¶é—´æˆ³çš„äº’ç›¸è½¬æ¢">2.2 æ—¥æœŸå’Œ <code>UNIX</code> æ—¶é—´æˆ³çš„äº’ç›¸è½¬æ¢</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>NaiveDateTime::timestamp</code> å°†ç”±<code>NaiveDate::from_ymd</code> ç”Ÿæˆçš„æ—¥æœŸå’Œç”± <code>NaiveTime::from_hms</code> ç”Ÿæˆçš„æ—¶é—´è½¬æ¢ä¸º <code>UNIX</code> æ—¶é—´æˆ³ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨ <code>NaiveDateTime::from_timestamp</code> è®¡ç®—è‡ª <code>UTC</code> æ—¶é—´ <strong>1970 å¹´ 01 æœˆ 01 æ—¥ 00:00:00</strong> å¼€å§‹çš„ <strong>20</strong> äº¿ç§’åçš„æ—¥æœŸã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">NaiveDate</span><span class="token punctuation">,</span> <span class="token class-name">NaiveDateTime</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> date_time<span class="token punctuation">:</span> <span class="token class-name">NaiveDateTime</span> <span class="token operator">=</span> <span class="token class-name">NaiveDate</span><span class="token punctuation">::</span><span class="token function">from_ymd_opt</span><span class="token punctuation">(</span><span class="token number">2023</span><span class="token punctuation">,</span> <span class="token number">04</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">and_hms_opt</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"1970-01-01 00:00:00 å’Œ &#123;&#125; ä¹‹é—´çš„ç§’æ•°æ˜¯ &#123;&#125;."</span><span class="token punctuation">,</span>        date_time<span class="token punctuation">,</span>        date_time<span class="token punctuation">.</span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> date_time_after_a_billion_seconds <span class="token operator">=</span>        <span class="token class-name">NaiveDateTime</span><span class="token punctuation">::</span><span class="token function">from_timestamp_opt</span><span class="token punctuation">(</span><span class="token number">20_0000_0000</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"äºŒåäº¿ç§’åçš„æ—¥æœŸä» 1970-01-01 00:00:00 æ˜¯ &#123;&#125;."</span><span class="token punctuation">,</span>        date_time_after_a_billion_seconds    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1970</span>-01-01 00:00:00 å’Œ <span class="token number">2023</span>-04-16 <span class="token number">17</span>:33:44 ä¹‹é—´çš„ç§’æ•°æ˜¯ <span class="token number">1681666424</span>.åäº¿ç§’åçš„æ—¥æœŸä» <span class="token number">1970</span>-01-01 00:00:00 æ˜¯ <span class="token number">2033</span>-05-18 03:33:20.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-3-æ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼åŒ–æ˜¾ç¤º">2.3 æ—¥æœŸå’Œæ—¶é—´çš„æ ¼å¼åŒ–æ˜¾ç¤º</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>Utc::now</code> è·å–å¹¶æ˜¾ç¤ºå½“å‰ <code>UTC</code> æ—¶é—´ã€‚ä½¿ç”¨ <code>DateTime::to_rfc2822</code> å°†å½“å‰æ—¶é—´æ ¼å¼åŒ–ä¸ºç†Ÿæ‚‰çš„ <code>RFC 2822</code> æ ¼å¼ï¼Œä½¿ç”¨ <code>DateTime::to_rfc3339</code> å°†å½“å‰æ—¶é—´æ ¼å¼åŒ–ä¸ºç†Ÿæ‚‰çš„ <code>RFC 3339</code> æ ¼å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>DateTime::format</code>è‡ªå®šä¹‰æ—¶é—´æ ¼å¼ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">DateTime</span><span class="token punctuation">,</span> <span class="token class-name">Utc</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> now<span class="token punctuation">:</span> <span class="token class-name">DateTime</span><span class="token operator">&lt;</span><span class="token class-name">Utc</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token class-name">Utc</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"UTC ç°åœ¨æ˜¯: &#123;&#125;"</span><span class="token punctuation">,</span> now<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç°åœ¨åœ¨ RFC 2822 ä¸­çš„ UTC æ˜¯: &#123;&#125;"</span><span class="token punctuation">,</span> now<span class="token punctuation">.</span><span class="token function">to_rfc2822</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç°åœ¨åœ¨ RFC 3339 ä¸­çš„ UTC æ˜¯: &#123;&#125;"</span><span class="token punctuation">,</span> now<span class="token punctuation">.</span><span class="token function">to_rfc3339</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"ç°åœ¨é‡‡ç”¨è‡ªå®šä¹‰æ ¼å¼çš„ UTC æ˜¯: &#123;&#125;"</span><span class="token punctuation">,</span>        now<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"%Y:%m:%d %H:%M:%S"</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">UTC ç°åœ¨æ˜¯: <span class="token number">2023</span>-04-16 <span class="token number">13</span>:52:53.430260493 UTCç°åœ¨åœ¨ RFC <span class="token number">2822</span> ä¸­çš„ UTC æ˜¯: Sun, <span class="token number">16</span> Apr <span class="token number">2023</span> <span class="token number">13</span>:52:53 +0000ç°åœ¨åœ¨ RFC <span class="token number">3339</span> ä¸­çš„ UTC æ˜¯: <span class="token number">2023</span>-04-16T13:52:53.430260493+00:00ç°åœ¨é‡‡ç”¨è‡ªå®šä¹‰æ ¼å¼çš„ UTC æ˜¯: <span class="token number">2023</span>:04:16 <span class="token number">13</span>:52:53<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-å°†å­—ç¬¦ä¸²è§£æä¸º-DateTime-ç»“æ„ä½“">2.4 å°†å­—ç¬¦ä¸²è§£æä¸º DateTime ç»“æ„ä½“</h3><p>â€ƒâ€ƒæ—¶é—´æ ¼å¼ <code>RFC 2822</code>ã€<code>RFC 3339</code>ï¼Œä»¥åŠè‡ªå®šä¹‰æ—¶é—´æ ¼å¼ï¼Œé€šå¸¸ç”¨å­—ç¬¦ä¸²è¡¨è¾¾ã€‚è¦å°†è¿™äº›å­—ç¬¦ä¸²è§£æä¸º <code>DateTime</code> ç»“æ„ä½“ï¼Œå¯ä»¥åˆ†åˆ«ç”¨ <code>DateTime::parse_from_rfc2822</code>ã€<code>DateTime::parse_from_rfc3339</code>ï¼Œä»¥åŠ <code>DateTime::parse_from_str</code>ã€‚å¯ä»¥åœ¨ <code>chrono::format::strftime</code> ä¸­æ‰¾åˆ°é€‚ç”¨äº <code>DateTime::parse_from_str</code> çš„è½¬ä¹‰åºåˆ—ã€‚æ³¨æ„ï¼š<code>DateTime::parse_from_str</code> è¦æ±‚è¿™äº› <code>DateTime</code> ç»“æ„ä½“å¿…é¡»æ˜¯å¯åˆ›å»ºçš„ï¼Œä»¥ä¾¿å®ƒå”¯ä¸€åœ°æ ‡è¯†æ—¥æœŸå’Œæ—¶é—´ã€‚è¦è§£æä¸å¸¦æ—¶åŒºçš„æ—¥æœŸå’Œæ—¶é—´ï¼Œè¯·ä½¿ç”¨ <code>NaiveDate</code>ã€<code>NaiveTime</code>ï¼Œä»¥åŠ <code>NaiveDateTime</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span>format<span class="token punctuation">::</span></span><span class="token class-name">ParseError</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">DateTime</span><span class="token punctuation">,</span> <span class="token class-name">NaiveDate</span><span class="token punctuation">,</span> <span class="token class-name">NaiveDateTime</span><span class="token punctuation">,</span> <span class="token class-name">NaiveTime</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ParseError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> rfc2822 <span class="token operator">=</span> <span class="token class-name">DateTime</span><span class="token punctuation">::</span><span class="token function">parse_from_rfc2822</span><span class="token punctuation">(</span><span class="token string">"Wed, 18 Feb 2015 23:16:09 GMT"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//éƒ¨åˆ†æ— æ³•è§£æ</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> rfc2822<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rfc3339 <span class="token operator">=</span> <span class="token class-name">DateTime</span><span class="token punctuation">::</span><span class="token function">parse_from_rfc3339</span><span class="token punctuation">(</span><span class="token string">"1896-12-19T16:39:57-08:00"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> rfc3339<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> custom <span class="token operator">=</span>        <span class="token class-name">DateTime</span><span class="token punctuation">::</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span><span class="token string">"5.8.2022 8:00 am +0000"</span><span class="token punctuation">,</span> <span class="token string">"%d.%m.%Y %H:%M %P %z"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> custom<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> time_only <span class="token operator">=</span> <span class="token class-name">NaiveTime</span><span class="token punctuation">::</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span><span class="token string">"23:56:04"</span><span class="token punctuation">,</span> <span class="token string">"%H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> time_only<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> date_only <span class="token operator">=</span> <span class="token class-name">NaiveDate</span><span class="token punctuation">::</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span><span class="token string">"2023-09-05"</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> date_only<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> no_timezone <span class="token operator">=</span>        <span class="token class-name">NaiveDateTime</span><span class="token punctuation">::</span><span class="token function">parse_from_str</span><span class="token punctuation">(</span><span class="token string">"2022-12-05 23:56:04"</span><span class="token punctuation">,</span> <span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> no_timezone<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">2015</span>-02-18 <span class="token number">23</span>:16:09 +00:00<span class="token number">1896</span>-12-19 <span class="token number">16</span>:39:57 <span class="token parameter variable">-08:00</span><span class="token number">2022</span>-08-05 08:00:00 +00:00<span class="token number">23</span>:56:04<span class="token number">2023</span>-09-05<span class="token number">2022</span>-12-05 <span class="token number">23</span>:56:04<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘ä¸ƒ æ•°æ®åº“</title>
      <link href="/news/1681570373600.html"/>
      <url>/news/1681570373600.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-SQLite">1. SQLite</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>rusqlite</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add rusqlite --features bundled</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">rusqlite</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"0.29.0"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"bundled"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-1-åˆ›å»º-SQLite-æ•°æ®åº“">1.1 åˆ›å»º SQLite æ•°æ®åº“</h3><p>â€ƒâ€ƒä½¿ç”¨<code>rusqlite</code> <code>crate</code> æ‰“å¼€ <code>SQLite</code> æ•°æ®åº“è¿æ¥ã€‚å¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œ<code>Connection::open</code>æ–¹æ³•å°†åˆ›å»ºå®ƒã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// use rusqlite::NO_PARAMS; å·²å¼ƒç”¨ï¼šæ”¹ç”¨ç©ºæ•°ç»„;stmt.executeï¼ˆNO_PARAMSï¼‰ => stmt.executeï¼ˆ[]ï¼‰</span><span class="token keyword">use</span> <span class="token namespace">rusqlite<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Connection</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> conn <span class="token operator">=</span> <span class="token class-name">Connection</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"cats.db"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    conn<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>        <span class="token string">"create table if not exists cat_colors (             id integer primary key,             name text not null unique         )"</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    conn<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>        <span class="token string">"create table if not exists cats (             id integer primary key,             name text not null,             color_id integer not null references cat_colors(id)         )"</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>ç”Ÿæˆcats.dbæ–‡ä»¶</li></ul><h3 id="1-2-æ•°æ®æ’å…¥å’ŒæŸ¥è¯¢">1.2 æ•°æ®æ’å…¥å’ŒæŸ¥è¯¢</h3><p>â€ƒâ€ƒ<code>Connection::open</code> å°†æ‰“å¼€åœ¨å‰ä¸€ç« èŠ‚å®ä¾‹ä¸­åˆ›å»ºçš„æ•°æ®åº“ <code>cats</code> çš„è¿æ¥ã€‚ä¸‹é¢çš„å®ä¾‹ä½¿ç”¨ <code>Connection</code> çš„ <code>execute</code> æ–¹æ³•å°†æ•°æ®æ’å…¥ <code>cat_colors</code> å’Œ <code>cats</code> ä¸¤å¼ è¡¨ä¸­ã€‚é¦–å…ˆï¼Œå°†æ•°æ®æ’å…¥åˆ° <code>cat_colors</code> è¡¨ä¸­ã€‚éšåï¼Œä½¿ç”¨ <code>Connection</code> çš„ <code>last_insert_rowid</code> æ–¹æ³•æ¥è·å– <code>cat_colors</code> è¡¨æœ€åæ’å…¥è®°å½•çš„ <code>id</code>ã€‚å½“å‘ <code>cats</code> è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œä½¿ç”¨æ­¤ <code>id</code>ã€‚ç„¶åï¼Œä½¿ç”¨ <code>prepare</code> æ–¹æ³•å‡†å¤‡æ‰§è¡Œ <code>select</code> æŸ¥è¯¢æ“ä½œï¼Œè¯¥æ–¹æ³•æä¾› <code>statement</code> ç»“æ„ä½“ã€‚æœ€åï¼Œä½¿ç”¨ <code>statement</code> çš„ <code>query_map</code> æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rusqlite<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Connection</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Debug)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Cat</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    color<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> conn <span class="token operator">=</span> <span class="token class-name">Connection</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"cats.db"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> cat_colors <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cat_colors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Blue"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"Tigger"</span><span class="token punctuation">,</span> <span class="token string">"Sammy"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    cat_colors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Black"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token string">"Oreo"</span><span class="token punctuation">,</span> <span class="token string">"Biscuit"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>color<span class="token punctuation">,</span> catnames<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>cat_colors <span class="token punctuation">&#123;</span>        conn<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>            <span class="token string">"INSERT INTO cat_colors (name) values (?1)"</span><span class="token punctuation">,</span>            <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>color<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> last_id<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">last_insert_rowid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> cat <span class="token keyword">in</span> catnames <span class="token punctuation">&#123;</span>            conn<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>                <span class="token string">"INSERT INTO cats (name, color_id) values (?1, ?2)"</span><span class="token punctuation">,</span>                <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>cat<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>last_id<span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepare</span><span class="token punctuation">(</span>        <span class="token string">"SELECT c.name, cc.name from cats c         INNER JOIN cat_colors cc         ON cc.id = c.color_id;"</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> cats <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">query_map</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>row<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>            name<span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> cat <span class="token keyword">in</span> cats <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ‰¾åˆ°çŒ« &#123;:?&#125;"</span><span class="token punctuation">,</span> cat<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ‰¾åˆ°çŒ« Ok<span class="token punctuation">(</span>Cat <span class="token punctuation">&#123;</span> name: <span class="token string">"Oreo"</span>, color: <span class="token string">"Black"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>æ‰¾åˆ°çŒ« Ok<span class="token punctuation">(</span>Cat <span class="token punctuation">&#123;</span> name: <span class="token string">"Biscuit"</span>, color: <span class="token string">"Black"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>æ‰¾åˆ°çŒ« Ok<span class="token punctuation">(</span>Cat <span class="token punctuation">&#123;</span> name: <span class="token string">"Tigger"</span>, color: <span class="token string">"Blue"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>æ‰¾åˆ°çŒ« Ok<span class="token punctuation">(</span>Cat <span class="token punctuation">&#123;</span> name: <span class="token string">"Sammy"</span>, color: <span class="token string">"Blue"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-äº‹åŠ¡å¤„ç†">1.3 äº‹åŠ¡å¤„ç†</h3><p>â€ƒâ€ƒ<code>Connection::open</code> å°†æ‰“å¼€æ¥è‡ªå‰è¿°å®ä¾‹çš„æ•°æ®åº“ <code>cats.db</code>ã€‚ä½¿ç”¨ <code>Connection::transaction</code> å¼€å§‹äº‹åŠ¡ï¼Œé™¤éä½¿ç”¨ <code>Transaction::commit</code> æ˜¾å¼æäº¤ï¼Œå¦åˆ™äº‹åŠ¡å°†å›æ»šã€‚åœ¨ä¸‹é¢çš„å®ä¾‹ä¸­ï¼Œé¢œè‰²è¡¨å¯¹é¢œè‰²åç§°å…·æœ‰å”¯ä¸€æ€§çº¦æŸã€‚å½“å°è¯•æ’å…¥é‡å¤çš„é¢œè‰²æ—¶ï¼Œäº‹åŠ¡ä¼šå›æ»šã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rusqlite<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Connection</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> conn <span class="token operator">=</span> <span class="token class-name">Connection</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"cats.db"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token function">successful_tx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> conn<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token function">rolled_back_tx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> conn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span><span class="token function">is_err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">successful_tx</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Connection</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> tx <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"delete from cat_colors"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"insert into cat_colors (name) values (?1)"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"lavender"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"insert into cat_colors (name) values (?1)"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">rolled_back_tx</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">Connection</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> tx <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"delete from cat_colors"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"insert into cat_colors (name) values (?1)"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"lavender"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"insert into cat_colors (name) values (?1)"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"blue"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">"insert into cat_colors (name) values (?1)"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span><span class="token string">"lavender"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    tx<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡º</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Error: SqliteFailure<span class="token punctuation">(</span>Error <span class="token punctuation">&#123;</span> code: ConstraintViolation, extended_code: <span class="token number">787</span> <span class="token punctuation">&#125;</span>, Some<span class="token punctuation">(</span><span class="token string">"FOREIGN KEY constraint failed"</span><span class="token punctuation">))</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-Postgres-æš‚æœªæµ‹è¯•">2. Postgres (æš‚æœªæµ‹è¯•)</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>postgres</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add postgres</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">postgres</span> <span class="token punctuation">=</span> <span class="token string">"0.19.5"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-1-Postgres-æ•°æ®åº“ä¸­åˆ›å»ºè¡¨">2.1 Postgres æ•°æ®åº“ä¸­åˆ›å»ºè¡¨</h3><p>â€ƒâ€ƒ<code>Postgres</code> æ•°æ®åº“ä¸­ï¼Œä½¿ç”¨ <code>postgres</code> <code>crate</code> åˆ›å»ºè¡¨ã€‚<br><code>Client::connect</code>ç”¨äºè¿æ¥åˆ°ç°æœ‰æ•°æ®åº“ã€‚æœ¬å®ä¾‹ä¸­ä½¿ç”¨ <code>Client::connect</code> æ ¼å¼åŒ–è¿æ¥æ•°æ®åº“çš„ URL å­—ç¬¦ä¸²ã€‚å‡è®¾å­˜åœ¨ä¸€ä¸ªæ•°æ®åº“ï¼šåä¸º <code>library</code>ï¼Œç”¨æˆ·åä¸º <code>postgres</code>ï¼Œå¯†ç ä¸º <code>postgres</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">postgres<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"postgresql://postgres:postgres@localhost/library"</span><span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token comment">// let mut client = Client::connect("host=localhost user=postgres", NoTls)?; //å¾…æµ‹ï¼Œå®˜æ–¹è¿æ¥æ•°æ®åº“ç¤ºä¾‹</span>        client<span class="token punctuation">.</span><span class="token function">batch_execute</span><span class="token punctuation">(</span><span class="token string">"        CREATE TABLE IF NOT EXISTS author (            id              SERIAL PRIMARY KEY,            name            VARCHAR NOT NULL,            country         VARCHAR NOT NULL            )    "</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    client<span class="token punctuation">.</span><span class="token function">batch_execute</span><span class="token punctuation">(</span><span class="token string">"        CREATE TABLE IF NOT EXISTS book  (            id              SERIAL PRIMARY KEY,            title           VARCHAR NOT NULL,            author_id       INTEGER NOT NULL REFERENCES author            )    "</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-æ•°æ®æ’å…¥å’ŒæŸ¥è¯¢">2.2 æ•°æ®æ’å…¥å’ŒæŸ¥è¯¢</h3><p>â€ƒâ€ƒä¸‹è¿°å®ä¾‹ä¸­ä½¿ç”¨ <code>Client</code> çš„ <code>execute</code> æ–¹æ³•å°†æ•°æ®æ’å…¥åˆ° <code>author</code> è¡¨ä¸­ã€‚ç„¶åï¼Œä½¿ç”¨ <code>Client</code> çš„ <code>query</code> æ–¹æ³•æŸ¥è¯¢ <code>author</code> è¡¨ä¸­çš„æ•°æ®ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">postgres<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Author</span> <span class="token punctuation">&#123;</span>    _id<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    country<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">"postgresql://postgres:postgres@localhost/library"</span><span class="token punctuation">,</span>                                     <span class="token class-name">NoTls</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> <span class="token keyword">mut</span> authors <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    authors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Chinua Achebe"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"Nigeria"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    authors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Rabindranath Tagore"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"India"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    authors<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"Anita Nair"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"India"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>authors <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> author <span class="token operator">=</span> <span class="token class-name">Author</span> <span class="token punctuation">&#123;</span>            _id<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> key<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            country<span class="token punctuation">:</span> value<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        client<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>                <span class="token string">"INSERT INTO author (name, country) VALUES ($1, $2)"</span><span class="token punctuation">,</span>                <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token operator">&amp;</span>author<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token operator">&amp;</span>author<span class="token punctuation">.</span>country<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">"SELECT id, name, country FROM author"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> author <span class="token operator">=</span> <span class="token class-name">Author</span> <span class="token punctuation">&#123;</span>            _id<span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            name<span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            country<span class="token punctuation">:</span> row<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Author &#123;&#125; is from &#123;&#125;"</span><span class="token punctuation">,</span> author<span class="token punctuation">.</span>name<span class="token punctuation">,</span> author<span class="token punctuation">.</span>country<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-æ•°æ®èšåˆ">2.3 æ•°æ®èšåˆ</h3><p>â€ƒâ€ƒä¸‹è¿°å®ä¾‹æŒ‰ç…§é™åºåˆ—å‡ºäº†<a href="https://github.com/MuseumofModernArt/collection/blob/master/Artists.csv">ç¾å›½çº½çº¦å·ç°ä»£è‰ºæœ¯åšç‰©é¦†</a>æ•°æ®åº“ä¸­é¦–æ‰¹ 7999 ä½è‰ºæœ¯å®¶çš„å›½ç±ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">postgres<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">,</span> <span class="token class-name">NoTls</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Nation</span> <span class="token punctuation">&#123;</span>    nationality<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    count<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">connect</span><span class="token punctuation">(</span>        <span class="token string">"postgresql://postgres:postgres@127.0.0.1/moma"</span><span class="token punctuation">,</span>        <span class="token class-name">NoTls</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> row <span class="token keyword">in</span> client<span class="token punctuation">.</span><span class="token function">query</span>     <span class="token punctuation">(</span><span class="token string">"SELECT nationality, COUNT(nationality) AS count     FROM artists GROUP BY nationality ORDER BY count DESC"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">let</span> <span class="token punctuation">(</span>nationality<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i64</span><span class="token operator">></span><span class="token punctuation">)</span>         <span class="token operator">=</span> <span class="token punctuation">(</span>row<span class="token punctuation">.</span><span class="token function">get</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> row<span class="token punctuation">.</span><span class="token function">get</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> nationality<span class="token punctuation">.</span><span class="token function">is_some</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> count<span class="token punctuation">.</span><span class="token function">is_some</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> nation <span class="token operator">=</span> <span class="token class-name">Nation</span><span class="token punctuation">&#123;</span>                nationality<span class="token punctuation">:</span> nationality<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                count<span class="token punctuation">:</span> count<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; &#123;&#125;"</span><span class="token punctuation">,</span> nation<span class="token punctuation">.</span>nationality<span class="token punctuation">,</span> nation<span class="token punctuation">.</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘å…­ æ•°æ®ç»“æ„</title>
      <link href="/news/1681480076711.html"/>
      <url>/news/1681480076711.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä½åŸŸ">1. ä½åŸŸ</h2><h3 id="1-1-å®šä¹‰å¹¶æ“ä½œä½åŸŸé£æ ¼çš„ç±»å‹">1.1 å®šä¹‰å¹¶æ“ä½œä½åŸŸé£æ ¼çš„ç±»å‹</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>bitflags</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add bitflags</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">bitflags</span> <span class="token punctuation">=</span> <span class="token string">"2.1.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒå¦‚ä¸‹å®ä¾‹åœ¨ <code>bitflags!</code> å®çš„å¸®åŠ©ä¸‹åˆ›å»ºç±»å‹å®‰å…¨çš„ä½åŸŸç±»å‹ <code>MyFlags</code>ï¼Œå¹¶ä¸ºå…¶å®ç°åŸºæœ¬çš„æ¸…ç†æ“ä½œï¼ˆ<code>clear</code> æ–¹æ³•ï¼‰ä»¥åŠ <code>Display trait</code>ã€‚éšåï¼Œå±•ç¤ºäº†åŸºæœ¬çš„æŒ‰ä½æ“ä½œå’Œæ ¼å¼åŒ–ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">bitflags<span class="token punctuation">::</span></span>bitflags<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fmt<span class="token punctuation">;</span><span class="token comment">// å®šä¹‰ MyFlags æšä¸¾ç±»å‹ï¼Œè¡¨ç¤ºä¸€ä¸ª 32 ä½äºŒè¿›åˆ¶æ ‡å¿—ä½</span><span class="token macro property">bitflags!</span> <span class="token punctuation">&#123;</span>    <span class="token attribute attr-name">#[derive(Clone, Copy, PartialEq, Eq, Debug )]</span>    <span class="token keyword">struct</span> <span class="token type-definition class-name">MyFlags</span><span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token constant">FLAG_A</span>       <span class="token operator">=</span> <span class="token number">0b00000001</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸€ä½æ ‡å¿—ä½è¡¨ç¤º FLAG_A</span>        <span class="token keyword">const</span> <span class="token constant">FLAG_B</span>       <span class="token operator">=</span> <span class="token number">0b00000010</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬äºŒä½æ ‡å¿—ä½è¡¨ç¤º FLAG_B</span>        <span class="token keyword">const</span> <span class="token constant">FLAG_C</span>       <span class="token operator">=</span> <span class="token number">0b00000100</span><span class="token punctuation">;</span> <span class="token comment">// ç¬¬ä¸‰ä½æ ‡å¿—ä½è¡¨ç¤º FLAG_C</span>        <span class="token keyword">const</span> <span class="token constant">FLAG_ABC</span>     <span class="token operator">=</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token constant">FLAG_A</span><span class="token punctuation">.</span><span class="token function">bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// FLAG_ABC è¡¨ç¤º FLAG_Aã€FLAG_B å’Œ FLAG_C çš„é›†åˆ</span>                           <span class="token operator">|</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token constant">FLAG_B</span><span class="token punctuation">.</span><span class="token function">bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                           <span class="token operator">|</span> <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token constant">FLAG_C</span><span class="token punctuation">.</span><span class="token function">bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">MyFlags</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å®ç° clear æ–¹æ³•ï¼Œæ¸…ç©ºæ ‡å¿—ä½</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">clear</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">MyFlags</span> <span class="token punctuation">&#123;</span>        <span class="token operator">*</span><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">bits_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// å°† MyFlags å¯¹åº”çš„ u32 ç±»å‹å…¨éƒ¨ç½®ä¸º 0</span>        <span class="token keyword">self</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Display</span> <span class="token keyword">for</span> <span class="token class-name">MyFlags</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å®ç° fmt::Display traitï¼Œä½¿å¾— MyFlags ç±»å‹å¯ä»¥è¢«æ ¼å¼åŒ–è¾“å‡º</span>    <span class="token keyword">fn</span> <span class="token function-definition function">fmt</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> f<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token namespace">std<span class="token punctuation">::</span>fmt<span class="token punctuation">::</span></span><span class="token class-name">Formatter</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token namespace">fmt<span class="token punctuation">::</span></span><span class="token class-name">Result</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">write!</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span> <span class="token string">"&#123;:032b&#125;"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">bits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å°† MyFlags è½¬æ¢ä¸º 32 ä½äºŒè¿›åˆ¶æ•°è¾“å‡º</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æšä¸¾ç±»å‹å¯ä»¥åƒæ•´æ•°ä¸€æ ·è¿›è¡ŒæŒ‰ä½è¿ç®—</span>    <span class="token keyword">let</span> e1 <span class="token operator">=</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_A</span> <span class="token operator">|</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_C</span><span class="token punctuation">;</span> <span class="token comment">// e1 åŒ…å« FLAG_A å’Œ FLAG_C</span>    <span class="token keyword">let</span> e2 <span class="token operator">=</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_B</span> <span class="token operator">|</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_C</span><span class="token punctuation">;</span> <span class="token comment">// e2 åŒ…å« FLAG_B å’Œ FLAG_C</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1 <span class="token operator">|</span> e2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_ABC</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e1 å’Œ e2 çš„å¹¶é›†åŒ…å« FLAG_ABC</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1 <span class="token operator">&amp;</span> e2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_C</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e1 å’Œ e2 çš„äº¤é›†åŒ…å« FLAG_C</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e1 <span class="token operator">-</span> e2<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_A</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e1 å‡å» e2 çš„å·®é›†åŒ…å« FLAG_A</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token operator">!</span>e2<span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_A</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e2 çš„è¡¥é›†ä¸åŒ…å« FLAG_A</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> flags <span class="token operator">=</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_ABC</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> flags<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"00000000000000000000000000000111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º MyFlags ä¸º 32 ä½äºŒè¿›åˆ¶æ•°</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> flags<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"00000000000000000000000000000000"</span> <span class="token comment">// æ¸…ç©º MyFlagsï¼Œè¾“å‡º 0</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_B</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"MyFlags(FLAG_B)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡º MyFlags æšä¸¾ç±»å‹</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_A</span> <span class="token operator">|</span> <span class="token class-name">MyFlags</span><span class="token punctuation">::</span><span class="token constant">FLAG_B</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token string">"MyFlags(FLAG_A | FLAG_B)"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒæˆåŠŸ</li></ul>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å¦‚ä½•ç™¾ç§‘ã€‘Ubuntuç¦»çº¿å®‰è£…MiniKube</title>
      <link href="/news/1681466985497.html"/>
      <url>/news/1681466985497.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å·¥å…·åŒ…å‡†å¤‡">1. å·¥å…·åŒ…å‡†å¤‡</h2><p>â€ƒâ€ƒå®‰è£…æœºå™¨æ¶æ„ Ubuntu16.04 AMD64<br>â€ƒâ€ƒdockerçš„å®‰è£…è¿‡ç¨‹è¯¦è§æ–‡ç« ï¼š<a href="https://www.taissan.com/news/1678175207403.html">ã€å¦‚ä½•ç™¾ç§‘ã€‘Ubuntu å®‰è£…æœ€æ–° docker</a></p><h3 id="1-1-Minekube-ä¸‹è½½">1.1 Minekube ä¸‹è½½</h3><ul><li>å®˜æ–¹äºŒè¿›åˆ¶ä¸‹è½½åœ°å€<a href="https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64/">ä¸‹è½½é“¾æ¥</a></li><li>å®˜æ–¹ Deb åŒ…ä¸‹è½½åœ°å€<a href="https://storage.googleapis.com/minikube/releases/latest/minikube_latest_amd64.deb/">ä¸‹è½½é“¾æ¥</a></li><li>å®˜æ–¹ RPM åŒ…ä¸‹è½½åœ°å€<a href="https://storage.googleapis.com/minikube/releases/latest/minikube-latest.x86_64.rpm/">ä¸‹è½½é“¾æ¥</a></li></ul><h3 id="1-2-helm-ä¸‹è½½">1.2 helm ä¸‹è½½</h3><ul><li>å®˜æ–¹äºŒè¿›åˆ¶åŒ…ä¸‹è½½åœ°å€<a href="https://get.helm.sh/helm-v3.11.3-linux-amd64.tar.gz">ä¸‹è½½é“¾æ¥</a></li><li>å®˜æ–¹ Deb åŒ…ä¸‹è½½åœ°å€<a href="https://helm.baltorepo.com/stable/debian/packages/helm/releases/3.11.2-1/files/helm_3.11.2-1_amd64.deb/">ä¸‹è½½é“¾æ¥</a></li></ul><h3 id="1-3-kubernetes-ç›¸å…³å‘½ä»¤å·¥å…·ä¸‹è½½-è‡³å°‘éœ€è¦ä¸‹è½½ä»¥ä¸‹ä¸‰ä¸ªå·¥å…·">1.3 kubernetes ç›¸å…³å‘½ä»¤å·¥å…·ä¸‹è½½,è‡³å°‘éœ€è¦ä¸‹è½½ä»¥ä¸‹ä¸‰ä¸ªå·¥å…·</h3><p>â€ƒâ€ƒæœ¬æ–‡ä»¥ v1.26.3 ç‰ˆæœ¬ä¸ºä¸»ã€‚<a href="https://www.downloadkubernetes.com/">ä¸‹è½½åœ°å€</a></p><ul><li>kubectl</li><li>kubelet</li><li>kubeadm</li></ul><h2 id="2-minikube-é•œåƒå‡†å¤‡">2. minikube é•œåƒå‡†å¤‡</h2><h3 id="2-1-ä¸‹è½½-minikube-å¿…éœ€çš„-9-ä¸ªé•œåƒ">2.1 ä¸‹è½½ minikube å¿…éœ€çš„ 9 ä¸ªé•œåƒ</h3><ul><li><code>gcr.io/k8s-minikube/kicbase:v0.0.39</code></li><li><code>gcr.io/k8s-minikube/storage-provisioner:v5</code></li><li><code>registry.k8s.io/kube-apiserver:v1.26.3</code></li><li><code>registry.k8s.io/kube-controller-manager:v1.26.3</code></li><li><code>registry.k8s.io/kube-scheduler:v1.26.3</code></li><li><code>registry.k8s.io/kube-proxy:v1.26.3</code></li><li><code>registry.k8s.io/etcd:3.5.6-0</code></li><li><code>registry.k8s.io/pause:3.9</code></li><li><code>registry.k8s.io/coredns/coredns:v1.9.3</code></li></ul><h3 id="2-2-éƒ¨ç½²-minikube-dashboard-çš„-2-ä¸ªé•œåƒ-å¯é€‰">2.2 éƒ¨ç½² minikube dashboard çš„ 2 ä¸ªé•œåƒ(å¯é€‰)</h3><ul><li><code>kubernetesui/dashboard:v2.7.0</code></li><li><code>kubernetesui/metrics-scraper:v1.0.8</code></li></ul><h3 id="2-3-é•œåƒä¸‹è½½æ–¹æ³•">2.3 é•œåƒä¸‹è½½æ–¹æ³•</h3><ul><li>(1). é€šè¿‡ WSL çš„ <code>docker pull</code> å‘½ä»¤ä¸‹è½½å¹¶å¯¼å‡ºä¸º tar åŒ…</li><li>(2). é€šè¿‡ python è„šæœ¬ä¸‹è½½ tar åŒ…(ä»…æ”¯æŒ docker v2 æ¸…å•çš„é•œåƒ)ï¼Œè„šæœ¬å‚è€ƒï¼š<a href="https://github.com/NotGlop/docker-drag">https://github.com/NotGlop/docker-drag</a></li></ul><h2 id="3-minikube-éƒ¨ç½²">3. minikube éƒ¨ç½²</h2><ul><li>å°†ä¹‹å‰ä¸‹è½½çš„æ‰€æœ‰é•œåƒ tar åŒ…åŠå·¥å…·åŒ…ä¸Šä¼ åˆ°ä¸»æœºä¸Š</li></ul><h3 id="3-1-å®‰è£…æ‰€æœ‰é•œåƒ">3.1 å®‰è£…æ‰€æœ‰é•œåƒ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> load <span class="token parameter variable">-i</span> *.tar<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-å®‰è£…æ‰€éœ€å·¥å…·-root-æƒé™">3.2 å®‰è£…æ‰€éœ€å·¥å…·(root æƒé™)</h3><ul><li>å®‰è£… minikube(deb åŒ…)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dpkg <span class="token parameter variable">-i</span> minikube_latest_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å®‰è£… helm(deb åŒ…)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dpkg <span class="token parameter variable">-i</span> helm_3.11.2-1_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å®‰è£… kubectl(äºŒè¿›åˆ¶)</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">install</span> <span class="token parameter variable">-o</span> root <span class="token parameter variable">-g</span> root <span class="token parameter variable">-m</span> 0755 kubectl /usr/local/bin/kubectl<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-ä¸º-minikube-æ–°å»ºç”¨æˆ·">3.3 ä¸º minikube æ–°å»ºç”¨æˆ·</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># æ–°å»ºä¸€ä¸ªminikubeç”¨æˆ·</span>adduser minikube<span class="token comment"># æ–°å»ºä¸€ä¸ªdockerç”¨æˆ·ç»„</span><span class="token function">groupadd</span> <span class="token function">docker</span><span class="token comment"># å°†minikubeæ·»åŠ åˆ°dockerç»„</span><span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> minikube<span class="token comment"># å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°è¯¥dockerç»„(root)</span><span class="token function">usermod</span> <span class="token parameter variable">-aG</span> <span class="token function">docker</span> <span class="token environment constant">$USER</span><span class="token comment"># é‡å¯docker</span><span class="token function">service</span> <span class="token function">docker</span> restart<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-ä½¿ç”¨-minikube-ç”¨æˆ·å¯åŠ¨-minikubeã€‚éœ€è¦é‡å¯-2-æ¬¡">3.4 ä½¿ç”¨ minikube ç”¨æˆ·å¯åŠ¨ minikubeã€‚éœ€è¦é‡å¯ 2 æ¬¡</h3><ul><li>ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>.minikube/cache/linux/amd64/v1.26.3</code>çš„ç›®å½•,ä½†ç”±äºæ£€æµ‹ä¸åˆ°<code>kubectl</code>ç­‰å·¥å…·ï¼Œæ•…ä¼šä»¥å¤±è´¥å‘Šç»ˆã€‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">minikube start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å°†ä¹‹å‰ä¸‹è½½çš„ 3 ä¸ªå‘½ä»¤å·¥å…·(<code>kubectl,kubelet,kubeadm</code>) æ‹·è´åˆ°ç”¨æˆ·ç›®å½•çš„ <code>.minikube/cache/linux/amd64/v1.26.3</code> ç›®å½•ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> tools/* .minikube/cache/linux/amd64/v1.26.3/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>æ‰§è¡Œç¬¬äºŒæ¬¡å¯åŠ¨</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">minikube start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¾…ç³»ç»Ÿè¾“å‡ºä»¥ä¸‹å†…å®¹åˆ™è¯´æ˜ minikube å®‰è£…å®Œæˆ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Done<span class="token operator">!</span> kubectl is now configured to use <span class="token string">"minikube"</span> cluster and <span class="token string">"default"</span> namespace by default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ä¸‡æ³•å¤©ä¹¦ </category>
          
          <category> å¦‚ä½•ç™¾ç§‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> minikube </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘äº” å¯†ç å­¦</title>
      <link href="/news/1681401209555.html"/>
      <url>/news/1681401209555.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰">1. æ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰</h2><h3 id="1-1-è®¡ç®—æ–‡ä»¶çš„-SHA-256-æ‘˜è¦">1.1 è®¡ç®—æ–‡ä»¶çš„ SHA-256 æ‘˜è¦</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>ring</code>,<code>data-encoding</code>,<code>error-chain</code> åº“ï¼Œå¯é€šè¿‡<code>cargo add ring</code>,<code>cargo add data-encoding</code> ,<code>cargo add error-chain</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">data-encoding</span> <span class="token punctuation">=</span> <span class="token string">"2.3.3"</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">ring</span> <span class="token punctuation">=</span> <span class="token string">"0.16.20"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä»¥ä¸‹å®ä¾‹ä¸­ï¼Œå…ˆåˆ›å»ºæ–‡ä»¶ï¼Œå†™å…¥ä¸€äº›æ•°æ®ã€‚ç„¶åä½¿ç”¨ <code>digest::Context</code> è®¡ç®—æ–‡ä»¶å†…å®¹çš„ <code>SHA-256</code> æ‘˜è¦ <code>digest::Digest</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">data_encoding<span class="token punctuation">::</span></span><span class="token constant">HEXUPPER</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>digest<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Context</span><span class="token punctuation">,</span> <span class="token class-name">Digest</span><span class="token punctuation">,</span> <span class="token constant">SHA256</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">,</span> <span class="token class-name">Write</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Decode</span><span class="token punctuation">(</span><span class="token namespace">data_encoding<span class="token punctuation">::</span></span><span class="token class-name">DecodeError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">sha256_digest</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Read</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token keyword">mut</span> reader<span class="token punctuation">:</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Digest</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> context <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token constant">SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> count <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        context<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token punctuation">..</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"file.txt"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> output <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">write!</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token string">"æˆ‘ä»¬å°†ç”Ÿæˆæ­¤æ–‡æœ¬çš„æ‘˜è¦"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> reader <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> digest <span class="token operator">=</span> <span class="token function">sha256_digest</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"SHA-256 æ‘˜è¦æ˜¯ &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">HEXUPPER</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>digest<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SHA-256 æ‘˜è¦æ˜¯ 765E79C9E2677BCA5A050906AF635703BAC1A725EC63701285A907A263182EC2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2-ä½¿ç”¨-HMAC-æ‘˜è¦å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯">1.2. ä½¿ç”¨ HMAC æ‘˜è¦å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åå’ŒéªŒè¯</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>ring::hmac</code> åˆ›å»ºå­—ç¬¦ä¸²çš„ç­¾å <code>hmac::Signature</code>ï¼Œç„¶åéªŒè¯ç­¾åæ˜¯å¦æ­£ç¡®ã€‚HMACè¿ç®—åˆ©ç”¨hashç®—æ³•ï¼Œä»¥ä¸€ä¸ªæ¶ˆæ¯Må’Œä¸€ä¸ªå¯†é’¥Kä½œä¸ºè¾“å…¥ï¼Œç”Ÿæˆä¸€ä¸ªå®šé•¿çš„æ¶ˆæ¯æ‘˜è¦ä½œä¸ºè¾“å‡ºã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Unspecified</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>rand<span class="token punctuation">::</span></span><span class="token class-name">SecureRandom</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>hmac<span class="token punctuation">,</span> rand<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Unspecified</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> key_value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">SystemRandom</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    rng<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> key_value<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token namespace">hmac<span class="token punctuation">::</span></span><span class="token class-name">Key</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">hmac<span class="token punctuation">::</span></span><span class="token constant">HMAC_SHA256</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>key_value<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> message <span class="token operator">=</span> <span class="token string">"åˆæ³•è€Œéå¸¸é‡è¦çš„ä¿¡æ¯ã€‚"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> signature <span class="token operator">=</span> <span class="token namespace">hmac<span class="token punctuation">::</span></span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">hmac<span class="token punctuation">::</span></span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>key<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> signature<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>éªŒè¯.</li></ul><h2 id="2-åŠ å¯†">2. åŠ å¯†</h2><h3 id="2-1-ä½¿ç”¨-PBKDF2-å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼ˆsaltï¼‰å’Œæ•£åˆ—ï¼ˆhashï¼‰è¿ç®—">2.1 ä½¿ç”¨ <code>PBKDF2</code> å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ï¼ˆ<code>salt</code>ï¼‰å’Œæ•£åˆ—ï¼ˆ<code>hash</code>ï¼‰è¿ç®—</h3><p>â€ƒâ€ƒå¯¹äºé€šè¿‡ <code>PBKDF2</code> å¯†é’¥æ´¾ç”Ÿå‡½æ•° <code>pbkdf2::derive</code> ç”Ÿæˆçš„åŠ å¯†ï¼ˆåŠ ç›ç®—æ³•ï¼‰å¯†ç ï¼Œä½¿ç”¨ <code>ring::pbkdf2</code> è¿›è¡Œæ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰è¿ç®—ï¼Œä½¿ç”¨ <code>pbkdf2::verify</code> éªŒè¯æ•£åˆ—ï¼ˆå“ˆå¸Œï¼‰è¿ç®—æ˜¯å¦æ­£ç¡®ã€‚<code>salt</code> å€¼æ˜¯ä½¿ç”¨ <code>SecureRandom::fill</code> ç”Ÿæˆçš„ï¼Œ<code>salt</code> å­—èŠ‚æ•°ç»„è¢«å…¶å®‰å…¨ç”Ÿæˆçš„éšæœºæ•°å¡«å……ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// å¯¼å…¥éœ€è¦ç”¨åˆ°çš„åº“</span><span class="token keyword">use</span> <span class="token namespace">data_encoding<span class="token punctuation">::</span></span><span class="token constant">HEXUPPER</span><span class="token punctuation">;</span> <span class="token comment">// HEXUPPER æ•°æ®ç¼–ç åº“</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Unspecified</span><span class="token punctuation">;</span> <span class="token comment">// Ring åº“ä¸­çš„é”™è¯¯ç±»å‹ Unspecified</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>rand<span class="token punctuation">::</span></span><span class="token class-name">SecureRandom</span><span class="token punctuation">;</span> <span class="token comment">// ä¸€ä¸ªå®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>digest<span class="token punctuation">,</span> pbkdf2<span class="token punctuation">,</span> rand<span class="token punctuation">&#125;</span><span class="token punctuation">;</span> <span class="token comment">// Ring åº“ä¸­çš„æ‘˜è¦ã€PBKDF2 å’Œéšæœºæ•°æ¨¡å—</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>num<span class="token punctuation">::</span></span><span class="token class-name">NonZeroU32</span><span class="token punctuation">;</span> <span class="token comment">// éé›¶çš„ u32 ç±»å‹</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Unspecified</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å®šä¹‰å¸¸é‡ CREDENTIAL_LENï¼Œå¹¶èµ‹å€¼ä¸º SHA512 è¾“å‡ºçš„é•¿åº¦</span>    <span class="token keyword">const</span> <span class="token constant">CREDENTIAL_LEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token namespace">digest<span class="token punctuation">::</span></span><span class="token constant">SHA512_OUTPUT_LEN</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰ NonZeroU32 ç±»å‹å˜é‡ n_iterï¼Œèµ‹å€¼ä¸º 100000</span>    <span class="token keyword">let</span> n_iter <span class="token operator">=</span> <span class="token class-name">NonZeroU32</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">100_000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// åˆ›å»ºç³»ç»Ÿéšæœºæ•°ç”Ÿæˆå™¨ rng</span>    <span class="token keyword">let</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">SystemRandom</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰é•¿åº¦ä¸º CREDENTIAL_LEN çš„æ•°ç»„ saltï¼Œå¹¶ç”¨éšæœºæ•°ç”Ÿæˆå™¨ rng å¡«å……</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> salt <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token constant">CREDENTIAL_LEN</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    rng<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> salt<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰å­—ç¬¦ä¸²å˜é‡ passwordï¼Œå¹¶èµ‹å€¼ä¸º "Guess Me If You Can!"</span>    <span class="token keyword">let</span> password <span class="token operator">=</span> <span class="token string">"Guess Me If You Can!"</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰é•¿åº¦ä¸º CREDENTIAL_LEN çš„æ•°ç»„ pbkdf2_hashï¼Œå¹¶ä½¿ç”¨ PBKDF2 ç®—æ³•å’Œ salt ä»¥åŠ password çš„å­—èŠ‚æ•°ç»„å¡«å……è¯¥æ•°ç»„</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> pbkdf2_hash <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0u8</span><span class="token punctuation">;</span> <span class="token constant">CREDENTIAL_LEN</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token function">derive</span><span class="token punctuation">(</span>        <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token constant">PBKDF2_HMAC_SHA512</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨ HMAC-SHA512 ç®—æ³•</span>        n_iter<span class="token punctuation">,</span>        <span class="token operator">&amp;</span>salt<span class="token punctuation">,</span>        password<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span><span class="token keyword">mut</span> pbkdf2_hash<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ‰“å° salt å’Œ pbkdf2_hash çš„åå…­è¿›åˆ¶ç¼–ç </span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Salt: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">HEXUPPER</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>salt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"PBKDF2 hash: &#123;&#125;"</span><span class="token punctuation">,</span> <span class="token constant">HEXUPPER</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pbkdf2_hash<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ PBKDF2 ç®—æ³•ã€salt å’Œ password çš„å­—èŠ‚æ•°ç»„éªŒè¯ pbkdf2_hash æ˜¯å¦æ­£ç¡®</span>    <span class="token keyword">let</span> should_succeed <span class="token operator">=</span> <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token function">verify</span><span class="token punctuation">(</span>        <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token constant">PBKDF2_HMAC_SHA512</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨ HMAC-SHA512 ç®—æ³•</span>        n_iter<span class="token punctuation">,</span>        <span class="token operator">&amp;</span>salt<span class="token punctuation">,</span>        password<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span>pbkdf2_hash<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å®šä¹‰å­—ç¬¦ä¸²å˜é‡ wrong_passwordï¼Œå¹¶èµ‹å€¼ä¸º "Definitely not the correct password"</span>    <span class="token keyword">let</span> wrong_password <span class="token operator">=</span> <span class="token string">"Definitely not the correct password"</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ PBKDF2 ç®—æ³•ã€salt å’Œ wrong_password çš„å­—èŠ‚æ•°ç»„éªŒè¯ pbkdf2_hash æ˜¯å¦æ­£ç¡®</span>    <span class="token keyword">let</span> should_fail <span class="token operator">=</span> <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token function">verify</span><span class="token punctuation">(</span>        <span class="token namespace">pbkdf2<span class="token punctuation">::</span></span><span class="token constant">PBKDF2_HMAC_SHA512</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨ HMAC-SHA512 ç®—æ³•</span>        n_iter<span class="token punctuation">,</span>        <span class="token operator">&amp;</span>salt<span class="token punctuation">,</span>        wrong_password<span class="token punctuation">.</span><span class="token function">as_bytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token operator">&amp;</span>pbkdf2_hash<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ assert! å®åˆ¤æ–­ should_succeed æ˜¯å¦æˆåŠŸ</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>should_succeed<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// ä½¿ç”¨ assert! å®åˆ¤æ–­ should_fail æ˜¯å¦å¤±è´¥</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>should_fail<span class="token punctuation">.</span><span class="token function">is_ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å¦‚æœç¨‹åºæ²¡æœ‰å‘ç”Ÿé”™è¯¯</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼Œæ²¡æœ‰æŠ¥é”™ï¼Œè¯´æ˜éªŒè¯æˆåŠŸï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Salt: CDC7242F11C2AEF4F5091F88CDD63C2D07871ACA0B13A8E9AB458DFF9F2BC7B441F5F250A9C81FB4E006286E08504F0AD7698AF8EC8F03D58AB99706051D1BAEPBKDF2 hash: 6F547321949A89DA4A91BAD3FB1E5ACE48D0CAA57453221A82BD6CA4EA0E840FEFF2756070CB81978EBC9AFAB6017B050BF8A1D4909888470BCFA31494FBEE30<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘å›› å¹¶è¡Œ/å¹¶å‘</title>
      <link href="/news/1680865445147.html"/>
      <url>/news/1680865445147.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ˜¾å¼çº¿ç¨‹">1. æ˜¾å¼çº¿ç¨‹</h2><h3 id="1-1-ç”ŸæˆçŸ­æœŸçº¿ç¨‹">1.1 ç”ŸæˆçŸ­æœŸçº¿ç¨‹</h3><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>crossbeam</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add crossbeam</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">crossbeam</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>crossbeam</code> crate ä¸ºå¹¶å‘å’Œå¹¶è¡Œç¼–ç¨‹æä¾›äº†æ•°æ®ç»“æ„å’Œå‡½æ•°ã€‚<code>Scope::spawn</code> ç”Ÿæˆä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸçº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ç¡®ä¿ä¼ å…¥ <code>crossbeam::scope</code> å‡½æ•°çš„é—­åŒ…åœ¨è¿”å›ä¹‹å‰ç»ˆæ­¢ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä»è°ƒç”¨çš„å‡½æ•°ä¸­å¼•ç”¨æ•°æ®ã€‚</p><ul><li>æœ¬å®ä¾‹å°†æ•°ç»„ä¸€åˆ†ä¸ºäºŒï¼Œå¹¶åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¹¶è¡Œè®¡ç®—ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">crossbeam</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> max <span class="token operator">=</span> <span class="token function">find_max</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">find_max</span><span class="token punctuation">(</span>arr<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token constant">THRESHOLD</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token constant">THRESHOLD</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cloned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> mid <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">split_at</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token namespace">crossbeam<span class="token punctuation">::</span></span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> thread_l <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">find_max</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> thread_r <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token function">find_max</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> max_l <span class="token operator">=</span> thread_l<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">let</span> max_r <span class="token operator">=</span> thread_r<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>max_l<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max_r<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>æ ¡éªŒ</li></ul><h3 id="1-2-åˆ›å»ºå¹¶å‘çš„æ•°æ®ç®¡é“">1.2. åˆ›å»ºå¹¶å‘çš„æ•°æ®ç®¡é“</h3><p>â€ƒâ€ƒåœ¨ç« èŠ‚1.1åŸºç¡€ä¸Šå†æ¬¡å®‰è£…<code>crossbeam-channel</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add crossbeam-channel</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">crossbeam</span> <span class="token punctuation">=</span> <span class="token string">"0.8.2"</span><span class="token key property">crossbeam-channel</span> <span class="token punctuation">=</span> <span class="token string">"0.5.7"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>crossbeam</code> å’Œ <code>crossbeam-channel</code> ä¸¤ä¸ª crate åˆ›å»ºäº†ä¸€ä¸ªå¹¶è¡Œçš„ç®¡é“ã€‚ç®¡é“æœ‰ä¸€ä¸ªæ•°æ®æºå’Œä¸€ä¸ªæ•°æ®æ¥æ”¶å™¨ï¼Œæ•°æ®åœ¨ä»æºåˆ°æ¥æ”¶å™¨çš„è¿‡ç¨‹ä¸­ç”±ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹å¹¶è¡Œå¤„ç†ã€‚<br>â€ƒâ€ƒä½¿ç”¨å®¹é‡ç”± <code>crossbeam_channel::bounded</code> åˆ†é…çš„æœ‰ç•Œä¿¡é“ã€‚ç”Ÿäº§è€…å¿…é¡»åœ¨å®ƒè‡ªå·±çš„çº¿ç¨‹ä¸Šï¼Œå› ä¸ºå®ƒäº§ç”Ÿçš„æ¶ˆæ¯æ¯”å·¥ä½œçº¿ç¨‹å¤„ç†å®ƒä»¬çš„é€Ÿåº¦å¿«ï¼ˆå› ä¸ºå·¥ä½œçº¿ç¨‹ä¼‘çœ äº†åŠç§’ï¼‰â€”â€”è¿™æ„å‘³ç€ç”Ÿäº§è€…å°†åœ¨å¯¹ <code>[crossbeam_channel::Sender::send]</code> è°ƒç”¨æ—¶é˜»å¡åŠç§’ï¼Œç›´åˆ°å…¶ä¸­ä¸€ä¸ªå·¥ä½œçº¿ç¨‹å¯¹ä¿¡é“ä¸­çš„æ•°æ®å¤„ç†å®Œæ¯•ã€‚ä¹Ÿè¯·æ³¨æ„ï¼Œä¿¡é“ä¸­çš„æ•°æ®ç”±æœ€å…ˆæ¥æ”¶å®ƒçš„ä»»ä½•å·¥ä½œçº¿ç¨‹è°ƒç”¨ï¼Œå› æ­¤æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼ é€’ç»™å•ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œè€Œä¸æ˜¯ä¼ é€’ç»™ä¸¤ä¸ªå·¥ä½œçº¿ç¨‹ã€‚</p><p>â€ƒâ€ƒé€šè¿‡è¿­ä»£å™¨ <code>crossbeam_channel::Receiver::iter</code>æ–¹æ³•ä»ä¿¡é“è¯»å–æ•°æ®ï¼Œè¿™å°†ä¼šé€ æˆé˜»å¡ï¼Œè¦ä¹ˆç­‰å¾…æ–°æ¶ˆæ¯ï¼Œè¦ä¹ˆç›´åˆ°ä¿¡é“å…³é—­ã€‚å› ä¸ºä¿¡é“æ˜¯åœ¨ <code>crossbeam::scope</code>èŒƒå›´å†…åˆ›å»ºçš„ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡ <code>drop</code> æ‰‹åŠ¨å…³é—­å®ƒä»¬ï¼Œä»¥é˜²æ­¢æ•´ä¸ªç¨‹åºé˜»å¡å·¥ä½œçº¿ç¨‹çš„ <code>for</code> å¾ªç¯ã€‚å¯ä»¥å°†å¯¹ <code>drop</code> çš„è°ƒç”¨è§†ä½œä¸å†å‘é€æ¶ˆæ¯çš„ä¿¡å·ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">crossbeam</span><span class="token punctuation">;</span><span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">crossbeam_channel</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">crossbeam_channel<span class="token punctuation">::</span></span>bounded<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>thread<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>send1<span class="token punctuation">,</span> recv1<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">bounded</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>send2<span class="token punctuation">,</span> recv2<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">bounded</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> n_msgs <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> n_workers <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token namespace">crossbeam<span class="token punctuation">::</span></span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç”Ÿäº§è€…çº¿ç¨‹</span>        s<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>n_msgs <span class="token punctuation">&#123;</span>                send1<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å‘é€æ¥æº &#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">// å…³é—­ä¿¡é“ â€”â€” è¿™æ˜¯é€€å‡ºçš„å¿…è¦æ¡ä»¶</span>            <span class="token comment">// for å·¡æµ·åœ¨å·¥ä½œçº¿ç¨‹ä¸­</span>            <span class="token function">drop</span><span class="token punctuation">(</span>send1<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”± 2 ä¸ªçº¿ç¨‹å¹¶è¡Œå¤„ç†</span>        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>n_workers <span class="token punctuation">&#123;</span>            <span class="token comment">// ä»æ•°æ®æºå‘é€æ•°æ®åˆ°æ¥æ”¶å™¨ï¼Œæ¥æ”¶å™¨æ¥æ”¶æ•°æ®</span>            <span class="token keyword">let</span> <span class="token punctuation">(</span>sendr<span class="token punctuation">,</span> recvr<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>send2<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> recv1<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­è¡ç”Ÿå·¥äºº</span>            s<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>                <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// æ¥æ”¶æ•°æ®ï¼Œç›´åˆ°ä¿¡é“å…³é—­å‰</span>                <span class="token keyword">for</span> msg <span class="token keyword">in</span> recvr<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å·¥ä½œçº¿ç¨‹ &#123;:?&#125; æ¥å—åˆ° &#123;&#125;. å¹¶äºˆä»¥ç™¾å€å¥‰è¿˜"</span><span class="token punctuation">,</span> <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>                    sendr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// å…³é—­ä¿¡é“ï¼Œå¦åˆ™æ¥æ”¶å™¨ä¸ä¼šå…³é—­</span>        <span class="token comment">// é€€å‡º for å¾ªå</span>        <span class="token function">drop</span><span class="token punctuation">(</span>send2<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¥æ”¶å™¨</span>        <span class="token keyword">for</span> msg <span class="token keyword">in</span> recv2<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"è¿”å›åˆ°æ¥æ”¶å™¨ &#123;&#125;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å‘é€æ¥æº <span class="token number">0</span>å·¥ä½œçº¿ç¨‹ ThreadId<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> æ¥å—åˆ° <span class="token number">0</span>. å¹¶äºˆä»¥ç™¾å€å¥‰è¿˜å·¥ä½œçº¿ç¨‹ ThreadId<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> æ¥å—åˆ° <span class="token number">1</span>. å¹¶äºˆä»¥ç™¾å€å¥‰è¿˜è¿”å›åˆ°æ¥æ”¶å™¨ <span class="token number">0</span>è¿”å›åˆ°æ¥æ”¶å™¨ <span class="token number">100</span>å‘é€æ¥æº <span class="token number">1</span>å‘é€æ¥æº <span class="token number">2</span>å·¥ä½œçº¿ç¨‹ ThreadId<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> æ¥å—åˆ° <span class="token number">2</span>. å¹¶äºˆä»¥ç™¾å€å¥‰è¿˜å‘é€æ¥æº <span class="token number">3</span>è¿”å›åˆ°æ¥æ”¶å™¨ <span class="token number">200</span>å·¥ä½œçº¿ç¨‹ ThreadId<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> æ¥å—åˆ° <span class="token number">3</span>. å¹¶äºˆä»¥ç™¾å€å¥‰è¿˜è¿”å›åˆ°æ¥æ”¶å™¨ <span class="token number">300</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’æ•°æ®">1.3 åœ¨ä¸¤ä¸ªçº¿ç¨‹é—´ä¼ é€’æ•°æ®</h3><p>â€ƒâ€ƒåœ¨å•ç”Ÿäº§è€…ã€å•æ¶ˆè´¹è€…ï¼ˆSPSCï¼‰ç¯å¢ƒä¸­ä½¿ç”¨ <code>crossbeam-channel</code>ã€‚æˆ‘ä»¬æ„å»ºçš„ç”ŸæˆçŸ­æœŸçº¿ç¨‹å®ä¾‹ä¸­ï¼Œä½¿ç”¨ <code>crossbeam::scope</code> å’Œ <code>Scope::spawn</code> æ¥ç®¡ç†ç”Ÿäº§è€…çº¿ç¨‹ã€‚åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´ï¼Œä½¿ç”¨ <code>crossbeam_channel::unbounded</code> ä¿¡é“äº¤æ¢æ•°æ®ï¼Œè¿™æ„å‘³ç€å¯å­˜å‚¨æ¶ˆæ¯çš„æ•°é‡æ²¡æœ‰é™åˆ¶ã€‚ç”Ÿäº§è€…çº¿ç¨‹åœ¨æ¶ˆæ¯ä¹‹é—´ä¼‘çœ åŠç§’ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>thread<span class="token punctuation">,</span> time<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">crossbeam_channel<span class="token punctuation">::</span></span>unbounded<span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>snd<span class="token punctuation">,</span> rcv<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">unbounded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> n_msgs <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>    <span class="token namespace">crossbeam<span class="token punctuation">::</span></span><span class="token function">scope</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        s<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>n_msgs <span class="token punctuation">&#123;</span>                snd<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token namespace">thread<span class="token punctuation">::</span></span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token namespace">time<span class="token punctuation">::</span></span><span class="token class-name">Duration</span><span class="token punctuation">::</span><span class="token function">from_millis</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>n_msgs <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> msg <span class="token operator">=</span> rcv<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ”¶åˆ° &#123;&#125;"</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ”¶åˆ° <span class="token number">0</span>æ”¶åˆ° <span class="token number">1</span>æ”¶åˆ° <span class="token number">2</span>æ”¶åˆ° <span class="token number">3</span>æ”¶åˆ° <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-4-ä¿æŒå…¨å±€å¯å˜çŠ¶æ€">1.4 ä¿æŒå…¨å±€å¯å˜çŠ¶æ€</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>lazy_static</code> å£°æ˜å…¨å±€çŠ¶æ€ã€‚<code>lazy_static</code> åˆ›å»ºäº†ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ <code>static ref</code>ï¼Œå®ƒéœ€è¦ <code>Mutex</code> æ¥å…è®¸å˜åŒ–ï¼ˆè¯·å‚é˜… <code>RwLock</code>ï¼‰ã€‚åœ¨ <code>Mutex</code> çš„åŒ…è£¹ä¸‹ï¼Œä¿è¯äº†çŠ¶æ€ä¸èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ï¼Œä»è€Œé˜²æ­¢å‡ºç°äº‰ç”¨æƒ…å†µã€‚å¿…é¡»è·å– <code>MutexGuard</code>ï¼Œæ–¹å¯è¯»å–æˆ–æ›´æ”¹å­˜å‚¨åœ¨ <code>Mutex</code> ä¸­çš„å€¼ã€‚</p><p>æ­¤å°èŠ‚éœ€è¦å®‰è£…<code>lazy_static</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add lazy_static</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">lazy_static</span> <span class="token punctuation">=</span> <span class="token string">"1.4.0"</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">lazy_static<span class="token punctuation">::</span></span>lazy_static<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Mutex</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token macro property">lazy_static!</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">FRUIT</span><span class="token punctuation">:</span> <span class="token class-name">Mutex</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">>></span> <span class="token operator">=</span> <span class="token class-name">Mutex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">insert</span><span class="token punctuation">(</span>fruit<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> db <span class="token operator">=</span> <span class="token constant">FRUIT</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token string">"Failed to acquire MutexGuard"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    db<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fruit<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"è‹¹æœ"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"æ©˜å­"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"æ¢¨"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> db <span class="token operator">=</span> <span class="token constant">FRUIT</span><span class="token punctuation">.</span><span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token string">"Failed to acquire MutexGuard"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        db<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">enumerate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;: &#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"è‘¡è„"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">0</span>: è‹¹æœ<span class="token number">1</span>: æ©˜å­<span class="token number">2</span>: æ¢¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-5-å¯¹æ‰€æœ‰-iso-æ–‡ä»¶çš„-SHA256-å€¼å¹¶å‘æ±‚å’Œ">1.5 å¯¹æ‰€æœ‰ <code>iso</code> æ–‡ä»¶çš„ <code>SHA256</code> å€¼å¹¶å‘æ±‚å’Œ</h3><p>â€ƒâ€ƒè®¡ç®—äº†å½“å‰ç›®å½•ä¸­æ¯ä¸ªæ‰©å±•åä¸º <code>iso</code> çš„æ–‡ä»¶çš„ <code>SHA256</code> å“ˆå¸Œå€¼ã€‚çº¿ç¨‹æ± ç”Ÿæˆçš„çº¿ç¨‹æ•°ä¸ä½¿ç”¨ <code>num_cpus::get</code> è·å–çš„ç³»ç»Ÿå†…æ ¸æ•°ç›¸ç­‰ã€‚<code>Walkdir::new</code> éå†å½“å‰ç›®å½•ï¼Œå¹¶è°ƒç”¨ <code>execute</code> æ¥æ‰§è¡Œè¯»å–å’Œè®¡ç®— <code>SHA256</code> å“ˆå¸Œå€¼çš„æ“ä½œã€‚</p><p>æ­¤å°èŠ‚éœ€è¦å®‰è£…å¤šä¸ªåº“</p><ul><li><code>threadpool</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add threadpool</code> å‘½ä»¤å®‰è£…</li><li><code>num_cpus</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add num_cpus</code> å‘½ä»¤å®‰è£…</li><li><code>walkdir</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add walkdir</code> å‘½ä»¤å®‰è£…</li><li><code>ring</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add ring</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">ring</span> <span class="token punctuation">=</span> <span class="token string">"0.16.20"</span><span class="token key property">walkdir</span> <span class="token punctuation">=</span> <span class="token string">"2.3.3"</span><span class="token key property">num_cpus</span> <span class="token punctuation">=</span> <span class="token string">"1.15.0"</span><span class="token key property">threadpool</span> <span class="token punctuation">=</span> <span class="token string">"1.8.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">walkdir<span class="token punctuation">::</span></span><span class="token class-name">WalkDir</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">BufReader</span><span class="token punctuation">,</span> <span class="token class-name">Read</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">threadpool<span class="token punctuation">::</span></span><span class="token class-name">ThreadPool</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span>mpsc<span class="token punctuation">::</span></span>channel<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">ring<span class="token punctuation">::</span>digest<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Context</span><span class="token punctuation">,</span> <span class="token class-name">Digest</span><span class="token punctuation">,</span> <span class="token constant">SHA256</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">// Verify the iso extension</span><span class="token keyword">fn</span> <span class="token function-definition function">is_iso</span><span class="token punctuation">(</span>entry<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Path</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">bool</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">match</span> entry<span class="token punctuation">.</span><span class="token function">extension</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">if</span> e<span class="token punctuation">.</span><span class="token function">to_string_lossy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_lowercase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"iso"</span> <span class="token operator">=></span> <span class="token boolean">true</span><span class="token punctuation">,</span>        _ <span class="token operator">=></span> <span class="token boolean">false</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">compute_digest</span><span class="token operator">&lt;</span><span class="token class-name">P</span><span class="token punctuation">:</span> <span class="token class-name">AsRef</span><span class="token operator">&lt;</span><span class="token class-name">Path</span><span class="token operator">>></span><span class="token punctuation">(</span>filepath<span class="token punctuation">:</span> <span class="token class-name">P</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token class-name">Digest</span><span class="token punctuation">,</span> <span class="token class-name">P</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> buf_reader <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>filepath<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> context <span class="token operator">=</span> <span class="token class-name">Context</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token constant">SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> buffer <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> count <span class="token operator">=</span> buf_reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> buffer<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        context<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buffer<span class="token punctuation">[</span><span class="token punctuation">..</span>count<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> filepath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> pool <span class="token operator">=</span> <span class="token class-name">ThreadPool</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> entry <span class="token keyword">in</span> <span class="token class-name">WalkDir</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"/home/user/Downloads"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">follow_links</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> e<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">!</span>e<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_iso</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> path <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> tx <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            pool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">let</span> digest <span class="token operator">=</span> <span class="token function">compute_digest</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>                tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>digest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"æ— æ³•å‘é€æ•°æ®!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token function">drop</span><span class="token punctuation">(</span>tx<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> rx<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token punctuation">(</span>sha<span class="token punctuation">,</span> path<span class="token punctuation">)</span> <span class="token operator">=</span> t<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125; &#123;:?&#125;"</span><span class="token punctuation">,</span> sha<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœç±»ä¼¼äºå¦‚ä¸‹ç»“æœï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">SHA256:72e880f84a8cbc734160ca3b043c91b455ae5d8877d0d5afe15fa2894e177f07 <span class="token string">"/home/user/Downloads/ubuntu.iso"</span>SHA256:2da6c248348f5ff0ee06e57222d6cd7ff2a4c652195db7325ee8327e44175f53 <span class="token string">"/home/user/Downloads/debian.iso"</span>SHA256:6ea82342f0db613ce21a0f6df2e59ec2f0c9b05ed4e50f9288305c0d492b42b0 <span class="token string">"/home/user/Downloads/win11.iso"</span>SHA256:cb4ca11618c4e5a24f7a6bcff2eb2a14453f4d802772374386f69d710568aef8 <span class="token string">"/home/user/Downloads/win12.iso"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-6-å°†ç»˜åˆ¶åˆ†å½¢çš„çº¿ç¨‹åˆ†æ´¾åˆ°çº¿ç¨‹æ± ">1.6 å°†ç»˜åˆ¶åˆ†å½¢çš„çº¿ç¨‹åˆ†æ´¾åˆ°çº¿ç¨‹æ± </h3><p>â€ƒâ€ƒé€šè¿‡ä»æœ±è‰å¨…é›†ç»˜åˆ¶åˆ†å½¢æ¥ç”Ÿæˆå›¾åƒï¼Œè¯¥é›†åˆå…·æœ‰ç”¨äºåˆ†å¸ƒå¼è®¡ç®—çš„çº¿ç¨‹æ± ã€‚ä½¿ç”¨ <code>ImageBuffer::new</code> ä¸ºæŒ‡å®šå®½åº¦å’Œé«˜åº¦çš„è¾“å‡ºå›¾åƒåˆ†é…å†…å­˜ï¼Œ<code>Rgb::from_channels</code> ä¿¡é“åˆ™è®¡ç®—è¾“å‡ºå›¾åƒçš„ <code>RGB</code> åƒç´ å€¼ã€‚ä½¿ç”¨ <code>ThreadPool</code> åˆ›å»ºçº¿ç¨‹æ± ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å’Œä½¿ç”¨ <code>num_cpus::get</code> è·å–çš„ç³»ç»Ÿå†…æ ¸æ•°ç›¸ç­‰ã€‚<code>ThreadPool::execute</code> å°†æ¯ä¸ªåƒç´ ä½œä¸ºå•ç‹¬çš„ä½œä¸šæ¥æ”¶ã€‚<code>mpsc::channel</code> ä¿¡é“æ¥æ”¶ä½œä¸šï¼Œ<code>Receiver::recv</code>æ¥æ”¶å™¨åˆ™æ£€ç´¢ä½œä¸šã€‚<code>ImageBuffer::put_pixel</code>å¤„ç†æ•°æ®ï¼Œè®¾ç½®åƒç´ é¢œè‰²ã€‚æœ€åï¼Œ<code>ImageBuffer::save</code> å°†å›¾åƒå­˜å‚¨ä¸º <code>output.png</code>ã€‚</p><p>æ­¤å°èŠ‚éœ€è¦åœ¨1.5å°èŠ‚åŸºç¡€ä¸Šå®‰è£…å¦‚ä¸‹ä¸¤ä¸ªåº“</p><ul><li><code>num</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add num</code> å‘½ä»¤å®‰è£…</li><li><code>image</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add image</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">num_cpus</span> <span class="token punctuation">=</span> <span class="token string">"1.15.0"</span><span class="token key property">threadpool</span> <span class="token punctuation">=</span> <span class="token string">"1.8.1"</span><span class="token key property">num</span> <span class="token punctuation">=</span> <span class="token string">"0.4.0"</span><span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">"0.24.6"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">ImageBuffer</span><span class="token punctuation">,</span> <span class="token class-name">Rgb</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">num<span class="token punctuation">::</span>complex<span class="token punctuation">::</span></span><span class="token class-name">Complex</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span>mpsc<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>channel<span class="token punctuation">,</span> <span class="token class-name">RecvError</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">threadpool<span class="token punctuation">::</span></span><span class="token class-name">ThreadPool</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">MpscRecv</span><span class="token punctuation">(</span><span class="token class-name">RecvError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å°†å¼ºåº¦å€¼è½¬æ¢ä¸º RGB å€¼çš„å‡½æ•°</span><span class="token comment">// åŸºäº http://www.efg2.com/Lab/ScienceAndEngineering/Spectra.htm</span><span class="token keyword">fn</span> <span class="token function-definition function">wavelength_to_rgb</span><span class="token punctuation">(</span>wavelength<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Rgb</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> wave <span class="token operator">=</span> wavelength <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">match</span> wavelength <span class="token punctuation">&#123;</span>        <span class="token number">380</span><span class="token punctuation">..=</span><span class="token number">439</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">.</span> <span class="token operator">-</span> wave<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">440</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">380</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">440</span><span class="token punctuation">..=</span><span class="token number">489</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>wave <span class="token operator">-</span> <span class="token number">440</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">490</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">440</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">490</span><span class="token punctuation">..=</span><span class="token number">509</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">510</span><span class="token punctuation">.</span> <span class="token operator">-</span> wave<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">510</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">490</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">510</span><span class="token punctuation">..=</span><span class="token number">579</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">(</span>wave <span class="token operator">-</span> <span class="token number">510</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">580</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">510</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">580</span><span class="token punctuation">..=</span><span class="token number">644</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">645</span><span class="token punctuation">.</span> <span class="token operator">-</span> wave<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">645</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">580</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">645</span><span class="token punctuation">..=</span><span class="token number">780</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        _ <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> factor <span class="token operator">=</span> <span class="token keyword">match</span> wavelength <span class="token punctuation">&#123;</span>        <span class="token number">380</span><span class="token punctuation">..=</span><span class="token number">419</span> <span class="token operator">=></span> <span class="token number">0.3</span> <span class="token operator">+</span> <span class="token number">0.7</span> <span class="token operator">*</span> <span class="token punctuation">(</span>wave <span class="token operator">-</span> <span class="token number">380</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">420</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">380</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">701</span><span class="token punctuation">..=</span><span class="token number">780</span> <span class="token operator">=></span> <span class="token number">0.3</span> <span class="token operator">+</span> <span class="token number">0.7</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">780</span><span class="token punctuation">.</span> <span class="token operator">-</span> wave<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">780</span><span class="token punctuation">.</span> <span class="token operator">-</span> <span class="token number">700</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        _ <span class="token operator">=></span> <span class="token number">1.0</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>        <span class="token function">normalize</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">normalize</span><span class="token punctuation">(</span>g<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">normalize</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// Rgb::from_channels(r, g, b, 0) // è‡ª 0.24.0 åå·²å¼ƒç”¨ï¼šä½¿ç”¨åƒç´ çš„æ„é€ å‡½æ•°</span>    <span class="token class-name">Rgb</span><span class="token punctuation">(</span><span class="token punctuation">[</span>r<span class="token punctuation">,</span> g<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//ä¸åŸä¹¦ä¸åŒ</span><span class="token punctuation">&#125;</span><span class="token comment">// å°†èŒ±è‰äºšé›†è·ç¦»æ˜ å°„ä¸ºå¼ºåº¦å€¼</span><span class="token keyword">fn</span> <span class="token function-definition function">julia</span><span class="token punctuation">(</span>c<span class="token punctuation">:</span> <span class="token class-name">Complex</span><span class="token operator">&lt;</span><span class="token keyword">f32</span><span class="token operator">></span><span class="token punctuation">,</span> x<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> max_iter<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> width <span class="token operator">=</span> width <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> height <span class="token operator">=</span> height <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> z <span class="token operator">=</span> <span class="token class-name">Complex</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// scale and translate the point to image coordinates</span>        re<span class="token punctuation">:</span> <span class="token number">3.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> width<span class="token punctuation">)</span> <span class="token operator">/</span> width<span class="token punctuation">,</span>        im<span class="token punctuation">:</span> <span class="token number">2.0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">-</span> <span class="token number">0.5</span> <span class="token operator">*</span> height<span class="token punctuation">)</span> <span class="token operator">/</span> height<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>max_iter <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> z<span class="token punctuation">.</span><span class="token function">norm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">2.0</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        z <span class="token operator">=</span> z <span class="token operator">*</span> z <span class="token operator">+</span> c<span class="token punctuation">;</span>        i <span class="token operator">=</span> t<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    i<span class="token punctuation">&#125;</span><span class="token comment">// è§„æ ¼ RGB é¢œè‰²å€¼èŒƒå›´å†…çš„å¼ºåº¦å€¼</span><span class="token keyword">fn</span> <span class="token function-definition function">normalize</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">,</span> factor<span class="token punctuation">:</span> <span class="token keyword">f32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">u8</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">(</span><span class="token punctuation">(</span>color <span class="token operator">*</span> factor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">powf</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u8</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1920</span><span class="token punctuation">,</span> <span class="token number">1080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> img <span class="token operator">=</span> <span class="token class-name">ImageBuffer</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> iterations <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token class-name">Complex</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.156</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> pool <span class="token operator">=</span> <span class="token class-name">ThreadPool</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token namespace">num_cpus<span class="token punctuation">::</span></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> y <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>height <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> tx <span class="token operator">=</span> tx<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        pool<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>width <span class="token punctuation">&#123;</span>                <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token function">julia</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> iterations<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">let</span> pixel <span class="token operator">=</span> <span class="token function">wavelength_to_rgb</span><span class="token punctuation">(</span><span class="token number">380</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">400</span> <span class="token operator">/</span> iterations<span class="token punctuation">)</span><span class="token punctuation">;</span>                tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pixel<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token string">"æ— æ³•å‘é€æ•°æ®!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token punctuation">(</span>width <span class="token operator">*</span> height<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pixel<span class="token punctuation">)</span> <span class="token operator">=</span> rx<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>        img<span class="token punctuation">.</span><span class="token function">put_pixel</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> pixel<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> _ <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">"output.png"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>å°†è·å¾—ä¸€å¼ å›¾ç‰‡</li></ul><p><img src="/imgs/posts/pic-1680865445147.png" alt=""></p><h2 id="2-æ•°æ®å¹¶è¡Œ">2. æ•°æ®å¹¶è¡Œ</h2><h3 id="2-1-å¹¶è¡Œæ”¹å˜æ•°ç»„ä¸­å…ƒç´ ">2.1 å¹¶è¡Œæ”¹å˜æ•°ç»„ä¸­å…ƒç´ </h3><p>â€ƒâ€ƒå®ä¾‹ä½¿ç”¨äº† <code>rayon</code> åº“ï¼Œè¿™æ˜¯ä¸€ä¸ª Rust ç¨‹åºè®¾è®¡è¯­è¨€çš„æ•°æ®å¹¶è¡Œåº“ã€‚<code>rayon</code> ä¸ºä»»ä½•å¹¶è¡Œå¯è¿­ä»£çš„æ•°æ®ç±»å‹æä¾› <code>par_iter_mut</code> æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªç±»è¿­ä»£å™¨çš„é“¾ï¼Œå¯ä»¥å¯¹é“¾å†…çš„æ•°æ®å¹¶è¡Œè®¡ç®—ã€‚</p><ul><li><code>rayon</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add rayon</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">rayon</span> <span class="token punctuation">=</span> <span class="token string">"1.7.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    arr<span class="token punctuation">.</span><span class="token function">par_iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>p <span class="token operator">-=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>-1, <span class="token number">6</span>, <span class="token number">8</span>, <span class="token number">10</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-2-å¹¶è¡Œæµ‹è¯•é›†åˆä¸­ä»»æ„æˆ–æ‰€æœ‰çš„å…ƒç´ æ˜¯å¦åŒ¹é…ç»™å®šæ–­è¨€">2.2 å¹¶è¡Œæµ‹è¯•é›†åˆä¸­ä»»æ„æˆ–æ‰€æœ‰çš„å…ƒç´ æ˜¯å¦åŒ¹é…ç»™å®šæ–­è¨€</h3><p>â€ƒâ€ƒå¦‚ä½•ä½¿ç”¨ <code>rayon::any</code> å’Œ <code>rayon::all</code> æ–¹æ³•ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯åˆ†åˆ«ä¸ <code>std::any</code> å’Œ <code>std::all</code> ç›¸å¯¹åº”çš„å¹¶è¡Œæ–¹æ³•ã€‚<code>rayon::any</code> å¹¶è¡Œæ£€æŸ¥è¿­ä»£å™¨çš„ä»»æ„å…ƒç´ æ˜¯å¦ä¸æ–­è¨€åŒ¹é…ï¼Œå¹¶åœ¨æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„å…ƒç´ æ—¶å°±è¿”å›ã€‚<code>rayon::all</code> å¹¶è¡Œæ£€æŸ¥è¿­ä»£å™¨çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦ä¸æ–­è¨€åŒ¹é…ï¼Œå¹¶åœ¨æ‰¾åˆ°ä¸åŒ¹é…çš„å…ƒç´ æ—¶ç«‹å³è¿”å›ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦å­˜åœ¨ä¸è¢«2æ•´é™¤çš„æ•°(å–å)</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦æ‰€æœ‰æ•°å‡è¢«2æ•´é™¤</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>n <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦å­˜åœ¨å¤§äº8çš„æ•°(å–å)</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>n <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦æ‰€æœ‰æ•°å‡å°äºæˆ–ç­‰äº8</span>    vec<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦å­˜åœ¨ä¸è¢«2æ•´é™¤çš„æ•°</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">(</span><span class="token operator">*</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦æ‰€æœ‰æ•°å‡è¢«2æ•´é™¤(å–å)</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>n <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦å­˜åœ¨å¤§äº8çš„æ•°</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token operator">!</span>vec<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>n<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>n <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ˜¯å¦æ‰€æœ‰æ•°å‡å°äºæˆ–ç­‰äº8(å–å)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¿›è¡Œæ ¡éªŒ</li></ul><h3 id="2-3-ä½¿ç”¨ç»™å®šæ–­è¨€å¹¶è¡Œæœç´¢é¡¹">2.3 ä½¿ç”¨ç»™å®šæ–­è¨€å¹¶è¡Œæœç´¢é¡¹</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>rayon::find_any</code> å’Œ <code>par_iter</code> å¹¶è¡Œæœç´¢ <code>vector</code> é›†åˆï¼Œä»¥æŸ¥æ‰¾æ»¡è¶³æŒ‡å®šé—­åŒ…ä¸­çš„æ–­è¨€çš„å…ƒç´ ã€‚å¦‚æœæœ‰å¤šä¸ªå…ƒç´ æ»¡è¶³ <code>rayon::find_any</code> é—­åŒ…å‚æ•°ä¸­å®šä¹‰çš„æ–­è¨€ï¼Œ<code>rayon</code> å°†è¿”å›æœç´¢å‘ç°çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†ä¸ä¸€å®šæ˜¯ <code>vector</code> é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å®ä¾‹ä¸­é—­åŒ…çš„å‚æ•°æ˜¯å¯¹å¼•ç”¨çš„å¼•ç”¨ï¼ˆ<code>&amp;&amp;x</code>ï¼‰</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> f1 <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find_any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">==</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> f2 <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find_any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> x <span class="token operator">></span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> f3 <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find_any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">></span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>f1<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>f2<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span>f3 <span class="token operator">></span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¿›è¡Œæ ¡éªŒ</li></ul><h3 id="2-4-å¯¹-vector-å¹¶è¡Œæ’åº">2.4 å¯¹ <code>vector</code> å¹¶è¡Œæ’åº</h3><p>â€ƒâ€ƒé¦–å…ˆåˆ†é…ç©ºå­—ç¬¦ä¸² <code>vector</code>ï¼›ç„¶åï¼Œé€šè¿‡ <code>par_iter_mut().for_each</code>å¹¶è¡Œå¯¹ <code>vector</code> å¡«å……éšæœºå€¼ã€‚å°½ç®¡å­˜åœ¨å¤šç§é€‰æ‹©ï¼Œå¯ä»¥å¯¹å¯æšä¸¾æ•°æ®ç±»å‹è¿›è¡Œæ’åºï¼Œä½† <code>par_sort_unstable</code> é€šå¸¸æ¯”ç¨³å®šæ’åºï¼ˆç›¸åŒçš„å€¼æ’åºåç›¸å¯¹é¡ºåºä¸å˜ï¼‰ç®—æ³•å¿«ã€‚</p><ul><li>åœ¨ä¹‹å‰åŸºç¡€ä¸Šå®‰è£…<code>rand</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add rand</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">rayon</span> <span class="token punctuation">=</span> <span class="token string">"1.7.0"</span><span class="token key property">rand</span> <span class="token punctuation">=</span> <span class="token string">"0.8.5"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span>distributions<span class="token punctuation">::</span></span><span class="token class-name">Alphanumeric</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>thread_rng<span class="token punctuation">,</span> <span class="token class-name">Rng</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    vec<span class="token punctuation">.</span><span class="token function">par_iter_mut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>p<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> rng<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span><span class="token class-name">Alphanumeric</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//ä¸åŸä¹¦ä¸åŒ</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vec<span class="token punctuation">.</span><span class="token function">par_sort_unstable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¿›è¡Œæ ¡éªŒ</li></ul><h3 id="2-5-Map-reduce-å¹¶è¡Œè®¡ç®—">2.5 <code>Map-reduce</code> å¹¶è¡Œè®¡ç®—</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>rayon::filter</code>ã€<code>rayon::map</code>ï¼Œä»¥åŠ <code>rayon::reduce</code> è®¡ç®— <code>Person</code> å¯¹è±¡ä¸­å¹´é¾„è¶…è¿‡ 30 å²çš„é‚£äº›äººçš„å¹³å‡å¹´é¾„ã€‚<code>rayon::filter</code> è¿‡æ»¤é›†åˆä¸­æ»¡è¶³ç»™å®šæ–­è¨€çš„å…ƒç´ ã€‚<code>rayon::map</code> å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œä¸€æ¬¡è®¡ç®—ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„è¿­ä»£ï¼›<code>rayon::reduce</code> æ‰§è¡Œæ–°çš„è®¡ç®—ï¼ŒåŸºäºå‰ä¸€æ¬¡çš„ <code>reduce</code> è®¡ç®—ç»“æœå’Œå½“å‰å…ƒç´ ç´¯åŠ åœ¨ä¸€èµ·ã€‚å¦å¤–å¯ä»¥æŸ¥çœ‹ <code>rayon::sum</code>ï¼Œå®ƒä¸æœ¬å®ä¾‹ä¸­çš„ <code>reduce</code> è®¡ç®—å…·æœ‰ç›¸åŒçš„ç»“æœã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">&#123;</span>    age<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Person</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">23</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">19</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">17</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">31</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> age<span class="token punctuation">:</span> <span class="token number">30</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> num_over_30 <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span>age <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">f32</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> sum_over_30 <span class="token operator">=</span> v        <span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span>age<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token punctuation">,</span> y<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> alt_sum_30<span class="token punctuation">:</span> <span class="token keyword">u32</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">></span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> avg_over_30 <span class="token operator">=</span> sum_over_30 <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">/</span> num_over_30<span class="token punctuation">;</span>    <span class="token keyword">let</span> alt_avg_over_30 <span class="token operator">=</span> alt_sum_30 <span class="token keyword">as</span> <span class="token keyword">f32</span> <span class="token operator">/</span> num_over_30<span class="token punctuation">;</span>    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token punctuation">(</span>avg_over_30 <span class="token operator">-</span> alt_avg_over_30<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token namespace">std<span class="token punctuation">::</span></span><span class="token keyword">f32</span><span class="token punctuation">::</span><span class="token constant">EPSILON</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//EPSILON: 0.00000011920929</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"30å²ä»¥ä¸Šçš„äººçš„å¹³å‡å¹´é¾„æ˜¯ &#123;&#125;"</span><span class="token punctuation">,</span> avg_over_30<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">30</span>å²ä»¥ä¸Šçš„äººçš„å¹³å‡å¹´é¾„æ˜¯ <span class="token number">36.5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-6-å¹¶è¡Œç”Ÿæˆ-png-ç¼©ç•¥å›¾">2.6 å¹¶è¡Œç”Ÿæˆ <code>png</code> ç¼©ç•¥å›¾</h3><p>â€ƒâ€ƒä¸ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰ <code>.png</code> å›¾åƒæ–‡ä»¶ç”Ÿæˆç¼©ç•¥å›¾ï¼Œç„¶åå°†ç”Ÿæˆçš„ç¼©ç•¥å›¾ä¿å­˜åœ¨ä¸€ä¸ªåä¸º <code>thumbnails</code> çš„æ–°æ–‡ä»¶å¤¹ä¸­ã€‚<code>glob::glob_with</code> åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ <code>jpeg</code> å›¾åƒæ–‡ä»¶ï¼Œ<code>rayon</code> é€šè¿‡ <code>par_iter</code> æ–¹æ³•è°ƒç”¨ <code>DynamicImage::resize</code>ï¼Œå¹¶è¡Œåœ°è°ƒæ•´å›¾åƒå¤§å°ã€‚</p><ul><li>åœ¨ä¹‹å‰åŸºç¡€ä¸Šå®‰è£…<code>glob</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add glob</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">"0.24.6"</span><span class="token key property">rayon</span> <span class="token punctuation">=</span> <span class="token string">"1.7.0"</span><span class="token key property">glob</span> <span class="token punctuation">=</span> <span class="token string">"0.3.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span>create_dir_all<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span><span class="token class-name">ChainedError</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>glob_with<span class="token punctuation">,</span> <span class="token class-name">MatchOptions</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token namespace">imageops<span class="token punctuation">::</span></span><span class="token class-name">FilterType</span><span class="token punctuation">,</span> <span class="token class-name">ImageError</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rayon<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>    foreign_links <span class="token punctuation">&#123;</span>        <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token class-name">ImageError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Glob</span><span class="token punctuation">(</span><span class="token namespace">glob<span class="token punctuation">::</span></span><span class="token class-name">PatternError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> options<span class="token punctuation">:</span> <span class="token class-name">MatchOptions</span> <span class="token operator">=</span> <span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> files<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> <span class="token function">glob_with</span><span class="token punctuation">(</span><span class="token string">"*.png"</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token operator">?</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> files<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span>        <span class="token namespace">error_chain<span class="token punctuation">::</span></span><span class="token macro property">bail!</span><span class="token punctuation">(</span><span class="token string">"åœ¨å½“å‰ç›®å½•ä¸­æ‰¾ä¸åˆ° .png æ–‡ä»¶"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> thumb_dir <span class="token operator">=</span> <span class="token string">"thumbnails"</span><span class="token punctuation">;</span>    <span class="token function">create_dir_all</span><span class="token punctuation">(</span>thumb_dir<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å°† &#123;&#125; ç¼©ç•¥å›¾ä¿å­˜åˆ° '&#123;&#125;'..."</span><span class="token punctuation">,</span> files<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thumb_dir<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> image_failures<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> files        <span class="token punctuation">.</span><span class="token function">par_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>path<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token function">make_thumbnail</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> thumb_dir<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> e<span class="token punctuation">.</span><span class="token function">chain_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">err</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    image_failures        <span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">display_chain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; thumbnails ä¿å­˜æˆåŠŸ"</span><span class="token punctuation">,</span> files<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> image_failures<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">make_thumbnail</span><span class="token operator">&lt;</span><span class="token constant">PA</span><span class="token punctuation">,</span> <span class="token constant">PB</span><span class="token operator">></span><span class="token punctuation">(</span>original<span class="token punctuation">:</span> <span class="token constant">PA</span><span class="token punctuation">,</span> thumb_dir<span class="token punctuation">:</span> <span class="token constant">PB</span><span class="token punctuation">,</span> longest_edge<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token keyword">where</span>    <span class="token constant">PA</span><span class="token punctuation">:</span> <span class="token class-name">AsRef</span><span class="token operator">&lt;</span><span class="token class-name">Path</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token constant">PB</span><span class="token punctuation">:</span> <span class="token class-name">AsRef</span><span class="token operator">&lt;</span><span class="token class-name">Path</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> img <span class="token operator">=</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token function">open</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> file_path <span class="token operator">=</span> thumb_dir<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span>img        <span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>longest_edge<span class="token punctuation">,</span> longest_edge<span class="token punctuation">,</span> <span class="token class-name">FilterType</span><span class="token punctuation">::</span><span class="token class-name">Nearest</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>file_path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œ<code>cargo run</code>(å¤„ç†1.6å°èŠ‚ç”Ÿæˆçš„å›¾ç‰‡)è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">å°† <span class="token number">1</span> ç¼©ç•¥å›¾ä¿å­˜åˆ° <span class="token string">'thumbnails'</span><span class="token punctuation">..</span>.<span class="token number">1</span> thumbnails ä¿å­˜æˆåŠŸ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”œâ”€â”€ output.png <span class="token comment"># åŸå§‹æ–‡ä»¶</span>â””â”€â”€ thumbnails    â””â”€â”€ output.png <span class="token comment"># ç”Ÿæˆåçš„æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘ä¸‰ å‹ç¼©</title>
      <link href="/news/1680011142405.html"/>
      <url>/news/1680011142405.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨-tar-åŒ…">1. ä½¿ç”¨ <code>tar</code> åŒ…</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>flate2</code>å’Œ<code>tar</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add flate2</code> å’Œ<code>cargo add tar</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">flate2</span> <span class="token punctuation">=</span> <span class="token string">"1.0.25"</span><span class="token key property">tar</span> <span class="token punctuation">=</span> <span class="token string">"0.4.38"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-1-å‹ç¼©ç›®å½•ä¸º-tar-åŒ…">1.1 å‹ç¼©ç›®å½•ä¸º <code>tar</code> åŒ…</h3><p>â€ƒâ€ƒå‹ç¼© <code>/root/testtar</code>ç›®å½•å†…çš„å†…å®¹åˆ° <code>archive.tar.gz</code> å‹ç¼©åŒ…ä¸­ã€‚åˆ›å»ºä¸€ä¸ªç”¨ <code>GzEncoder</code> å’Œ <code>tar::Builder</code> åŒ…è£¹çš„ <code>File</code>ã€‚ä½¿ç”¨ <code>Builder::append_dir_all</code>ï¼Œå°† <code>/root/testtar</code>ç›®å½•å†…çš„å†…å®¹é€’å½’æ·»åŠ åˆ° <code>backup/code</code>è·¯å¾„ä¸‹çš„å½’æ¡£æ–‡ä»¶ä¸­ã€‚åœ¨å°†æ•°æ®å†™å…¥å‹ç¼©åŒ… <code>archive.tar.gz</code> ä¹‹å‰ï¼Œ<code>GzEncoder</code> è´Ÿè´£æ¸…æ™°åœ°å°†æ•°æ®å‹ç¼©ã€‚</p><ul><li><code>/root/testtar</code>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/root/testtar/â”œâ”€â”€ Cargo.lock_copyâ”œâ”€â”€ Cargo.toml_copyâ””â”€â”€ src-rust    â””â”€â”€ main.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span>write<span class="token punctuation">::</span></span><span class="token class-name">GzEncoder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span></span><span class="token class-name">Compression</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">tar<span class="token punctuation">::</span></span><span class="token class-name">Builder</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> tar_gz <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"archive.tar.gz"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> enc <span class="token operator">=</span> <span class="token class-name">GzEncoder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>tar_gz<span class="token punctuation">,</span> <span class="token class-name">Compression</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> tar <span class="token operator">=</span> <span class="token class-name">Builder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>enc<span class="token punctuation">)</span><span class="token punctuation">;</span>    tar<span class="token punctuation">.</span><span class="token function">append_dir_all</span><span class="token punctuation">(</span><span class="token string">"backup/code"</span><span class="token punctuation">,</span> <span class="token string">"/root/testtar"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œå‘½ä»¤å¦‚ä¸‹,åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªåä¸º<code>archive.tar.gz</code>çš„å‹ç¼©åŒ…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç›®å½•ç»“æ„å¦‚ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”œâ”€â”€ Cargo.lockâ”œâ”€â”€ Cargo.tomlâ”œâ”€â”€ archive.tar.gzâ”œâ”€â”€ srcâ”‚   â””â”€â”€ main.rsâ””â”€â”€ target<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-è§£å‹-tar-åŒ…">1.2. è§£å‹ <code>tar</code> åŒ…</h3><p>â€ƒâ€ƒä»å½“å‰å·¥ä½œç›®å½•ä¸­çš„å‹ç¼©åŒ… <code>archive.tar.gz</code>ï¼Œè§£å‹ï¼ˆ<code>GzDecoder</code>ï¼‰å’Œæå–ï¼ˆ<code>Archive::unpack</code>ï¼‰æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶æ”¾åœ¨<code>copy</code>ç›®å½•ä¸‹ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span>read<span class="token punctuation">::</span></span><span class="token class-name">GzDecoder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">tar<span class="token punctuation">::</span></span><span class="token class-name">Archive</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token string">"archive.tar.gz"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> tar_gz <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> tar <span class="token operator">=</span> <span class="token class-name">GzDecoder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>tar_gz<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> archive <span class="token operator">=</span> <span class="token class-name">Archive</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>tar<span class="token punctuation">)</span><span class="token punctuation">;</span>    archive<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token string">"./copy/"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œå‘½ä»¤å¦‚ä¸‹,è§£å‹åˆ°<code>copy</code>ç›®å½•ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç›®å½•ç»“æ„å¦‚ä¸‹,å¯ä»¥çœ‹åˆ°ç›®å½•åŒ…å«<code>backup/code</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">copy/â””â”€â”€ backup    â””â”€â”€ code        â”œâ”€â”€ Cargo.lock_copy        â”œâ”€â”€ Cargo.toml_copy        â””â”€â”€ src-rust            â””â”€â”€ main.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-ä»è·¯å¾„ç§»é™¤å‰ç¼€æ—¶ï¼Œè§£å‹-tar-åŒ…">1.3 ä»è·¯å¾„ç§»é™¤å‰ç¼€æ—¶ï¼Œè§£å‹ <code>tar</code> åŒ…</h3><p>â€ƒâ€ƒå¾ªç¯éå† <code>Archive::entries</code>ã€‚ä½¿ç”¨ <code>Path::strip_prefix</code> ç§»é™¤æŒ‡å®šçš„è·¯å¾„å‰ç¼€ï¼ˆbundle/logsï¼‰ã€‚æœ€ç»ˆï¼Œé€šè¿‡ <code>Entry::unpack</code>æå– <code>tar::Entry</code>ï¼ˆ<code>tar</code> åŒ…ä¸­çš„å†…å®¹ï¼‰ã€‚æ­¤å—ä»£ç éœ€è¦å®‰è£…<code>error-chain</code>åº“ï¼Œé€šè¿‡<code>error-chain</code> å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">error-chain</span> <span class="token punctuation">=</span> <span class="token string">"0.12.4"</span><span class="token key property">flate2</span> <span class="token punctuation">=</span> <span class="token string">"1.0.25"</span><span class="token key property">tar</span> <span class="token punctuation">=</span> <span class="token string">"0.4.38"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">error_chain<span class="token punctuation">::</span></span>error_chain<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span>read<span class="token punctuation">::</span></span><span class="token class-name">GzDecoder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">PathBuf</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">tar<span class="token punctuation">::</span></span><span class="token class-name">Archive</span><span class="token punctuation">;</span><span class="token macro property">error_chain!</span> <span class="token punctuation">&#123;</span>  foreign_links <span class="token punctuation">&#123;</span>    <span class="token class-name">Io</span><span class="token punctuation">(</span><span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">StripPrefixError</span><span class="token punctuation">(</span><span class="token punctuation">::</span><span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">StripPrefixError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"archive.tar.gz"</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> archive <span class="token operator">=</span> <span class="token class-name">Archive</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">GzDecoder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> prefix <span class="token operator">=</span> <span class="token string">"backup/code"</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æå–äº†ä»¥ä¸‹æ–‡ä»¶:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    archive        <span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> e<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token keyword">mut</span> entry<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">PathBuf</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> path <span class="token operator">=</span> entry<span class="token punctuation">.</span><span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">strip_prefix</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            entry<span class="token punctuation">.</span><span class="token function">unpack</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">filter_map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> e<span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">for_each</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"> &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œå‘½ä»¤å¦‚ä¸‹,è§£å‹åˆ°<code>copy</code>ç›®å½•ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æå–äº†ä»¥ä¸‹æ–‡ä»¶:<span class="token operator">></span> src-rust<span class="token operator">></span> src-rust/main.rs<span class="token operator">></span> Cargo.lock_copy<span class="token operator">></span> Cargo.toml_copy<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è§£å‹åˆ°å½“å‰ç›®å½•çš„ç›®å½•ç»“æ„å¦‚ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">â”œâ”€â”€ Cargo.lock_copyâ”œâ”€â”€ Cargo.toml_copyâ”œâ”€â”€ src-rustâ”‚   â””â”€â”€ main.rs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘äºŒ å‘½ä»¤è¡Œ</title>
      <link href="/news/1679492996891.html"/>
      <url>/news/1679492996891.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‚æ•°è§£æ">1. å‚æ•°è§£æ</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>clap</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add clap --features derive</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">clap</span> <span class="token punctuation">=</span> <span class="token punctuation">&#123;</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">"4.1.11"</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">"derive"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-1-è§£æå‘½ä»¤è¡Œå‚æ•°">1.1 è§£æå‘½ä»¤è¡Œå‚æ•°</h3><p>â€ƒâ€ƒæ­¤åº”ç”¨ç¨‹åºä½¿ç”¨ <code>clap</code> æ„å»ºå™¨æ ·å¼æè¿°å…¶å‘½ä»¤è¡Œç•Œé¢çš„ç»“æ„ã€‚æ–‡æ¡£è¿˜æä¾›äº†å¦å¤–ä¸¤ç§å¯ç”¨çš„æ–¹æ³•å»å®ä¾‹åŒ–åº”ç”¨ç¨‹åºã€‚åœ¨æ„å»ºå™¨æ ·å¼ä¸­ï¼Œ<code>short</code> å’Œ <code>long</code> é€‰é¡¹æ§åˆ¶ç”¨æˆ·å°†è¦é”®å…¥çš„æ ‡å¿—ï¼›<code>short</code> æ ‡å¿—çœ‹èµ·æ¥åƒ <code>-f</code>ï¼Œlong æ ‡å¿—çœ‹èµ·æ¥åƒ <code>--file</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">clap<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Arg</span><span class="token punctuation">,</span> <span class="token class-name">Command</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> matches <span class="token operator">=</span> <span class="token class-name">Command</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"å‘½ä»¤è¡Œ-æµ‹è¯•"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"0.1.0"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">"Hackerman Jones &lt;hckrmnjones@hack.gov>"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">about</span><span class="token punctuation">(</span><span class="token string">"å‚æ•°è§£ææ•™å­¦"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>            <span class="token class-name">Arg</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">short</span><span class="token punctuation">(</span><span class="token char">'f'</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">long</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span>                <span class="token comment">//  .takes_value(true)</span>                <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">"A cool file"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">arg</span><span class="token punctuation">(</span>            <span class="token class-name">Arg</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">short</span><span class="token punctuation">(</span><span class="token char">'n'</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">long</span><span class="token punctuation">(</span><span class="token string">"number"</span><span class="token punctuation">)</span>                <span class="token comment">//  .takes_value(true)</span>                <span class="token punctuation">.</span><span class="token function">help</span><span class="token punctuation">(</span><span class="token string">"Five less than your favorite number"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">get_matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> binding <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"a.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> myfile <span class="token operator">=</span> matches<span class="token punctuation">.</span><span class="token function">get_one</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>binding<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ä¼ é€’çš„æ–‡ä»¶æ˜¯: &#123;&#125;"</span><span class="token punctuation">,</span> myfile<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> num_str <span class="token operator">=</span> matches<span class="token punctuation">.</span><span class="token function">get_one</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">match</span> num_str <span class="token punctuation">&#123;</span>        <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ä¸çŸ¥é“ä½ æœ€å–œæ¬¢çš„æ•°å­—æ˜¯ä»€ä¹ˆã€‚"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">match</span> s<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Ok</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ä½ å–œæ¬¢çš„æ•°å­—æ˜¯ &#123;&#125;."</span><span class="token punctuation">,</span> n <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"é‚£ä¸æ˜¯ä¸€ä¸ªæ•°å­—! &#123;&#125;"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿è¡Œå‘½ä»¤å¦‚ä¸‹</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run -- <span class="token parameter variable">-f</span> abc.txt <span class="token parameter variable">-n</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ä¼ é€’çš„æ–‡ä»¶æ˜¯: abc.txtä½ å–œæ¬¢çš„æ•°å­—æ˜¯ <span class="token number">105</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-ANSI-ç»ˆç«¯">2. <code>ANSI</code> ç»ˆç«¯</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>ansi_term</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add ansi_term</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">ansi_term</span> <span class="token punctuation">=</span> <span class="token string">"0.12.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒ<code>ansi_term</code> ä¸­æœ‰ä¸¤ç§ä¸»è¦çš„æ•°æ®ç»“æ„ï¼š<code>ANSIString</code> å’Œ <code>Style</code>ã€‚<code>Style</code> åŒ…å«æ ·å¼ä¿¡æ¯ï¼šé¢œè‰²ï¼Œæ˜¯å¦ç²—ä½“æ–‡æœ¬ï¼Œæˆ–è€…æ˜¯å¦é—ªçƒï¼Œæˆ–è€…å…¶å®ƒæ ·å¼ã€‚è¿˜æœ‰ <code>Colour</code> å˜é‡ï¼Œä»£è¡¨ç®€å•çš„å‰æ™¯è‰²æ ·å¼ã€‚<code>ANSIString</code> æ˜¯ä¸ <code>Style</code> é…å¯¹çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="2-1-æ‰“å°å½©è‰²æ–‡æœ¬åˆ°ç»ˆç«¯">2.1 æ‰“å°å½©è‰²æ–‡æœ¬åˆ°ç»ˆç«¯</h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">ansi_term<span class="token punctuation">::</span></span><span class="token class-name">Colour</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"This is &#123;&#125; in color, &#123;&#125; in color and &#123;&#125; in color"</span><span class="token punctuation">,</span>        <span class="token class-name">Colour</span><span class="token punctuation">::</span><span class="token class-name">Red</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"çº¢è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Colour</span><span class="token punctuation">::</span><span class="token class-name">Blue</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"è“è‰²"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Colour</span><span class="token punctuation">::</span><span class="token class-name">Green</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"ç»¿è‰²"</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">This is çº¢è‰² <span class="token keyword">in</span> color, è“è‰² <span class="token keyword">in</span> color and ç»¿è‰² <span class="token keyword">in</span> color<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-2-ç»ˆç«¯ä¸­çš„ç²—ä½“æ–‡æœ¬">2.2 ç»ˆç«¯ä¸­çš„ç²—ä½“æ–‡æœ¬</h3><p>â€ƒâ€ƒå¯¹äºæ¯”ç®€å•çš„å‰æ™¯è‰²å˜åŒ–æ›´å¤æ‚çš„äº‹æƒ…ï¼Œä»£ç éœ€è¦æ„é€  <code>Style</code> ç»“æ„ä½“ã€‚<code>Style::new()</code> åˆ›å»ºç»“æ„ä½“ï¼Œå¹¶é“¾æ¥å±æ€§ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">ansi_term<span class="token punctuation">::</span></span><span class="token class-name">Style</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; and è¿™ä¸æ˜¯"</span><span class="token punctuation">,</span> <span class="token class-name">Style</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯åŠ ç²—"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">è¿™æ˜¯åŠ ç²— and è¿™ä¸æ˜¯<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-3-ç»ˆç«¯ä¸­çš„ç²—ä½“å’Œå½©è‰²æ–‡æœ¬">2.3 ç»ˆç«¯ä¸­çš„ç²—ä½“å’Œå½©è‰²æ–‡æœ¬</h3><p>â€ƒâ€ƒ<code>Colour</code> æ¨¡å—å®ç°äº†è®¸å¤šç±»ä¼¼ <code>Style</code> çš„å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥é“¾æ¥æ–¹æ³•ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">ansi_term<span class="token punctuation">::</span></span><span class="token class-name">Colour</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">ansi_term<span class="token punctuation">::</span></span><span class="token class-name">Style</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"&#123;&#125;, &#123;&#125; and &#123;&#125;"</span><span class="token punctuation">,</span>        <span class="token class-name">Colour</span><span class="token punctuation">::</span><span class="token class-name">Yellow</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯é»„è‰²çš„"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Style</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯åŠ ç²—çš„"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Colour</span><span class="token punctuation">::</span><span class="token class-name">Yellow</span><span class="token punctuation">.</span><span class="token function">bold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">paint</span><span class="token punctuation">(</span><span class="token string">"è¿™æ˜¯é»„è‰²å¹¶åŠ ç²—çš„"</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">è¿™æ˜¯é»„è‰²çš„, è¿™æ˜¯åŠ ç²—çš„ and è¿™æ˜¯é»„è‰²å¹¶åŠ ç²—çš„<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythonæ‚è®°ã€‘asyncå’Œawaitä½¿ç”¨</title>
      <link href="/news/1678864283156.html"/>
      <url>/news/1678864283156.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨çš„åº“-åº“-httpx-å¯é€šè¿‡-pip-install-httpx-å‘½ä»¤å®‰è£…">1. ä½¿ç”¨çš„åº“(åº“ <code>httpx</code> å¯é€šè¿‡ <code>pip install httpx</code> å‘½ä»¤å®‰è£…)</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> httpx<span class="token keyword">import</span> asyncio<span class="token keyword">import</span> time<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2-async-å’Œ-await-çš„æ™®é€šä½¿ç”¨">2. <code>async</code> å’Œ <code>await</code> çš„æ™®é€šä½¿ç”¨</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_other</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_other</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://httpbin.org/get'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/cookies'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/uuid'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/response-headers?freeform='</span><span class="token punctuation">]</span>    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>fetch_other<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-async-å’Œ-await-è°ƒç”¨åº“-httpx">3. <code>async</code> å’Œ <code>await</code> è°ƒç”¨åº“ <code>httpx</code></h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_httpx</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_httpx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://httpbin.org/get'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/cookies'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/uuid'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/response-headers?freeform='</span><span class="token punctuation">]</span>    <span class="token keyword">async</span> <span class="token keyword">with</span> httpx<span class="token punctuation">.</span>AsyncClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>        tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>fetch_httpx<span class="token punctuation">(</span>client<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>        responses <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span>        <span class="token keyword">return</span> responses<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span>    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>    responses <span class="token operator">=</span> loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test_httpx<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> response <span class="token keyword">in</span> responses<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>    loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test_other<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span>    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿è¡Œæ—¶é•¿: %s ç§’'</span><span class="token operator">%</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-è¯¦ç»†æƒ…å†µ">4. è¯¦ç»†æƒ…å†µ</h2><h3 id="4-1-è¯¦ç»†ä»£ç ">4.1 è¯¦ç»†ä»£ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> httpx<span class="token keyword">import</span> asyncio<span class="token keyword">import</span> time<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_httpx</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">return</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_httpx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://httpbin.org/get'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/cookies'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/uuid'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/response-headers?freeform='</span><span class="token punctuation">]</span>    <span class="token keyword">async</span> <span class="token keyword">with</span> httpx<span class="token punctuation">.</span>AsyncClient<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> client<span class="token punctuation">:</span>        tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>fetch_httpx<span class="token punctuation">(</span>client<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>        responses <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span>        <span class="token keyword">return</span> responses<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_other</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_other</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://httpbin.org/get'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/cookies'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/uuid'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/response-headers?freeform='</span><span class="token punctuation">]</span>    tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>fetch_other<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>    <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>gather<span class="token punctuation">(</span><span class="token operator">*</span>tasks<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span>    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>    responses <span class="token operator">=</span> loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test_httpx<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> response <span class="token keyword">in</span> responses<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>    loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test_other<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span>    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'è¿è¡Œæ—¶é•¿: %s ç§’'</span><span class="token operator">%</span><span class="token punctuation">(</span>end<span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-è¿è¡Œè¾“å‡ºç»“æœ">4.2 è¿è¡Œè¾“å‡ºç»“æœ</h3><pre class="line-numbers language-none"><code class="language-none">&#123;&#39;args&#39;: &#123;&#125;, &#39;headers&#39;: &#123;&#39;Accept&#39;: &#39;*&#x2F;*&#39;, &#39;Accept-Encoding&#39;: &#39;gzip, deflate, br&#39;, &#39;Host&#39;: &#39;httpbin.org&#39;, &#39;User-Agent&#39;: &#39;python-httpx&#x2F;0.23.0&#39;, &#39;X-Amzn-Trace-Id&#39;: &#39;Root&#x3D;1-641168d8-29511e7271300606309ff8b9&#39;&#125;, &#39;origin&#39;: &#39;106.120.122.135&#39;, &#39;url&#39;: &#39;https:&#x2F;&#x2F;httpbin.org&#x2F;get&#39;&#125;&#123;&#39;cookies&#39;: &#123;&#125;&#125;&#123;&#39;uuid&#39;: &#39;fd8c2608-7b3e-47f9-8aec-0c31299771a7&#39;&#125;&#123;&#39;Content-Length&#39;: &#39;87&#39;, &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;, &#39;freeform&#39;: &#39;&#39;&#125;https:&#x2F;&#x2F;httpbin.org&#x2F;gethttps:&#x2F;&#x2F;httpbin.org&#x2F;uuidhttps:&#x2F;&#x2F;httpbin.org&#x2F;cookieshttps:&#x2F;&#x2F;httpbin.org&#x2F;response-headers?freeform&#x3D;è¿è¡Œæ—¶é•¿: 12.626903533935547 ç§’<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-å…¶ä»–äº‹é¡¹">5. å…¶ä»–äº‹é¡¹</h2><p>â€ƒâ€ƒæ–‡ä¸­ä½¿ç”¨<code>httpx</code>è¿›è¡Œå¼‚æ­¥è¯·æ±‚ï¼Œå¦‚æœä½¿ç”¨<code>aiohttp</code>(<code>é€šè¿‡pip install aiohttp</code>å‘½ä»¤å®‰è£…)è¿›è¡Œå¼‚æ­¥è¯·æ±‚æ—¶ï¼Œä½¿ç”¨<code>loop.close()</code>å…³é—­äº‹ä»¶å¾ªç¯æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸<code>raise RuntimeError('Event loop is closed')</code>ã€Python ç‰ˆæœ¬ 3.9ã€‘ã€‚ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> aiohttp<span class="token keyword">import</span> asyncio<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">fetch_asyncio</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">async</span> <span class="token keyword">with</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token keyword">as</span> response<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">test_asyncio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://httpbin.org/get'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/cookies'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/uuid'</span><span class="token punctuation">,</span> <span class="token string">'https://httpbin.org/response-headers?freeform='</span><span class="token punctuation">]</span>    <span class="token keyword">async</span> <span class="token keyword">with</span> aiohttp<span class="token punctuation">.</span>ClientSession<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>        tasks <span class="token operator">=</span> <span class="token punctuation">[</span>asyncio<span class="token punctuation">.</span>ensure_future<span class="token punctuation">(</span>fetch_asyncio<span class="token punctuation">(</span>session<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> url <span class="token keyword">in</span> urls<span class="token punctuation">]</span>        responses <span class="token operator">=</span> <span class="token keyword">await</span> asyncio<span class="token punctuation">.</span>wait<span class="token punctuation">(</span>tasks<span class="token punctuation">)</span>        <span class="token keyword">return</span> responses<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span>    loop <span class="token operator">=</span> asyncio<span class="token punctuation">.</span>get_event_loop<span class="token punctuation">(</span><span class="token punctuation">)</span>    responses <span class="token operator">=</span> loop<span class="token punctuation">.</span>run_until_complete<span class="token punctuation">(</span>test_asyncio<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> response <span class="token keyword">in</span> responses<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>    loop<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment"># å…¶ä»–æµç¨‹</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-1-è¿è¡ŒæŠ¥é”™ç»“æœ">5.1 è¿è¡ŒæŠ¥é”™ç»“æœ</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Exception ignored in: <span class="token operator">&lt;</span>function _ProactorBasePipeTransport.__del__ at 0x00000118E6D784C<span class="token operator"><span class="token file-descriptor important">0</span>></span>Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:  File <span class="token string">"C:\Program Files\Python39\lib<span class="token entity" title="\a">\a</span>syncio\proactor_events.py"</span>, line <span class="token number">116</span>, <span class="token keyword">in</span> __del__    self.close<span class="token punctuation">(</span><span class="token punctuation">)</span>  File <span class="token string">"C:\Program Files\Python39\lib<span class="token entity" title="\a">\a</span>syncio\proactor_events.py"</span>, line <span class="token number">108</span>, <span class="token keyword">in</span> close    self._loop.call_soon<span class="token punctuation">(</span>self._call_connection_lost, None<span class="token punctuation">)</span>  File <span class="token string">"C:\Program Files\Python39\lib<span class="token entity" title="\a">\a</span>syncio<span class="token entity" title="\b">\b</span>ase_events.py"</span>, line <span class="token number">746</span>, <span class="token keyword">in</span> call_soon    self._check_closed<span class="token punctuation">(</span><span class="token punctuation">)</span>  File <span class="token string">"C:\Program Files\Python39\lib<span class="token entity" title="\a">\a</span>syncio<span class="token entity" title="\b">\b</span>ase_events.py"</span>, line <span class="token number">510</span>, <span class="token keyword">in</span> _check_closed    raise RuntimeError<span class="token punctuation">(</span><span class="token string">'Event loop is closed'</span><span class="token punctuation">)</span>RuntimeError: Event loop is closed<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> ç›˜è›‡æ•™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rust Cookbookç³»åˆ—ã€‘ä¸€ ç®—æ³•</title>
      <link href="/news/1678889342364.html"/>
      <url>/news/1678889342364.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ç”Ÿæˆéšæœºå€¼">1. ç”Ÿæˆéšæœºå€¼</h2><p>â€ƒâ€ƒéœ€è¦å®‰è£…<code>rand</code>åº“ï¼Œå¯é€šè¿‡<code>cargo add rand</code>å‘½ä»¤å®‰è£…</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">rand</span> <span class="token punctuation">=</span> <span class="token string">"0.8.5"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-1-ç”Ÿæˆéšæœºæ•°">1.1 ç”Ÿæˆéšæœºæ•°</h3><p>â€ƒâ€ƒåœ¨éšæœºæ•°ç”Ÿæˆå™¨ <code>rand::Rng</code> çš„å¸®åŠ©ä¸‹ï¼Œé€šè¿‡ <code>rand::thread_rng</code> ç”Ÿæˆéšæœºæ•°ã€‚å¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªåˆå§‹åŒ–çš„ç”Ÿæˆå™¨ã€‚æ•´æ•°åœ¨å…¶ç±»å‹èŒƒå›´å†…å‡åŒ€åˆ†å¸ƒï¼Œæµ®ç‚¹æ•°æ˜¯ä» <code>0</code>å‡åŒ€åˆ†å¸ƒåˆ° <code>1</code>ï¼Œä½†ä¸åŒ…æ‹¬ <code>1</code>ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> n1<span class="token punctuation">:</span> <span class="token keyword">u8</span> <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> n2<span class="token punctuation">:</span> <span class="token keyword">u16</span> <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºç”Ÿæˆ u8: &#123;&#125;"</span><span class="token punctuation">,</span> n1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºç”Ÿæˆ u16: &#123;&#125;"</span><span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºç”Ÿæˆ u32: &#123;&#125;"</span><span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºç”Ÿæˆ i32: &#123;&#125;"</span><span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºç”Ÿæˆ float: &#123;&#125;"</span><span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">f64</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">éšæœºç”Ÿæˆ u8: <span class="token number">158</span>éšæœºç”Ÿæˆ u16: <span class="token number">26703</span>éšæœºç”Ÿæˆ u32: <span class="token number">2989669353</span>éšæœºç”Ÿæˆ i32: <span class="token parameter variable">-1944070083</span>éšæœºç”Ÿæˆ float: <span class="token number">0.6281595400384855</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-ç”ŸæˆèŒƒå›´å†…éšæœºæ•°">1.2 ç”ŸæˆèŒƒå›´å†…éšæœºæ•°</h3><p>â€ƒâ€ƒä½¿ç”¨ <code>Rng::gen_range</code>ï¼Œåœ¨åŠå¼€æ”¾çš„ <code>[0, 10)</code> èŒƒå›´å†…ï¼ˆä¸åŒ…æ‹¬ <code>10</code>ï¼‰ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ•´å‹Integer: &#123;&#125;"</span><span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æµ®ç‚¹å‹Float: &#123;&#125;"</span><span class="token punctuation">,</span> rng<span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">..</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ•´å‹Integer: <span class="token number">7</span>æµ®ç‚¹å‹Float: <span class="token number">4.609263483162893</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>â€ƒâ€ƒä½¿ç”¨ <code>Uniform</code> æ¨¡å—å¯ä»¥å¾—åˆ°å‡åŒ€åˆ†å¸ƒçš„å€¼ã€‚ä¸‹è¿°ä»£ç å’Œä¸Šè¿°ä»£ç å…·æœ‰ç›¸åŒçš„æ•ˆæœï¼Œä½†åœ¨ç›¸åŒèŒƒå›´å†…é‡å¤ç”Ÿæˆæ•°å­—æ—¶ï¼Œä¸‹è¿°ä»£ç æ€§èƒ½å¯èƒ½ä¼šæ›´å¥½ã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span>distributions<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Distribution</span><span class="token punctuation">,</span> <span class="token class-name">Uniform</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> die <span class="token operator">=</span> <span class="token class-name">Uniform</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">..</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">loop</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> throw <span class="token operator">=</span> die<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> rng<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æ·éª°å­: &#123;&#125;"</span><span class="token punctuation">,</span> throw<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> throw <span class="token operator">==</span> <span class="token number">6</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æ·éª°å­: <span class="token number">3</span>æ·éª°å­: <span class="token number">1</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">4</span>æ·éª°å­: <span class="token number">4</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">1</span>æ·éª°å­: <span class="token number">4</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">2</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">4</span>æ·éª°å­: <span class="token number">1</span>æ·éª°å­: <span class="token number">5</span>æ·éª°å­: <span class="token number">4</span>æ·éª°å­: <span class="token number">6</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-ç”Ÿæˆç»™å®šåˆ†å¸ƒéšæœºæ•°">1.3 ç”Ÿæˆç»™å®šåˆ†å¸ƒéšæœºæ•°</h3><p>â€ƒâ€ƒé»˜è®¤æƒ…å†µä¸‹ï¼Œéšæœºæ•°åœ¨ <code>rand</code> crate ä¸­æ˜¯å‡åŒ€åˆ†å¸ƒã€‚<code>rand_distr</code>(å¯é€šè¿‡<code>cargo add rand_distr</code> å®‰è£…) crate æä¾›å…¶å®ƒçš„åˆ†å¸ƒç±»å‹ã€‚å¦‚è¦ä½¿ç”¨ï¼Œé¦–å…ˆå®ä¾‹åŒ–ä¸€ä¸ªåˆ†å¸ƒï¼Œç„¶ååœ¨éšæœºæ•°ç”Ÿæˆå™¨<code>rand::Rng</code> çš„å¸®åŠ©ä¸‹ï¼Œä½¿ç”¨ <code>Distribution::sample</code> ä»è¯¥åˆ†å¸ƒä¸­è¿›è¡Œé‡‡æ ·ã€‚å¦‚ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨æ­£æ€ï¼ˆ<code>Normal</code>ï¼‰åˆ†å¸ƒçš„å®ä¾‹</p><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">rand</span> <span class="token punctuation">=</span> <span class="token string">"0.8.5"</span><span class="token key property">rand_distr</span> <span class="token punctuation">=</span> <span class="token string">"0.4.3"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand_distr<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Distribution</span><span class="token punctuation">,</span> <span class="token class-name">Normal</span><span class="token punctuation">,</span> <span class="token class-name">NormalError</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span>thread_rng<span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">NormalError</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> normal <span class="token operator">=</span> <span class="token class-name">Normal</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> normal<span class="token punctuation">.</span><span class="token function">sample</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> rng<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125; æ¥è‡ª N(2, 9) åˆ†å¸ƒ"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">4.025748774397368</span> æ¥è‡ª N<span class="token punctuation">(</span><span class="token number">2</span>, <span class="token number">9</span><span class="token punctuation">)</span> åˆ†å¸ƒ<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-4-ç”Ÿæˆè‡ªå®šä¹‰ç±»å‹éšæœºå€¼">1.4 ç”Ÿæˆè‡ªå®šä¹‰ç±»å‹éšæœºå€¼</h3><p>â€ƒâ€ƒéšæœºç”Ÿæˆä¸€ä¸ªå…ƒç»„ <code>(i32, bool, f64)</code> å’Œç”¨æˆ·å®šä¹‰ç±»å‹ä¸º <code>Point</code> çš„å˜é‡ã€‚ä¸º <code>Standard</code> å®ç° <code>Distribution</code> <code>trait</code>ï¼Œä»¥å…è®¸å…¶éšæœºç”Ÿæˆã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span>distributions<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span><span class="token class-name">Distribution</span><span class="token punctuation">,</span> <span class="token class-name">Standard</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Debug)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span> <span class="token punctuation">&#123;</span>    x<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>    y<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">Distribution</span><span class="token operator">&lt;</span><span class="token class-name">Point</span><span class="token operator">></span> <span class="token keyword">for</span> <span class="token class-name">Standard</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">fn</span> <span class="token function-definition function">sample</span><span class="token operator">&lt;</span><span class="token class-name">R</span><span class="token punctuation">:</span> <span class="token class-name">Rng</span> <span class="token operator">+</span> <span class="token operator">?</span><span class="token class-name">Sized</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> rng<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token class-name">R</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token punctuation">(</span>rand_x<span class="token punctuation">,</span> rand_y<span class="token punctuation">)</span> <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Point</span> <span class="token punctuation">&#123;</span>            x<span class="token punctuation">:</span> rand_x<span class="token punctuation">,</span>            y<span class="token punctuation">:</span> rand_y<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rand_tuple <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">,</span> <span class="token keyword">f64</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> rand_point<span class="token punctuation">:</span> <span class="token class-name">Point</span> <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºå…ƒç»„: &#123;:?&#125;"</span><span class="token punctuation">,</span> rand_tuple<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºåæ ‡: &#123;:?&#125;"</span><span class="token punctuation">,</span> rand_point<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">éšæœºå…ƒç»„: <span class="token punctuation">(</span>-410099798, true, <span class="token number">0.3339881538362096</span><span class="token punctuation">)</span>éšæœºåæ ‡: Point <span class="token punctuation">&#123;</span> x: <span class="token number">1211748610</span>, y: <span class="token parameter variable">-959131956</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-5-ä»ä¸€ç»„å­—æ¯æ•°å­—å­—ç¬¦ç”Ÿæˆéšæœºå¯†ç ">1.5 ä»ä¸€ç»„å­—æ¯æ•°å­—å­—ç¬¦ç”Ÿæˆéšæœºå¯†ç </h3><p>â€ƒâ€ƒéšæœºç”Ÿæˆä¸€ä¸ªç»™å®šé•¿åº¦çš„ <code>ASCII</code> å­—ç¬¦ä¸²ï¼ŒèŒƒå›´ä¸º <code>A-Z</code>ï¼Œ<code>a-z</code>ï¼Œ<code>0-9</code>ï¼Œä½¿ç”¨å­—æ¯æ•°å­—æ ·æœ¬</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token punctuation">&#123;</span>thread_rng<span class="token punctuation">,</span> <span class="token class-name">Rng</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span>distributions<span class="token punctuation">::</span></span><span class="token class-name">Alphanumeric</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> rand_string<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">sample_iter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Alphanumeric</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">::</span>from<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"éšæœºå¯†ç : &#123;&#125;"</span><span class="token punctuation">,</span> rand_string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">éšæœºå¯†ç : bksgkrXebcPo3ZsW<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-6-ä»ä¸€ç»„ç”¨æˆ·å®šä¹‰å­—ç¬¦åˆ›å»ºéšæœºå¯†ç ">1.6 ä»ä¸€ç»„ç”¨æˆ·å®šä¹‰å­—ç¬¦åˆ›å»ºéšæœºå¯†ç </h3><p>â€ƒâ€ƒä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„å­—èŠ‚å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ <code>gen_range</code> å‡½æ•°ï¼Œéšæœºç”Ÿæˆä¸€ä¸ªç»™å®šé•¿åº¦çš„ <code>ASCII</code> å­—ç¬¦ä¸²</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token class-name">Rng</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token constant">CHARSET</span><span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">b"ABCDEFGHIJKLMNOPQRSTUVWXYZ\                            abcdefghijklmnopqrstuvwxyz\                            0123456789)(*&amp;^%$#@!~"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> <span class="token constant">PASSWORD_LEN</span><span class="token punctuation">:</span> <span class="token keyword">usize</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> rng <span class="token operator">=</span> <span class="token namespace">rand<span class="token punctuation">::</span></span><span class="token function">thread_rng</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> password<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token constant">PASSWORD_LEN</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> idx <span class="token operator">=</span> rng<span class="token punctuation">.</span><span class="token function">gen_range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token constant">CHARSET</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token constant">CHARSET</span><span class="token punctuation">[</span>idx<span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">char</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"æŒ‡å®šå­—ç¬¦éšæœºå¯†ç : &#123;&#125;"</span><span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¨‹åºè¾“å‡ºç»“æœ</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æŒ‡å®šå­—ç¬¦éšæœºå¯†ç : Rz<span class="token operator">!</span>eVvWN<span class="token punctuation">)</span>Xg5OYae<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-Vector-æ’åº">2. <code>Vector</code> æ’åº</h2><h3 id="2-1-æ•´æ•°-Vector-æ’åº">2.1 æ•´æ•° <code>Vector</code> æ’åº</h3><p>â€ƒâ€ƒé€šè¿‡ <code>vec::sort</code> å¯¹ä¸€ä¸ªæ•´æ•° <code>Vector</code> è¿›è¡Œæ’åºã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <code>vec::sort_unstable</code>ï¼Œåè€…è¿è¡Œé€Ÿåº¦æ›´å¿«ä¸€äº›ï¼Œä½†ä¸ä¿æŒç›¸ç­‰å…ƒç´ çš„é¡ºåºã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        vec<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-Vector-æ’åº">2.2 <code>Vector</code> æ’åº</h3><p>â€ƒâ€ƒå¯¹äº<code>f32</code> æˆ– <code>f64</code> çš„ <code>vectorï¼Œå¯ä»¥ä½¿ç”¨</code> <code>vec::sort_by</code> å’Œ <code>PartialOrd::partial_cmp</code> å¯¹å…¶è¿›è¡Œæ’åº</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1.15</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">,</span> <span class="token number">1.123</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    vec<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> a<span class="token punctuation">.</span><span class="token function">partial_cmp</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>vec<span class="token punctuation">,</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">1.123</span><span class="token punctuation">,</span> <span class="token number">1.15</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">5.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-ç»“æ„ä½“-Vector-æ’åº">2.3 ç»“æ„ä½“ <code>Vector</code> æ’åº</h3><p>â€ƒâ€ƒä¾æ®è‡ªç„¶é¡ºåºï¼ˆæŒ‰åç§°å’Œå¹´é¾„ï¼‰ï¼Œå¯¹å…·æœ‰ <code>name</code> å’Œ <code>age</code> å±æ€§çš„ <code>Person</code> ç»“æ„ä½“ <code>Vector</code> æ’åºã€‚ä¸ºäº†ä½¿ <code>Person</code> å¯æ’åºï¼Œéœ€è¦æ·»åŠ <code>traits</code>ï¼š<code>PartialEq</code>ã€‚è¿™æ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>vec:sort_by</code> æ–¹æ³•è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼Œå¦‚æŒ‰ç…§å¹´é¾„æ’åºã€‚</p><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">Ordering</span><span class="token punctuation">;</span><span class="token attribute attr-name">#[derive(Debug, PartialEq)]</span><span class="token keyword">struct</span> <span class="token type-definition class-name">Person</span> <span class="token punctuation">&#123;</span>    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>    age<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span>    salary<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">impl</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> age<span class="token punctuation">:</span> <span class="token keyword">u32</span><span class="token punctuation">,</span> salary<span class="token punctuation">:</span> <span class="token keyword">f64</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> salary <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> people <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>        <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Zoe"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">9483.54</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Al"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">2433.64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">6433.34</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// æ ¹æ® name å€¼å¯¹ people è¿›è¡Œæ’åº</span>    people<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> a<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        people<span class="token punctuation">,</span>        <span class="token macro property">vec!</span><span class="token punctuation">[</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Al"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">2433.64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">6433.34</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Zoe"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">9483.54</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// æ ¹æ® age å€¼å¯¹ people è¿›è¡Œæ’åº(ä»å°åˆ°å¤§)</span>    people<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> a<span class="token punctuation">.</span>age<span class="token punctuation">.</span><span class="token function">cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>b<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        people<span class="token punctuation">,</span>        <span class="token macro property">vec!</span><span class="token punctuation">[</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">6433.34</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Zoe"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">9483.54</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Al"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">2433.64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// // æ ¹æ® salary å€¼å¯¹ people è¿›è¡Œæ’åº(ä»å¤§åˆ°å°)</span>    people<span class="token punctuation">.</span><span class="token function">sort_by</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>a<span class="token punctuation">,</span> b<span class="token closure-punctuation punctuation">|</span></span> b<span class="token punctuation">.</span>salary<span class="token punctuation">.</span><span class="token function">partial_cmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>a<span class="token punctuation">.</span>salary<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token class-name">Ordering</span><span class="token punctuation">::</span><span class="token class-name">Equal</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>        people<span class="token punctuation">,</span>        <span class="token macro property">vec!</span><span class="token punctuation">[</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Zoe"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">9483.54</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token number">6433.34</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">Person</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token string">"Al"</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">2433.64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
            <tag> rustcookbook </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rustæ‚è®°ã€‘2023-03-13-å‹ç¼©æ•°æ®å’Œè§£å‹æ•°æ®</title>
      <link href="/news/1678714773864.html"/>
      <url>/news/1678714773864.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä½¿ç”¨compresså‹ç¼©æ–‡ä»¶">1. ä½¿ç”¨compresså‹ç¼©æ–‡ä»¶</h2><h3 id="1-1-ä½¿ç”¨åˆ°çš„åº“flate2-é…ç½®æ–‡ä»¶Cargo-tomlä¸­æ·»åŠ -æˆ–é€šè¿‡cargo-add-flate2-æ·»åŠ ">1.1 ä½¿ç”¨åˆ°çš„åº“<code>flate2</code>,é…ç½®æ–‡ä»¶Cargo.tomlä¸­æ·»åŠ (æˆ–é€šè¿‡cargo add flate2 æ·»åŠ )</h3><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">flate2</span> <span class="token punctuation">=</span> <span class="token string">"1.0.25"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-2-ä½¿ç”¨åº“flate2å‹ç¼©ä»£ç ">1.2 ä½¿ç”¨åº“<code>flate2</code>å‹ç¼©ä»£ç </h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span>write<span class="token punctuation">::</span></span><span class="token class-name">GzEncoder</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">flate2<span class="token punctuation">::</span></span><span class="token class-name">Compression</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span>args<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span>copy<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>io<span class="token punctuation">::</span></span><span class="token class-name">BufReader</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>time<span class="token punctuation">::</span></span><span class="token class-name">Instant</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åœ¨real_mainå‡½æ•°ä¸­å¤„ç†çœŸæ­£çš„ç¨‹åº</span>    <span class="token comment">//ä¸ºäº†å¹²å‡€çš„ç»“æŸå’Œé€€å‡ºï¼Œåœ¨ä¸»å‡½æ•°ä¸­ä½¿ç”¨å®ƒ</span>    <span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token function">real_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">real_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"Usage: `source` `target`"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> input <span class="token operator">=</span> <span class="token class-name">BufReader</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nth</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> <span class="token class-name">GzEncoder</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> <span class="token class-name">Compression</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token class-name">Instant</span><span class="token punctuation">::</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">copy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> input<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> encoder<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> output <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span>        <span class="token string">"æºæ–‡ä»¶å¤§å°: &#123;:?&#125;"</span><span class="token punctuation">,</span>        input<span class="token punctuation">.</span><span class="token function">get_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡æ–‡ä»¶å¤§å°: &#123;:?&#125;"</span><span class="token punctuation">,</span> output<span class="token punctuation">.</span><span class="token function">metadata</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"å‹ç¼©æ—¶é—´: &#123;:?&#125;"</span><span class="token punctuation">,</span> start<span class="token punctuation">.</span><span class="token function">elapsed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-ä½¿ç”¨æ–¹å¼ï¼ˆä»¥book-pdfä¸ºä¾‹ï¼‰">1.3 ä½¿ç”¨æ–¹å¼ï¼ˆä»¥book.pdfä¸ºä¾‹ï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run book.pdf book<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-4-è¿è¡Œè¾“å‡ºç»“æœ">1.4 è¿è¡Œè¾“å‡ºç»“æœ</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">æºæ–‡ä»¶å¤§å°: <span class="token number">2307697</span>ç›®æ ‡æ–‡ä»¶å¤§å°: <span class="token number">1885921</span>å‹ç¼©æ—¶é—´: <span class="token number">1</span>.703851963s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2-ä½¿ç”¨decompressè§£å‹æ–‡ä»¶-ä»¥è§£å‹zipæ ¼å¼æ–‡ä»¶ä¸ºä¾‹">2. ä½¿ç”¨decompressè§£å‹æ–‡ä»¶(ä»¥è§£å‹<code>zip</code>æ ¼å¼æ–‡ä»¶ä¸ºä¾‹)</h2><h3 id="2-1-ä½¿ç”¨åˆ°çš„åº“zip-é…ç½®æ–‡ä»¶Cargo-tomlä¸­æ·»åŠ -æˆ–é€šè¿‡cargo-add-zipæ·»åŠ ">2.1 ä½¿ç”¨åˆ°çš„åº“<code>zip</code>,é…ç½®æ–‡ä»¶<code>Cargo.toml</code>ä¸­æ·»åŠ (æˆ–é€šè¿‡<code>cargo add zip</code>æ·»åŠ )</h3><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">zip</span> <span class="token punctuation">=</span> <span class="token string">"0.6.4"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-2-ä½¿ç”¨åº“è§£å‹ä»£ç ">2.2 ä½¿ç”¨åº“è§£å‹ä»£ç </h3><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>fs<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span></span>io<span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>path<span class="token punctuation">::</span></span><span class="token class-name">Path</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token namespace">zip<span class="token punctuation">::</span></span><span class="token class-name">ZipArchive</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åœ¨real_mainå‡½æ•°ä¸­å¤„ç†çœŸæ­£çš„ç¨‹åº</span>    <span class="token comment">//ä¸ºäº†å¹²å‡€çš„ç»“æŸå’Œé€€å‡ºï¼Œåœ¨ä¸»å‡½æ•°ä¸­ä½¿ç”¨å®ƒ</span>    <span class="token namespace">std<span class="token punctuation">::</span>process<span class="token punctuation">::</span></span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token function">real_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">real_main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">i32</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åˆ›å»ºä¸€ä¸ªåä¸º args çš„å‘é‡æ¥æ”¶é›†ç”¨æˆ·åœ¨ CLI ä¸­çš„è¾“å…¥</span>    <span class="token keyword">let</span> args<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">args</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//å¦‚æœ args å°äº 2ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ï¼Œå› ä¸ºä½ éœ€è¦å‘é€</span>    <span class="token comment">// zip æ–‡ä»¶ï¼Œå®ƒä¼šå‘Šè¯‰ä½ å¦‚ä½•ä½¿ç”¨</span>    <span class="token keyword">if</span> args<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"Usage: &#123;&#125; &lt;filename>"</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//argsåœ¨ç¬¬2ä¸ªä½ç½®ï¼Œç¬¬ä¸€ä¸ªç´¢å¼•è¡¨ç¤ºçš„æ˜¯æ–‡ä»¶å</span>    <span class="token keyword">let</span> fname <span class="token operator">=</span> <span class="token class-name">Path</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">*</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ä½¿ç”¨æ ‡å‡†fsæ‰“å¼€æ–‡ä»¶</span>    <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ä½¿ç”¨å­˜æ¡£é˜…è¯»å™¨åŠŸèƒ½</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> archive <span class="token operator">=</span> <span class="token class-name">ZipArchive</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//ä»0å¼€å§‹ï¼Œè¦†ç›–æ•´ä¸ªarchiveçš„é•¿åº¦</span>    <span class="token comment">// zip å­˜æ¡£ä¸­ä¼šæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æå–æ‰€æœ‰æ–‡ä»¶</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token number">0</span><span class="token punctuation">..</span>archive<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> <span class="token keyword">mut</span> file <span class="token operator">=</span> archive<span class="token punctuation">.</span><span class="token function">by_index</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è®¾ç½®æå–æ–‡ä»¶çš„è·¯å¾„</span>        <span class="token keyword">let</span> outpath <span class="token operator">=</span> <span class="token keyword">match</span> file<span class="token punctuation">.</span><span class="token function">enclosed_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Some</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">to_owned</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token class-name">None</span> <span class="token operator">=></span> <span class="token keyword">continue</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> comment <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">comment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token operator">!</span>comment<span class="token punctuation">.</span><span class="token function">is_empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"File &#123;&#125; comment: &#123;&#125;"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> comment<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// zip ä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–æ–‡ä»¶å¤¹</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">*</span>file<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ends_with</span><span class="token punctuation">(</span><span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"è®¾ç½®æ–‡ä»¶å¤¹è·¯å¾„ &#123;&#125; çš„ç›®å½• \"&#123;&#125;\""</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> outpath<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//é€’å½’åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•</span>            <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">create_dir_all</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outpath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token macro property">println!</span><span class="token punctuation">(</span>                <span class="token string">"æ–‡ä»¶ &#123;&#125; æå–åˆ° \"&#123;&#125;\" (&#123;&#125; bytes)"</span><span class="token punctuation">,</span>                i<span class="token punctuation">,</span>                outpath<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                file<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å¦‚æœè¿™äº›æ–‡ä»¶æ²¡æœ‰çˆ¶ç›®å½•ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•</span>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">=</span> outpath<span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token operator">!</span>p<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">create_dir_all</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">let</span> <span class="token keyword">mut</span> outfile <span class="token operator">=</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">File</span><span class="token punctuation">::</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outpath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token namespace">io<span class="token punctuation">::</span></span><span class="token function">copy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> file<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> outfile<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// Linuxä¸‹è·å–å’Œè®¾ç½®æå–æ–‡ä»¶çš„æƒé™</span>        <span class="token attribute attr-name">#[cfg(unix)]</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>os<span class="token punctuation">::</span>unix<span class="token punctuation">::</span>fs<span class="token punctuation">::</span></span><span class="token class-name">PermissionsExt</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">unix_mode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token function">set_permissions</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>outpath<span class="token punctuation">,</span> <span class="token namespace">fs<span class="token punctuation">::</span></span><span class="token class-name">Permissions</span><span class="token punctuation">::</span><span class="token function">from_mode</span><span class="token punctuation">(</span>mode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-ä½¿ç”¨æ–¹å¼ï¼ˆä»¥images-zipä¸ºä¾‹ï¼‰">2.3 ä½¿ç”¨æ–¹å¼ï¼ˆä»¥images.zipä¸ºä¾‹ï¼‰</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cargo</span> run images.zip <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-4-è¿è¡Œç»“æœ">2.4 è¿è¡Œç»“æœ</h3><ul><li>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">è®¾ç½®æ–‡ä»¶å¤¹è·¯å¾„ <span class="token number">0</span> çš„ç›®å½• <span class="token string">"images/"</span>è®¾ç½®æ–‡ä»¶å¤¹è·¯å¾„ <span class="token number">1</span> çš„ç›®å½• <span class="token string">"images/axif/"</span>æ–‡ä»¶ <span class="token number">2</span> æå–åˆ° <span class="token string">"images/axif/img3.avif"</span> <span class="token punctuation">(</span><span class="token number">34794</span> bytes<span class="token punctuation">)</span>æ–‡ä»¶ <span class="token number">3</span> æå–åˆ° <span class="token string">"images/img1.jpg"</span> <span class="token punctuation">(</span><span class="token number">721480</span> bytes<span class="token punctuation">)</span>æ–‡ä»¶ <span class="token number">4</span> æå–åˆ° <span class="token string">"images/img2.jpg"</span> <span class="token punctuation">(</span><span class="token number">715163</span> bytes<span class="token punctuation">)</span>è§£å‹æ—¶é—´: <span class="token number">134</span>.253736ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è§£å‹æ–‡ä»¶è·¯å¾„å¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">imagesâ”œâ”€â”€ axifâ”‚   â””â”€â”€ img3.avifâ”œâ”€â”€ img1.jpgâ””â”€â”€ img2.jpg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rustæ‚è®°ã€‘æ ‡å‡†åº“ä¸­çš„æ•°æ®ç»“æ„ä¸ç®—æ³•</title>
      <link href="/news/1678627821546.html"/>
      <url>/news/1678627821546.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ•°æ®ç»“æ„">1. æ•°æ®ç»“æ„</h2><p>â€ƒâ€ƒRustçš„æ ‡å‡†åº“æä¾›äº†å‡ ç§æ•°æ®ç»“æ„ï¼Œå¯ç”¨äºä»¥å„ç§æ–¹å¼å­˜å‚¨å’Œæ“ä½œæ•°æ®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li><code>Vec&lt;T&gt;</code>ï¼šä¸€ä¸ªå¯å¢é•¿çš„æ•°ç»„ï¼Œå¯ä»¥å­˜å‚¨å¯å˜æ•°é‡çš„Tç±»å‹å…ƒç´ ã€‚å®ƒè¢«å®ç°ä¸ºä¸€ä¸ªåŠ¨æ€åˆ†é…çš„æ•°ç»„ï¼Œå¹¶æä¾›å¯¹å…¶å…ƒç´ çš„æœ‰æ•ˆè®¿é—®ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>LinkedList&lt;T&gt;</code>ï¼šä¸€ä¸ªåŒé“¾è¡¨ï¼Œå¯ä»¥å­˜å‚¨å¯å˜æ•°é‡çš„ç±»å‹Tçš„å…ƒç´ ã€‚å®ƒå…è®¸æœ‰æ•ˆåœ°æ’å…¥å’Œåˆ é™¤åˆ—è¡¨ä¸¤ç«¯çš„å…ƒç´ ï¼Œä½†ä¸Vec<T>ç›¸æ¯”ï¼Œå®ƒå¯¹å•ä¸ªå…ƒç´ çš„è®¿é—®é€Ÿåº¦è¾ƒæ…¢ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">LinkedList</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> list <span class="token operator">=</span> <span class="token class-name">LinkedList</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    list<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">front</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>HashMap&lt;K, V&gt;</code>ï¼šä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå¯ä»¥å­˜å‚¨ä»Kç±»å‹é”®åˆ°Vç±»å‹å€¼çš„æ˜ å°„ã€‚å®ƒæä¾›äº†åŸºäºé”®å€¼çš„é«˜æ•ˆæ’å…¥ã€åˆ é™¤å’ŒæŸ¥æ‰¾ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> map <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    map<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-ç®—æ³•">2. ç®—æ³•</h2><p>â€ƒâ€ƒRustæ ‡å‡†åº“è¿˜æä¾›äº†è®¸å¤šç®—æ³•ï¼Œå¯ç”¨äºå¯¹æ•°æ®æ‰§è¡Œå¸¸ç”¨æ“ä½œã€‚å¦‚ä¸‹æ‰€ç¤º:</p><ul><li><code>sort</code>ï¼šä½¿ç”¨ç¨³å®šçš„æ’åºç®—æ³•å¯¹åˆ‡ç‰‡è¿›è¡Œå°±åœ°æ’åºã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    v<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>binary_search</code>ï¼šå¯¹æ’åºçš„åˆ‡ç‰‡æ‰§è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼Œä»¥æŸ¥æ‰¾ç»™å®šå…ƒç´ çš„ç´¢å¼•ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">binary_search</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">binary_search</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>iter::sum</code>ï¼šè®¡ç®—è¿­ä»£å™¨ä¸­å…ƒç´ çš„å’Œã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> sum<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>find</code>ï¼šæŸ¥æ‰¾è¿­ä»£å™¨ä¸­æ»¡è¶³ç»™å®šé—­åŒ…çš„ç¬¬ä¸€ä¸ªå…ƒç´ ,ä»¥ä¸‹2ç§å½¢å¼ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> first_even <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span>x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>first_even<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> first_even <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token operator">&amp;</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>first_even<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>min</code>å’Œ<code>max</code>ï¼šåˆ†åˆ«æŸ¥æ‰¾è¿­ä»£å™¨ä¸­çš„æœ€å°å’Œæœ€å¤§å…ƒç´ ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> min <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> max <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>all</code>å’Œ<code>any</code>ï¼šåˆ†åˆ«ç¡®å®šè¿­ä»£å™¨ä¸­çš„æ‰€æœ‰å…ƒç´ æˆ–ä»»ä¸€å…ƒç´ æ˜¯å¦æ»¡è¶³ç»™å®šçš„é—­åŒ…ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> all_even <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> any_even <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>all_even<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>any_even<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>fold</code>ï¼šåœ¨è¿­ä»£å™¨ä¸Šæ‰§è¡Œfoldæ“ä½œï¼Œæ ¹æ®è¿­ä»£å™¨çš„å…ƒç´ ç´¯ç§¯ä¸€ä¸ªå€¼ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token comment">// foldå‡½æ•°ç¬¬ä¸€ä¸ªæ˜¯åˆå§‹å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œé—­åŒ…ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç´¯è®¡å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æœ¬æ¬¡è¿­ä»£å…ƒç´ çš„å¼•ç”¨ï¼Œè¿”å›å€¼ä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£çš„ç´¯è®¡å€¼ã€‚</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> sum<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> x<span class="token closure-punctuation punctuation">|</span></span> acc <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç›¸å½“äº 2 + ï¼ˆ(((1 + 2) + 3) + 4) + 5ï¼‰</span>    <span class="token keyword">let</span> mul<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fold</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>acc<span class="token punctuation">,</span> x<span class="token closure-punctuation punctuation">|</span></span> acc <span class="token operator">*</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//ç›¸å½“äº 3 * ï¼ˆ(((1 * 2) * 3) * 4) * 5ï¼‰</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>sum<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>mul<span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>map</code>: å³æ˜¯å¯¹è¿­ä»£çš„å…ƒç´ è¿›è¡Œä¸€æ¬¡æ˜ å°„åå†è¿”å›æ˜ å°„åçš„ç»“æœ,<code>collect</code>æ˜¯å°†ä¸€ä¸ªè¿­ä»£å™¨è¿­ä»£çš„æ‰€æœ‰å…ƒç´ ç»„åˆæˆä¸€ä¸ªæ–°çš„é›†åˆ</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> vec_str <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">>></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>vec_str<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> vec <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> vec_str<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> vec<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>x<span class="token closure-punctuation punctuation">|</span></span> x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>vec_str<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>filter</code> æ˜¯ä¸€ä¸ªè¿­ä»£å™¨é€‚é…å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªé—­åŒ…ä½œä¸ºå‚æ•°ï¼Œè¯¥é—­åŒ…è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li></ul><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> v <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// é”™è¯¯ç¤ºä¾‹ 1</span>    <span class="token comment">// let list1: Vec&lt;_> = v.iter().filter(|i| i % 3 == 0).collect();</span>    <span class="token comment">// let list2 = [0, 3, 6];</span>    <span class="token comment">// assert_eq!(list1, list2);</span>    <span class="token comment">// é”™è¯¯ç¤ºä¾‹ 2</span>    <span class="token comment">// let list1: Vec&lt;_> = v.iter().filter(|i| **i % 3 == 0).collect();</span>    <span class="token comment">// let list2 = [0, 3, 6];</span>    <span class="token comment">// assert_eq!(list1, list2);</span>    <span class="token comment">// é”™è¯¯ç¤ºä¾‹ 3</span>    <span class="token comment">// let list1: Vec&lt;_> = v.iter().filter(|i| **i % 3 == 0).copied().collect();</span>    <span class="token comment">// let list2 = [0, 3, 6];</span>    <span class="token comment">// assert_eq!(list1, list2);</span>    <span class="token comment">// é”™è¯¯ç¤ºä¾‹ 4</span>    <span class="token comment">// let list1: Vec&lt;_> = v.iter().filter(|i| **i % 3 == 0).copied().collect();</span>    <span class="token comment">// assert_eq!(list1, [0, 3, 6]);</span>    <span class="token comment">// æ­£ç¡®ç¤ºä¾‹ </span>    <span class="token keyword">let</span> list1<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span>_<span class="token operator">></span> <span class="token operator">=</span> v<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>i<span class="token closure-punctuation punctuation">|</span></span> <span class="token operator">*</span><span class="token operator">*</span>i <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">copied</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> list2 <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>list1<span class="token punctuation">,</span> list2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Rustæ‚è®°ã€‘è¯»å–CSVæ–‡ä»¶</title>
      <link href="/news/1678456159235.html"/>
      <url>/news/1678456159235.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‡è®¾å¯¹ä»¥ä¸‹nba-csvæ–‡ä»¶è¿›è¡Œè¯»å–">1. å‡è®¾å¯¹ä»¥ä¸‹<code>nba.csv</code>æ–‡ä»¶è¿›è¡Œè¯»å–</h2><pre class="line-numbers language-csv" data-language="csv"><code class="language-csv"><span class="token value">å§“å</span><span class="token punctuation">,</span><span class="token value">å›¢é˜Ÿ</span><span class="token punctuation">,</span><span class="token value">å·ç </span><span class="token punctuation">,</span><span class="token value">èŒä½</span><span class="token punctuation">,</span><span class="token value">å¹´é¾„</span><span class="token punctuation">,</span><span class="token value">èº«é«˜</span><span class="token punctuation">,</span><span class="token value">ä½“é‡</span><span class="token punctuation">,</span><span class="token value">å¤§å­¦</span><span class="token punctuation">,</span><span class="token value">è–ªæ°´</span><span class="token value">åŸƒå¼—é‡ŒÂ·å¸ƒæ‹‰å¾·åˆ©</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">0.0</span><span class="token punctuation">,</span><span class="token value">PG</span><span class="token punctuation">,</span><span class="token value">25.0</span><span class="token punctuation">,</span><span class="token value">6-2</span><span class="token punctuation">,</span><span class="token value">180.0</span><span class="token punctuation">,</span><span class="token value">Texas</span><span class="token punctuation">,</span><span class="token value">7730337.0</span><span class="token value">æ°Â·å…‹åŠ³å¾·</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">99.0</span><span class="token punctuation">,</span><span class="token value">SF</span><span class="token punctuation">,</span><span class="token value">25.0</span><span class="token punctuation">,</span><span class="token value">6-6</span><span class="token punctuation">,</span><span class="token value">235.0</span><span class="token punctuation">,</span><span class="token value">é©¬å¥ç‰¹</span><span class="token punctuation">,</span><span class="token value">6796117.0</span><span class="token value">çº¦ç¿°Â·éœå…°</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">30.0</span><span class="token punctuation">,</span><span class="token value">SG</span><span class="token punctuation">,</span><span class="token value">27.0</span><span class="token punctuation">,</span><span class="token value">6-5</span><span class="token punctuation">,</span><span class="token value">205.0</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å¤§å­¦</span><span class="token punctuation">,</span><span class="token value">R.J. äº¨ç‰¹</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">28.0</span><span class="token punctuation">,</span><span class="token value">SG</span><span class="token punctuation">,</span><span class="token value">22.0</span><span class="token punctuation">,</span><span class="token value">6-5</span><span class="token punctuation">,</span><span class="token value">185.0</span><span class="token punctuation">,</span><span class="token value">ä½æ²»äºšå·</span><span class="token punctuation">,</span><span class="token value">1148640.0</span><span class="token value">æ°é›·å¸ƒç§‘</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">8.0</span><span class="token punctuation">,</span><span class="token value">å¤§å‰é”‹</span><span class="token punctuation">,</span><span class="token value">29.0</span><span class="token punctuation">,</span><span class="token value">6-10</span><span class="token punctuation">,</span><span class="token value">231.0</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token value">5000000.0</span><span class="token value">é˜¿ç±³å°”çº¦ç¿°é€Š</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">90.0</span><span class="token punctuation">,</span><span class="token value">å¤§å‰é”‹</span><span class="token punctuation">,</span><span class="token value">29.0</span><span class="token punctuation">,</span><span class="token value">6-9</span><span class="token punctuation">,</span><span class="token value">240.0</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token value">12000000.0</span><span class="token value">ä¹”ä¸¹ç±³å¥‡</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">55.0</span><span class="token punctuation">,</span><span class="token value">PF</span><span class="token punctuation">,</span><span class="token value">21.0</span><span class="token punctuation">,</span><span class="token value">6-8</span><span class="token punctuation">,</span><span class="token value">235.0</span><span class="token punctuation">,</span><span class="token value">LSU</span><span class="token punctuation">,</span><span class="token value">1170960.0</span><span class="token value">å‡¯åˆ©å¥¥åˆ©å°¼å…‹</span><span class="token punctuation">,</span><span class="token value">æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</span><span class="token punctuation">,</span><span class="token value">41.0</span><span class="token punctuation">,</span><span class="token value">ä¸­é”‹</span><span class="token punctuation">,</span><span class="token value">25.0</span><span class="token punctuation">,</span><span class="token value">7-0</span><span class="token punctuation">,</span><span class="token value">238.0</span><span class="token punctuation">,</span><span class="token value">å†ˆè¨åŠ </span><span class="token punctuation">,</span><span class="token value">2165160.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å…¶å¯¹åº”çš„è¡¨æ ¼å±•ç¤ºå¦‚ä¸‹ï¼š<table><thead><tr><th>å§“å</th><th>å›¢é˜Ÿ</th><th>å·ç </th><th>èŒä½</th><th>å¹´é¾„</th><th>èº«é«˜</th><th>ä½“é‡</th><th>å¤§å­¦</th><th>è–ªæ°´</th></tr></thead><tbody><tr><td>åŸƒå¼—é‡ŒÂ·å¸ƒæ‹‰å¾·åˆ©</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>0.0</td><td>PG</td><td>25.0</td><td>6-2</td><td>180.0</td><td>Texas</td><td>7730337.0</td></tr><tr><td>æ°Â·å…‹åŠ³å¾·</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>99.0</td><td>SF</td><td>25.0</td><td>6-6</td><td>235.0</td><td>é©¬å¥ç‰¹</td><td>6796117.0</td></tr><tr><td>çº¦ç¿°Â·éœå…°</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>30.0</td><td>SG</td><td>27.0</td><td>6-5</td><td>205.0</td><td>æ³¢å£«é¡¿å¤§å­¦</td><td></td></tr><tr><td>R.J. äº¨ç‰¹</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>28.0</td><td>SG</td><td>22.0</td><td>6-5</td><td>185.0</td><td>ä½æ²»äºšå·</td><td>1148640.0</td></tr><tr><td>æ°é›·å¸ƒç§‘</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>8.0</td><td>å¤§å‰é”‹</td><td>29.0</td><td>6-10</td><td>231.0</td><td></td><td>5000000.0</td></tr><tr><td>é˜¿ç±³å°”çº¦ç¿°é€Š</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>90.0</td><td>å¤§å‰é”‹</td><td>29.0</td><td>6-9</td><td>240.0</td><td></td><td>12000000.0</td></tr><tr><td>ä¹”ä¸¹ç±³å¥‡</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>55.0</td><td>PF</td><td>21.0</td><td>6-8</td><td>235.0</td><td>LSU</td><td>1170960.0</td></tr><tr><td>å‡¯åˆ©å¥¥åˆ©å°¼å…‹</td><td>æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ</td><td>41.0</td><td>ä¸­é”‹</td><td>25.0</td><td>7-0</td><td>238.0</td><td>å†ˆè¨åŠ </td><td>2165160.0</td></tr></tbody></table></li></ul><h2 id="2-é…ç½®å®‰è£…åº“CSV">2. é…ç½®å®‰è£…åº“<code>CSV</code></h2><ul><li>å¯ç›´æ¥åœ¨<code>Cargo.toml</code>æ–‡ä»¶ä¸­<code>dependencies</code>ä¸‹æ–¹çš„æ·»åŠ <code>csv = &quot;1.1&quot;</code>ï¼Œä¹Ÿå¯é€šè¿‡<code>cargo add csv</code>å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-toml" data-language="toml"><code class="language-toml"><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span><span class="token key property">csv</span> <span class="token punctuation">=</span> <span class="token string">"1.1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="3-è¯»å–CSVæ–‡ä»¶">3. è¯»å–<code>CSV</code>æ–‡ä»¶</h2><pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span><span class="token keyword">use</span> csv<span class="token punctuation">;</span><span class="token keyword">fn</span> <span class="token function-definition function">read_from_file</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token class-name">Error</span><span class="token operator">>></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token keyword">mut</span> reader <span class="token operator">=</span> <span class="token namespace">csv<span class="token punctuation">::</span></span><span class="token class-name">Reader</span><span class="token punctuation">::</span><span class="token function">from_path</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> result <span class="token keyword">in</span> reader<span class="token punctuation">.</span><span class="token function">records</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> record <span class="token operator">=</span> result<span class="token operator">?</span><span class="token punctuation">;</span>        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;:?&#125;"</span><span class="token punctuation">,</span> record<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">read_from_file</span><span class="token punctuation">(</span><span class="token string">"./nba.csv"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token macro property">eprintln!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-ä¸Šè¿°ä»£ç è¾“å‡ºå†…å®¹å¦‚ä¸‹">4. ä¸Šè¿°ä»£ç è¾“å‡ºå†…å®¹å¦‚ä¸‹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"åŸƒå¼—é‡ŒÂ·å¸ƒæ‹‰å¾·åˆ©"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"0.0"</span>, <span class="token string">"PG"</span>, <span class="token string">"25.0"</span>, <span class="token string">"6-2"</span>, <span class="token string">"180.0"</span>, <span class="token string">"Texas"</span>, <span class="token string">"7730337.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"æ°Â·å…‹åŠ³å¾·"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"99.0"</span>, <span class="token string">"SF"</span>, <span class="token string">"25.0"</span>, <span class="token string">"6-6"</span>, <span class="token string">"235.0"</span>, <span class="token string">"é©¬å¥ç‰¹"</span>, <span class="token string">"6796117.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"çº¦ç¿°Â·éœå…°"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"30.0"</span>, <span class="token string">"SG"</span>, <span class="token string">"27.0"</span>, <span class="token string">"6-5"</span>, <span class="token string">"205.0"</span>, <span class="token string">"æ³¢å£«é¡¿å¤§å­¦"</span>, <span class="token string">""</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"R.J. äº¨ç‰¹"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"28.0"</span>, <span class="token string">"SG"</span>, <span class="token string">"22.0"</span>, <span class="token string">"6-5"</span>, <span class="token string">"185.0"</span>, <span class="token string">"ä½æ²»äºšå·"</span>, <span class="token string">"1148640.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"æ°é›·å¸ƒç§‘"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"8.0"</span>, <span class="token string">"å¤§å‰é”‹"</span>, <span class="token string">"29.0"</span>, <span class="token string">"6-10"</span>, <span class="token string">"231.0"</span>, <span class="token string">""</span>, <span class="token string">"5000000.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"é˜¿ç±³å°”çº¦ç¿°é€Š"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"90.0"</span>, <span class="token string">"å¤§å‰é”‹"</span>, <span class="token string">"29.0"</span>, <span class="token string">"6-9"</span>, <span class="token string">"240.0"</span>, <span class="token string">""</span>, <span class="token string">"12000000.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ä¹”ä¸¹ç±³å¥‡"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"55.0"</span>, <span class="token string">"PF"</span>, <span class="token string">"21.0"</span>, <span class="token string">"6-8"</span>, <span class="token string">"235.0"</span>, <span class="token string">"LSU"</span>, <span class="token string">"1170960.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>StringRecord<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"å‡¯åˆ©å¥¥åˆ©å°¼å…‹"</span>, <span class="token string">"æ³¢å£«é¡¿å‡¯å°”ç‰¹äººé˜Ÿ"</span>, <span class="token string">"41.0"</span>, <span class="token string">"ä¸­é”‹"</span>, <span class="token string">"25.0"</span>, <span class="token string">"7-0"</span>, <span class="token string">"238.0"</span>, <span class="token string">"å†ˆè¨åŠ "</span>, <span class="token string">"2165160.0"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> é”ˆæµªå®« </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csv </tag>
            
            <tag> rust </tag>
            
            <tag> crates </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythonæ‚è®°ã€‘RSAåŠ å¯†ä½¿ç”¨</title>
      <link href="/news/1678453890145.html"/>
      <url>/news/1678453890145.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å®‰è£…-pycryptodome">1. å®‰è£… <code>pycryptodome</code></h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> pycryptodome<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-ä½¿ç”¨å…¬é’¥åŠ å¯†">2. ä½¿ç”¨å…¬é’¥åŠ å¯†</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> requests<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>Cipher <span class="token keyword">import</span> PKCS1_v1_5<span class="token keyword">from</span> Crypto<span class="token punctuation">.</span>PublicKey <span class="token keyword">import</span> RSA<span class="token keyword">def</span> <span class="token function">encrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>    publickey <span class="token operator">=</span> <span class="token triple-quoted-string string">'''-----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsgDq4OqxuEisnk2F0EJFmw4xKa5IrcqEYHvqxPs2CHEg2kolhfWA2SjNuGAHxyDDE5MLtOvzuXjBx/5YJtc9zj2xR/0moesS+Vi/xtG1tkVaTCba+TV+Y5C61iyr3FGqr+KOD4/XECu0Xky1W9ZmmaFADmZi7+6gO9wjgVpU9aLcBcw/loHOeJrCqjp7pA98hRJRY+MML8MK15mnC4ebooOva+mJlstW6t/1lghR8WNV8cocxgcHHuXBxgns2MlACQbSdJ8c6Z3RQeRZBzyjfey6JCCfbEKouVrWIUuPphBL3OANfgp0B+QG31bapvePTfXU48TYK0M5kE+8LgbbWQIDAQAB-----END PUBLIC KEY-----'''</span>    key <span class="token operator">=</span> RSA<span class="token punctuation">.</span>import_key<span class="token punctuation">(</span>publickey<span class="token punctuation">)</span>    passwd <span class="token operator">=</span> PKCS1_v1_5<span class="token punctuation">.</span>new<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    pwd <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>passwd<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> pwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> ç›˜è›‡æ•™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> rsa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythonæ‚è®°ã€‘åˆå¹¶å¤šä¸ª xml æ–‡ä»¶</title>
      <link href="/news/1678265743246.html"/>
      <url>/news/1678265743246.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‡è®¾éœ€è¦å¯¹ä»¥ä¸‹-3-ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶">1. å‡è®¾éœ€è¦å¯¹ä»¥ä¸‹ 3 ä¸ªæ–‡ä»¶è¿›è¡Œåˆå¹¶</h2><ul><li><code>file1.xml</code></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- file1.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>file2.xml</code></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- file2.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item D<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>file3.xml</code></li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- file3.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem X<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>d<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item P<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem Y<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-åˆå¹¶è¾“å‡ºçš„é¢„è®¡ç»“æœä¿å­˜åœ¨-output-xml-ä¸­">2. åˆå¹¶è¾“å‡ºçš„é¢„è®¡ç»“æœä¿å­˜åœ¨ output.xml ä¸­</h2><ul><li>åˆå¹¶æ¡ä»¶æ˜¯æ»¡è¶³ <em><code>&#123;'id': '1','value':'a'&#125;</code></em> çš„æ‰€æœ‰å…ƒç´ </li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- output.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item D<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem X<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem Y<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-åˆå¹¶æ–¹å¼ä¸€ï¼ˆæ ¹èŠ‚ç‚¹ç®€å•çš„æƒ…å†µï¼‰">3. åˆå¹¶æ–¹å¼ä¸€ï¼ˆæ ¹èŠ‚ç‚¹ç®€å•çš„æƒ…å†µï¼‰</h2><ul><li>åˆå¹¶çš„æ–¹æ³•å¦‚<code>merge_xml_files_root</code>æ‰€ç¤º</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">merge_xml_files_root</span><span class="token punctuation">(</span>xml_files<span class="token punctuation">,</span>root_data<span class="token punctuation">,</span>item<span class="token punctuation">,</span>attribs<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span><span class="token punctuation">:</span>    root <span class="token operator">=</span> ET<span class="token punctuation">.</span>Element<span class="token punctuation">(</span>root_data<span class="token punctuation">)</span>    <span class="token keyword">for</span> xml_file <span class="token keyword">in</span> xml_files<span class="token punctuation">:</span>        subtree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>        subroot <span class="token operator">=</span> subtree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>        attrib <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"[@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>v<span class="token punctuation">&#125;</span></span><span class="token string">']"</span></span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> attribs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> elem <span class="token keyword">in</span> subroot<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>attrib<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            root<span class="token punctuation">.</span>append<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>    tree <span class="token operator">=</span> ET<span class="token punctuation">.</span>ElementTree<span class="token punctuation">(</span>root<span class="token punctuation">)</span>    tree<span class="token punctuation">.</span>write<span class="token punctuation">(</span>output_file<span class="token punctuation">)</span>    tree<span class="token punctuation">.</span>write<span class="token punctuation">(</span>output_file<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    xml_files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'file1.xml'</span><span class="token punctuation">,</span><span class="token string">'file2.xml'</span><span class="token punctuation">,</span><span class="token string">'file3.xml'</span><span class="token punctuation">]</span>    attribs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">:</span><span class="token string">'a'</span><span class="token punctuation">&#125;</span>    output_file <span class="token operator">=</span> <span class="token string">'output.xml'</span>    item <span class="token operator">=</span> <span class="token string">'item'</span>    root_data <span class="token operator">=</span> <span class="token string">'data'</span>    merge_xml_files_root<span class="token punctuation">(</span>xml_files<span class="token punctuation">,</span>root_data<span class="token punctuation">,</span>item<span class="token punctuation">,</span>attribs<span class="token punctuation">,</span>output_file<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-åˆå¹¶æ–¹å¼äºŒï¼ˆæ ¹èŠ‚ç‚¹æœªçŸ¥ï¼‰">4. åˆå¹¶æ–¹å¼äºŒï¼ˆæ ¹èŠ‚ç‚¹æœªçŸ¥ï¼‰</h2><ul><li>åˆå¹¶çš„æ–¹æ³•å¦‚<code>merge_xml_files</code>æ‰€ç¤º</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">merge_xml_files</span><span class="token punctuation">(</span>xml_files<span class="token punctuation">,</span>item<span class="token punctuation">,</span>attribs<span class="token punctuation">,</span> output_file<span class="token punctuation">)</span><span class="token punctuation">:</span>    tree <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">for</span> xml_file <span class="token keyword">in</span> xml_files<span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> tree<span class="token punctuation">:</span>            <span class="token comment"># ä½¿ç”¨ç¬¬ä¸€ä¸ªæ–‡ä»¶åˆå§‹åŒ–tree</span>            tree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>            root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">for</span> elem <span class="token keyword">in</span> root<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span>attrib<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!=</span>value <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> attribs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                     <span class="token comment"># è¯·é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­ä¸ç¬¦åˆçš„ç»“ç‚¹</span>                    root<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>            <span class="token keyword">continue</span>        root <span class="token operator">=</span> tree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>        subtree <span class="token operator">=</span> ET<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>xml_file<span class="token punctuation">)</span>        subroot <span class="token operator">=</span> subtree<span class="token punctuation">.</span>getroot<span class="token punctuation">(</span><span class="token punctuation">)</span>        attrib <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"[@</span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>v<span class="token punctuation">&#125;</span></span><span class="token string">']"</span></span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> attribs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> elem <span class="token keyword">in</span> subroot<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"./</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">/</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>attrib<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            root<span class="token punctuation">.</span>append<span class="token punctuation">(</span>elem<span class="token punctuation">)</span>    tree<span class="token punctuation">.</span>write<span class="token punctuation">(</span>output_file<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è°ƒç”¨</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    xml_files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'file1.xml'</span><span class="token punctuation">,</span><span class="token string">'file2.xml'</span><span class="token punctuation">,</span><span class="token string">'file3.xml'</span><span class="token punctuation">]</span>    attribs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'value'</span><span class="token punctuation">:</span><span class="token string">'a'</span><span class="token punctuation">&#125;</span>    output_file <span class="token operator">=</span> <span class="token string">'output.xml'</span>    item <span class="token operator">=</span> <span class="token string">'item'</span>    merge_xml_files<span class="token punctuation">(</span>xml_files<span class="token punctuation">,</span>item<span class="token punctuation">,</span>attribs<span class="token punctuation">,</span>output_file<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-å…¶ä»–ä½¿ç”¨æ–¹å¼">5. å…¶ä»–ä½¿ç”¨æ–¹å¼</h2><ul><li>å¦‚æœä¼ å…¥çš„ <code>attribs = &#123;'id': '1'&#125;</code>ï¼Œå°†ä¼šå¾—åˆ°æ»¡è¶³è¯¥æ¡ä»¶çš„ç»“æœï¼Œå¦‚ä¸‹ï¼š</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!-- output.xml --></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>c<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item 4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Item D<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem X<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>subitem</span><span class="token punctuation">></span></span>Subitem Y<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>subitem</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æ‰©å……éƒ¨åˆ†">6. æ‰©å……éƒ¨åˆ†</h2><ul><li>åˆå¹¶æ–¹å¼äºŒä½¿ç”¨<code>any()</code>å‡½æ•°è¿›è¡Œç»“ç‚¹åˆ é™¤,æ­¤å¤–è¿˜æœ‰<code>all()</code>å‡½æ•°ã€‚<code>any()</code> å’Œ <code>all()</code> éƒ½æ˜¯ Python å†…ç½®å‡½æ•°ã€‚<code>any()</code> å‡½æ•°ç”¨äºåˆ¤æ–­ç»™å®šçš„å¯è¿­ä»£å‚æ•°<code>iterable</code> æ˜¯å¦å…¨éƒ¨ä¸º <code>False</code>ï¼Œåˆ™è¿”å› <code>False</code>ï¼Œå¦‚æœæœ‰ä¸€ä¸ªä¸º <code>True</code>ï¼Œåˆ™è¿”å› <code>True</code>ã€‚å…ƒç´ é™¤äº†æ˜¯ 0ã€ç©ºã€FALSE å¤–éƒ½ç®— TRUEã€‚</li></ul><h3 id="6-1-any-å‡½æ•°">6.1 <code>any()</code>å‡½æ•°</h3><ul><li><code>any()</code> å‡½æ•°æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¦‚æœå¯è¿­ä»£å¯¹è±¡ä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ ä¸ºçœŸå€¼ï¼Œåˆ™è¿”å› <code>True</code>ï¼Œå¦åˆ™è¿”å› <code>False</code>ã€‚ä¾‹å¦‚ï¼š</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å‡º True</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å‡º False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>æ–‡ä¸­ä½¿ç”¨çš„</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>elem<span class="token punctuation">.</span>attrib<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token operator">!=</span>value <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> attribs<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç­‰ä»·äº</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> elem<span class="token punctuation">.</span>attrib<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string">'1'</span> <span class="token keyword">or</span> elem<span class="token punctuation">.</span>attrib<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token string">'a'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="6-2-all-å‡½æ•°">6.2 <code>all()</code>å‡½æ•°</h3><ul><li><code>all()</code>å‡½æ•°ä¹Ÿæ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¦‚æœå¯è¿­ä»£å¯¹è±¡ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½ä¸ºçœŸå€¼ï¼Œåˆ™è¿”å› <code>True</code>ï¼Œå¦åˆ™è¿”å› <code>False</code>ã€‚ä¾‹å¦‚ï¼š</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å‡º True</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># è¾“å‡º False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> ç›˜è›‡æ•™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
            <tag> xml </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å¦‚ä½•ç™¾ç§‘ã€‘Ubuntuå®‰è£…æœ€æ–°docker</title>
      <link href="/news/1678175207403.html"/>
      <url>/news/1678175207403.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-åœ¨çº¿å®‰è£…">1. åœ¨çº¿å®‰è£…</h2><h3 id="ä½¿ç”¨å­˜å‚¨åº“å®‰è£…-å‰è¨€">ä½¿ç”¨å­˜å‚¨åº“å®‰è£…(å‰è¨€)</h3><p>â€ƒâ€ƒåœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£… Docker Engine ä¹‹å‰ï¼Œéœ€è¦è®¾ç½® Docker å­˜å‚¨åº“ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä»å­˜å‚¨åº“ä¸­å®‰è£…å’Œæ›´æ–° Dockerã€‚å¦‚æ— æ³•ä½¿ç”¨ <code>root</code> æƒé™å®‰è£…ï¼Œå¯ä½¿ç”¨ <code>sudo</code> æ¥å®‰è£… dockerã€‚</p><h3 id="1-1-è®¾ç½®å­˜å‚¨åº“">1.1 è®¾ç½®å­˜å‚¨åº“</h3><h4 id="1-1-1-æ›´æ–°-apt-åŒ…ç´¢å¼•å¹¶å®‰è£…åŒ…ä»¥å…è®¸-apt-é€šè¿‡-HTTPS-ä½¿ç”¨å­˜å‚¨åº“">1.1.1 æ›´æ–° <code>apt</code> åŒ…ç´¢å¼•å¹¶å®‰è£…åŒ…ä»¥å…è®¸ <code>apt</code> é€šè¿‡ HTTPS ä½¿ç”¨å­˜å‚¨åº“</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>    ca-certificates <span class="token punctuation">\</span>    <span class="token function">curl</span> <span class="token punctuation">\</span>    gnupg <span class="token punctuation">\</span>    lsb-release<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-1-2-æ·»åŠ -Docker-å®˜æ–¹GPGå¯†é’¥">1.1.2 æ·»åŠ  Docker å®˜æ–¹<code>GPG</code>å¯†é’¥</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-m</span> 0755 <span class="token parameter variable">-p</span> /etc/apt/keyrings<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> gpg <span class="token parameter variable">--dearmor</span> <span class="token parameter variable">-o</span> /etc/apt/keyrings/docker.gpg<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-1-3-ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®å­˜å‚¨åº“">1.1.3 ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®å­˜å‚¨åº“</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token punctuation">\</span>  <span class="token string">"deb [arch=<span class="token variable"><span class="token variable">$(</span>dpkg --print-architecture<span class="token variable">)</span></span> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span> <span class="token operator">|</span> <span class="token function">tee</span> /etc/apt/sources.list.d/docker.list <span class="token operator">></span> /dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-2-å®‰è£…-Docker-å¼•æ“">1.2 å®‰è£… Docker å¼•æ“</h3><h4 id="1-2-1-æ›´æ–°-apt-åŒ…ç´¢å¼•">1.2.1 æ›´æ–° <code>apt</code> åŒ…ç´¢å¼•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-2-å®‰è£…-Docker-å¼•æ“ã€å®¹å™¨å’Œ-Docker-Compose">1.2.2 å®‰è£… Docker å¼•æ“ã€å®¹å™¨å’Œ Docker Compose</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-3-é€šè¿‡è¿è¡Œ-hello-world-é•œåƒæ¥éªŒè¯-Docker-å¼•æ“å®‰è£…æ˜¯å¦æˆåŠŸ">1.2.3 é€šè¿‡è¿è¡Œ <code>hello-world</code> é•œåƒæ¥éªŒè¯ Docker å¼•æ“å®‰è£…æ˜¯å¦æˆåŠŸ</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run hello-world<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-2-4-æ³¨æ„äº‹é¡¹">1.2.4 æ³¨æ„äº‹é¡¹</h4><p>â€ƒâ€ƒ<strong>é€šè¿‡ä¸Šè¿°å®‰è£…çš„ <code>docker-compose</code> å¯åŠ¨æ—¶å‘½ä»¤æ˜¯ <code>docker compose</code>ï¼Œè€Œä¸æ˜¯ <code>docker-compose</code>ï¼Œå¦‚ä¸‹</strong>ï¼š</p><ul><li><strong>æˆåŠŸç¤ºä¾‹</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose up <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><strong>é”™è¯¯ç¤ºä¾‹</strong></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-ç¦»çº¿å®‰è£…">2. ç¦»çº¿å®‰è£…</h2><p>â€ƒâ€ƒDocker æ˜¯ä¸€ç§å¼€æºçš„å®¹å™¨æŠ€æœ¯ï¼Œå¯ä»¥è®©å¼€å‘è€…å’Œè¿ç»´äººå‘˜åœ¨ä¸åŒçš„å¹³å°ä¸Šå¿«é€Ÿéƒ¨ç½²å’Œè¿è¡Œåº”ç”¨ç¨‹åºã€‚<code>Docker </code>çš„ä¼˜ç‚¹æ˜¯è½»é‡ã€é«˜æ•ˆã€å¯ç§»æ¤å’Œå®‰å…¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„ç¯å¢ƒä¸­å®‰è£… Dockerï¼Œå°±éœ€è¦ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åœ¨ <code>Ubuntu 16.04 LTS</code> ä¸Šç¦»çº¿å®‰è£… Docker å’Œ <code>Docker-compose</code>ã€‚</p><h3 id="2-1-å‡†å¤‡å·¥ä½œ">2.1 å‡†å¤‡å·¥ä½œ</h3><p>â€ƒâ€ƒåœ¨å¼€å§‹ç¦»çº¿å®‰è£…ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p><ul><li><code>containerd.io</code> åŒ…ï¼šè¿™æ˜¯ Docker çš„ä¸€ä¸ªä¾èµ–åŒ…ï¼Œè´Ÿè´£ç®¡ç†å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸã€‚</li><li><code>docker-ce-cli</code> åŒ…ï¼šè¿™æ˜¯ Docker çš„å‘½ä»¤è¡Œæ¥å£ï¼Œæä¾›äº†å„ç§æ“ä½œå®¹å™¨çš„å‘½ä»¤ã€‚</li><li><code>docker-ce</code> åŒ…ï¼šè¿™æ˜¯ Docker çš„æ ¸å¿ƒç»„ä»¶ï¼ŒåŒ…å«äº† Docker å¼•æ“å’Œå…¶ä»–åŠŸèƒ½ã€‚</li><li><code>docker-compose</code> åŒ…ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚</li></ul><p>â€ƒâ€ƒå¯ä»¥ä»ä»¥ä¸‹åœ°å€ä¸‹è½½è¿™äº›åŒ…ï¼Œæ³¨æ„é€‰æ‹©ä¸ <code>Ubuntu</code> ç‰ˆæœ¬ç›¸åŒ¹é…çš„åŒ…ã€‚ä¾‹å¦‚ï¼Œå¦‚æœï¼Œå…¶ä»–ç‰ˆæœ¬ä»£å·å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç‰ˆæœ¬</th><th>ä»£å·</th><th>åœ°å€</th></tr></thead><tbody><tr><td>16.04 LTS</td><td>xenial</td><td><a href="https://download.docker.com/linux/ubuntu/dists/xenial/pool/stable/amd64/">å®˜æ–¹ä¸‹è½½åœ°å€</a></td></tr><tr><td>18.04 LTS</td><td>bionic</td><td><a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/">å®˜æ–¹ä¸‹è½½åœ°å€</a></td></tr><tr><td>20.04 LTS</td><td>focal</td><td><a href="https://download.docker.com/linux/ubuntu/dists/focal/pool/stable/amd64/">å®˜æ–¹ä¸‹è½½åœ°å€</a></td></tr><tr><td>22.04 LTS</td><td>jammy</td><td><a href="https://download.docker.com/linux/ubuntu/dists/jammy/pool/stable/amd64/">å®˜æ–¹ä¸‹è½½åœ°å€</a></td></tr></tbody></table><p>â€ƒâ€ƒæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ <code>Ubuntu 16.04 LTS</code>ï¼ˆä»£å·ä¸º <code>xenial</code>ï¼‰éœ€è¦ä¸‹è½½ä»¥ä¸‹ä¸‰ä¸ªåŒ…ï¼Œå…¶ä»–ç‰ˆæœ¬å¯ä¸‹è½½å¯¹åº”çš„å››ä¸ªæœ€æ–°åŒ…</p><ul><li>containerd.io_1.4.6-1_amd64.deb</li><li>docker-ce-cli_20.10.7_3-0_ubuntu-xenial_amd64.deb</li><li>docker-ce_20.10.7_3-0_ubuntu-xenial_amd64.deb</li><li>docker-compose-Linux-x86_64 (å®˜æ–¹ä¸‹è½½åœ°å€ä¸­ä»… Ubuntu 18 ç‰ˆæœ¬ä»¥ä¸Šå­˜åœ¨ docker-compose-plugin*.deb)</li></ul><p>â€ƒâ€ƒä¸‹è½½å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›æ–‡ä»¶æ‹·è´åˆ°ç›®æ ‡æœºå™¨ä¸Šï¼Œä¾‹å¦‚æ”¾åœ¨ <code>/home/ubuntu/docker</code> ç›®å½•ä¸‹ã€‚</p><h3 id="2-2-å¸è½½åŸæœ‰çš„-Docker">2.2. å¸è½½åŸæœ‰çš„ Docker</h3><p>â€ƒâ€ƒå¦‚æœç›®æ ‡æœºå™¨ä¸Šå·²ç»å®‰è£…äº†æ—§ç‰ˆæœ¬çš„ Dockerï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å…ˆå¸è½½å®ƒä»¬ï¼Œä»¥é¿å…å†²çªã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å¸è½½åŸæœ‰çš„ Dockerï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt-get</span> purge docker-ce<span class="token function">apt-get</span> autoremove <span class="token parameter variable">--purge</span> docker-ce<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="2-3-å®‰è£…æ–°ç‰ˆçš„-Docker">2.3 å®‰è£…æ–°ç‰ˆçš„ Docker</h3><p>â€ƒâ€ƒæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>dpkg</code> å‘½ä»¤æ¥å®‰è£…æ–°ç‰ˆçš„ Dockerã€‚æ³¨æ„è¦æŒ‰ç…§ä¾èµ–é¡ºåºæ¥å®‰è£…åŒ…ï¼Œå³å…ˆå®‰è£… <code>containerd.io</code> åŒ…ï¼Œå†å®‰è£… <code>docker-ce-cli</code> åŒ…ï¼Œæœ€åå®‰è£… <code>docker-ce</code> åŒ…ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥è¿›è¡Œå®‰è£…ï¼š</p><h4 id="2-3-1-å®‰è£…æ ¸å¿ƒåŒ…">2.3.1 å®‰è£…æ ¸å¿ƒåŒ…</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /home/ubuntu/docker <span class="token comment"># è¿›å…¥å­˜æ”¾æ–‡ä»¶çš„ç›®å½•</span>dpkg <span class="token parameter variable">-i</span> containerd.io_1.4.6-1_amd64.deb <span class="token comment"># å®‰è£… containerd.io åŒ…</span>dpkg <span class="token parameter variable">-i</span> docker-ce-cli_20.10.7_3-0_ubuntu-xenial_amd64.deb <span class="token comment"># å®‰è£… docker-ce-cli åŒ…</span>dpkg <span class="token parameter variable">-i</span> docker-ce_20.10.7_3-0_ubuntu-xenial_amd64.deb <span class="token comment"># å®‰è£… docker-ce åŒ…</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ³¨: å¦‚æœå®‰è£… <code>containerd.io</code>åŒ…æ—¶æç¤ºå¦‚ä¸‹ä¿¡æ¯</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">..</span>.containerd.io depends on libseccomp2<span class="token punctuation">(</span><span class="token operator">>=</span><span class="token number">2.4</span>.0<span class="token punctuation">)</span><span class="token punctuation">;</span>however: Version of libseccomp2:amd64 on system is <span class="token number">2.3</span>.1-2-ubuntu2~16.04.1.<span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆ™éœ€è¦åœ¨è¯¥åœ°å€ä¸‹è½½<code>libseccomp2(&gt;=2.4.0)</code>åŒ…ï¼Œå¦‚<code>libseccomp2_2.4.3-1ubuntu1_amd64.deb</code> <a href="http://archive.ubuntu.com/ubuntu/pool/main/libs/libseccomp/">å®˜æ–¹ä¸‹è½½åœ°å€</a>ã€‚ä¸‹è½½å®Œæˆåï¼Œä½¿ç”¨ <code>dpkg</code> å‘½ä»¤å®‰è£…</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dpkg <span class="token parameter variable">-i</span> libseccomp2_2.4.3-1ubuntu1_amd64.deb<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å®‰è£…å®ŒæˆåæŒ‰ç…§ä¸Šè¿°<code>docker</code>çš„å®‰è£…é¡ºåºé‡æ–°å®‰è£…å³å¯ã€‚</li></ul><h4 id="2-3-2-é€šè¿‡è¿è¡Œ-docker-version-é•œåƒæ¥éªŒè¯-Docker-å¼•æ“å®‰è£…æ˜¯å¦æˆåŠŸ">2.3.2 é€šè¿‡è¿è¡Œ <code>docker --version</code> é•œåƒæ¥éªŒè¯ Docker å¼•æ“å®‰è£…æ˜¯å¦æˆåŠŸ</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token parameter variable">--version</span> <span class="token comment"># æŸ¥çœ‹ Docker ç‰ˆæœ¬ä¿¡æ¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¦‚æœèƒ½å¤Ÿçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼Œåˆ™è¯´æ˜ Docker å·²ç»æ­£å¸¸å·¥ä½œï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Docker version <span class="token number">20.10</span>.7, build f0df350<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-3-3-å®‰è£…docker-compose-åŒ…ã€å¯é€‰ã€‘">2.3.3 å®‰è£…<code>docker-compose</code> åŒ…ã€å¯é€‰ã€‘</h4><p>â€ƒâ€ƒUbuntu 18 ç‰ˆæœ¬ä»¥ä¸Šå®‰è£…<code>docker-compose</code> åŒ…ï¼Œä¸‹é¢ä»¥<code>Ubuntu 22.04 LTS</code>ä¸ºä¾‹ã€‚Ubuntu 16 ç‰ˆæœ¬å®‰è£…<code>docker-compose</code> åœ¨åæ–‡è¿›è¡Œæè¿°ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dpkg <span class="token parameter variable">-i</span> docker-compose-plugin_2.6.0~ubuntu-jammy_amd64.deb   <span class="token comment"># å®‰è£… docker-compose åŒ…</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>éªŒè¯ <code>docker-compose</code> æ˜¯å¦å®‰è£…æˆåŠŸ(æ³¨æ„å¦‚æœå®‰è£…çš„æ˜¯æœ€æ–°ç‰ˆï¼Œåˆ™å¯åŠ¨æ—¶å‘½ä»¤æ˜¯ <code>docker compose</code>ï¼Œè€Œä¸æ˜¯ <code>docker-compose</code>)ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> compose <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-4-docker-compose-ç¦»çº¿å®‰è£…">2.4 docker-compose ç¦»çº¿å®‰è£…</h3><p>â€ƒâ€ƒ<code>Docker-compose </code>æ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚å®ƒä½¿ç”¨ <code>YAML</code> æ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ã€ç½‘ç»œå’Œå·ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªå‘½ä»¤æ¥åˆ›å»ºå’Œå¯åŠ¨æ‰€æœ‰çš„æœåŠ¡ã€‚åœ¨æ²¡æœ‰äº’è”ç½‘è¿æ¥çš„ç¯å¢ƒä¸­ï¼Œéœ€è¦ç¦»çº¿å®‰è£… <code>docker-compose</code>ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•åœ¨ <code>Ubuntu 16.04 LTS</code> ä¸Šç¦»çº¿å®‰è£… <code>docker-compose</code> çš„æ­¥éª¤ã€‚</p><h4 id="2-4-1-ä¸‹è½½-docker-compose">2.4.1 ä¸‹è½½ <code>docker-compose</code></h4><p>â€ƒâ€ƒåœ¨å¯ä»¥è®¿é—®äº’è”ç½‘çš„ç”µè„‘ä¸Šï¼Œæ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® <a href="https://github.com/docker/compose/releases">https://github.com/docker/compose/releases</a> ï¼Œæ‰¾åˆ°æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼ˆæœ¬æ–‡ä»¥ 2.16.0ã€2023 å¹´ 3 æœˆæœ€æ–°ç‰ˆã€‘ä¸ºä¾‹ï¼‰ï¼Œç‚¹å‡» Assets ä¸‹çš„ <code>docker-compose-Linux-x86_64</code> é“¾æ¥ï¼Œä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å°†ä¸‹è½½å¥½çš„æ–‡ä»¶å¤åˆ¶åˆ° U ç›˜æˆ–å…¶ä»–å¯ç§»åŠ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œç„¶åæ’å…¥åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚</p><h4 id="2-4-2-å®‰è£…-docker-compose">2.4.2 å®‰è£… <code>docker-compose</code></h4><ul><li>åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œåˆ‡æ¢åˆ° <code>root</code> ç”¨æˆ·ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ›å»ºä¸€ä¸ª <code>/usr/local/bin</code> ç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /usr/local/bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å°† U ç›˜æˆ–å…¶ä»–å¯ç§»åŠ¨å­˜å‚¨è®¾å¤‡ä¸Šçš„ <code>docker-compose-Linux-x86_64</code> æ–‡ä»¶å¤åˆ¶åˆ° <code>/usr/local/bin</code> ç›®å½•ä¸‹ï¼Œå¹¶é‡å‘½åä¸º <code>docker-compose</code> ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> /media/usb/docker-compose-Linux-x86_64 /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç»™ <code>docker-compose</code> æ–‡ä»¶æ·»åŠ å¯æ‰§è¡Œæƒé™ï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>éªŒè¯ <code>docker-compose</code> æ˜¯å¦å®‰è£…æˆåŠŸï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>å¦‚æœè¾“å‡ºç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼Œåˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸï¼š</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker-compose</span> version <span class="token number">2.16</span>.0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ä¸‡æ³•å¤©ä¹¦ </category>
          
          <category> å¦‚ä½•ç™¾ç§‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€Pythonæ‚è®°ã€‘å¯ç”¨çš„ç¿»è¯‘APIåŠå…¶è°ƒç”¨æ–¹å¼</title>
      <link href="/news/1678175269378.html"/>
      <url>/news/1678175269378.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-è°·æ­Œç¿»è¯‘-APIï¼ˆéœ€è¦è®¾ç½®ä»£ç†ï¼‰">1. è°·æ­Œç¿»è¯‘ APIï¼ˆéœ€è¦è®¾ç½®ä»£ç†ï¼‰</h2><p>â€ƒâ€ƒä»¥ç¿»è¯‘ <strong>â€œAuthentication Architectureâ€</strong> ä¸ºä¾‹</p><h3 id="1-1-ç½‘é¡µè°ƒç”¨">1.1 ç½‘é¡µè°ƒç”¨</h3><h4 id="1-1-1-é€šè¿‡æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œè°ƒç”¨">1.1.1 é€šè¿‡æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œè°ƒç”¨</h4><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">curl &quot;https:&#x2F;&#x2F;translate.google.com&#x2F;translate_a&#x2F;single?client&#x3D;gtx&amp;dt&#x3D;t&amp;dj&#x3D;1&amp;ie&#x3D;UTF-8&amp;sl&#x3D;auto&amp;tl&#x3D;zh_CN&amp;q&#x3D;Authentication%20Architecture&quot; -H &quot;Accept: application&#x2F;json&quot; --proxy http:&#x2F;&#x2F;127.0.0.1:7890<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="1-1-2-è¿”å›ç»“æœ">1.1.2 è¿”å›ç»“æœ</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"sentences"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span>      <span class="token property">"trans"</span><span class="token operator">:</span> <span class="token string">"è®¤è¯æ¶æ„"</span><span class="token punctuation">,</span>      <span class="token property">"orig"</span><span class="token operator">:</span> <span class="token string">"Authentication Architecture"</span><span class="token punctuation">,</span>      <span class="token property">"backend"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      <span class="token property">"model_specification"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token property">"translation_engine_debug_info"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>          <span class="token property">"model_tracking"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"checkpoint_md5"</span><span class="token operator">:</span> <span class="token string">"95ad550c486923f3a292df3e4cffc30f"</span><span class="token punctuation">,</span>            <span class="token property">"launch_doc"</span><span class="token operator">:</span> <span class="token string">"en_zh_2022q2.md"</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"en"</span><span class="token punctuation">,</span>  <span class="token property">"confidence"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>  <span class="token property">"spell"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"ld_result"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"srclangs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"en"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"srclangs_confidences"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token property">"extended_srclangs"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"en"</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-é€šè¿‡-python-è°ƒç”¨">1.2 é€šè¿‡ python è°ƒç”¨</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">translate_from_google</span><span class="token punctuation">(</span>txt<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    proxies <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://127.0.0.1:7890"</span><span class="token punctuation">,</span>        <span class="token string">"https"</span><span class="token punctuation">:</span> <span class="token string">"http://127.0.0.1:7890"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    txt <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>txt<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token string">' ,=&amp;/+()'</span><span class="token punctuation">)</span>    url <span class="token operator">=</span> <span class="token string">'https://translate.google.com/translate_a/single?client=gtx&amp;dt=t&amp;dj=1&amp;ie=UTF-8&amp;sl=auto&amp;tl=zh_CN&amp;q='</span><span class="token operator">+</span>txt    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'sentences'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'trans'</span><span class="token punctuation">)</span>  <span class="token comment"># è°·æ­Œ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">translate_from_google<span class="token punctuation">(</span><span class="token string">'Authentication Architecture'</span><span class="token punctuation">)</span> <span class="token comment"># è°ƒç”¨</span><span class="token comment"># è¾“å‡º"è®¤è¯æ¶æ„"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="2-æœ‰é“ç¿»è¯‘-API">2. æœ‰é“ç¿»è¯‘ API</h2><h3 id="2-1-ç½‘é¡µè°ƒç”¨">2.1 ç½‘é¡µè°ƒç”¨</h3><h4 id="2-1-1-é€šè¿‡æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œè°ƒç”¨">2.1.1 é€šè¿‡æµè§ˆå™¨æˆ–å‘½ä»¤è¡Œè°ƒç”¨</h4><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">curl &quot;https:&#x2F;&#x2F;fanyi.youdao.com&#x2F;translate?doctype&#x3D;json&amp;type&#x3D;EN2ZH_CN&amp;i&#x3D;Authentication%20Architecture&quot; -H &quot;Accept: application&#x2F;json&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-1-2-è¿”å›çš„-json-ç»“æœ">2.1.2 è¿”å›çš„ json ç»“æœ</h4><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"EN2ZH_CN"</span><span class="token punctuation">,</span>  <span class="token property">"errorCode"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token property">"elapsedTime"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token property">"translateResult"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token property">"src"</span><span class="token operator">:</span> <span class="token string">"Authentication Architecture"</span><span class="token punctuation">,</span> <span class="token property">"tgt"</span><span class="token operator">:</span> <span class="token string">"è®¤è¯ä½“ç³»ç»“æ„"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-é€šè¿‡-python-è°ƒç”¨">2.2 é€šè¿‡ python è°ƒç”¨</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">translate_from_youdao</span><span class="token punctuation">(</span>txt<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token builtin">str</span><span class="token punctuation">:</span>    txt <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>txt<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token string">' ,=&amp;/+()'</span><span class="token punctuation">)</span>    url <span class="token operator">=</span> <span class="token string">'https://fanyi.youdao.com/translate?&amp;doctype=json&amp;type=EN2ZH_CN&amp;i='</span><span class="token operator">+</span>txt    res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'translateResult'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'tgt'</span><span class="token punctuation">)</span> <span class="token comment"># æœ‰é“</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">translate_from_youdao<span class="token punctuation">(</span><span class="token string">'Authentication Architecture'</span><span class="token punctuation">)</span> <span class="token comment"># è°ƒç”¨</span><span class="token comment"># è¾“å‡º"è®¤è¯ä½“ç³»ç»“æ„"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç¼–ç¨‹å¤§é™† </category>
          
          <category> ç›˜è›‡æ•™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å¦‚ä½•ç™¾ç§‘ã€‘Linux (WSL) å­ç³»ç»Ÿå¦‚ä½•ä¸Windowsé€šä¿¡</title>
      <link href="/news/1677410190368.html"/>
      <url>/news/1677410190368.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…">1. æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…</h2><h3 id="1-1-é€šè¿‡ipconfigè·å¾—WSLçš„ipåœ°å€ï¼Œå¦‚-172-28-30-1">1.1 é€šè¿‡<code>ipconfig</code>è·å¾—WSLçš„ipåœ°å€ï¼Œå¦‚ <code>172.28.30.1</code></h3><h3 id="1-2-è¿›å…¥Linuxå­ç³»ç»Ÿï¼Œpingä¸Šé¢è¿™ä¸ªåœ°å€">1.2 è¿›å…¥Linuxå­ç³»ç»Ÿï¼Œ<code>ping</code>ä¸Šé¢è¿™ä¸ªåœ°å€</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ping</span> <span class="token number">172.28</span>.30.1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-3-å¦‚æœæ— æ³•pingé€š-æˆ–ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ç½‘ç»œä¸é€š-ï¼Œåˆ™å¯åœ¨Windowsç³»ç»Ÿä¸Šé€šè¿‡powershellï¼ˆç®¡ç†å‘˜å¯åŠ¨ï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å¯Linux-WSL-å­ç³»ç»Ÿè®¿é—®Windowsçš„é˜²ç«å¢™">1.3 å¦‚æœæ— æ³•<code>ping</code>é€š(æˆ–ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°ç½‘ç»œä¸é€š)ï¼Œåˆ™å¯åœ¨Windowsç³»ç»Ÿä¸Šé€šè¿‡<code>powershell</code>ï¼ˆç®¡ç†å‘˜å¯åŠ¨ï¼‰è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå¼€å¯Linux (WSL) å­ç³»ç»Ÿè®¿é—®Windowsçš„é˜²ç«å¢™</h3><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">New-NetFirewallRule</span> <span class="token operator">-</span>DisplayName <span class="token string">"WSL"</span> <span class="token operator">-</span>Direction Inbound  <span class="token operator">-</span>InterfaceAlias <span class="token string">"vEthernet (WSL)"</span>  <span class="token operator">-</span>Action Allow<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-è·å–WSLè‡ªåŠ¨é…ç½®çš„åŸŸå">2. è·å–WSLè‡ªåŠ¨é…ç½®çš„åŸŸå</h2><h3 id="æ–¹æ³•1">æ–¹æ³•1</h3><ul><li>ç›´æ¥æ‰“å¼€ä»¥ä¸‹æ–‡ä»¶(å¯è®°äº‹æœ¬æ‰“å¼€æˆ–å‘½ä»¤è¡ŒæŸ¥çœ‹)ï¼Œå¯»æ‰¾172.28.30.1å¯¹åº”çš„åŸŸå</li></ul><pre class="line-numbers language-cmd" data-language="cmd"><code class="language-cmd">type C:\Windows\System32\drivers\etc\hosts.ics<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ–¹æ³•2">æ–¹æ³•2</h3><ul><li>é€šè¿‡Linuxå­ç³»ç»Ÿtracepathä»»æ„åœ°å€ï¼Œå¦‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tracepath baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>åˆ™æ­¤æ—¶åŸŸåä¸ºå‘½ä»¤æ‰§è¡Œç»“æœä¸­å‰ä¸¤è¡Œå‡ºç°çš„åŸŸå</li></ul><h3 id="ç»“æœ">ç»“æœ</h3><ul><li>å¯ä»¥å‘ç°åŸŸåæ˜¯ <code>example.mshome.net</code> çš„å½¢å¼ï¼Œ<code>example</code>ä¸€èˆ¬ä¸ºWindowsåŠLinuxå­ç³»ç»Ÿçš„ä¸»æœºåã€‚æ¯”å¦‚ï¼Œä¸»æœºåä¸º<code>taissan</code>ï¼Œé‚£ä¹ˆåŸŸååˆ™æ˜¯ <code>taissan.mshome.net</code>ã€‚</li></ul><h2 id="3-Linuxå­ç³»ç»Ÿè®¿é—®Windowsä¸Šçš„æœåŠ¡">3. Linuxå­ç³»ç»Ÿè®¿é—®Windowsä¸Šçš„æœåŠ¡</h2><ul><li>Linuxå­ç³»ç»Ÿè®¿é—®Windowsä¸Šçš„ä»£ç†</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span>http://taissan.mshome.net:7890<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="4-Windowsè®¿é—®Linuxå­ç³»ç»Ÿä¸Šçš„æœåŠ¡">4. Windowsè®¿é—®Linuxå­ç³»ç»Ÿä¸Šçš„æœåŠ¡</h2><ul><li>ç›´æ¥è®¿é—®<code>localhost</code>+ç«¯å£å³å¯ï¼Œå¦‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://127.0.0.1:8080<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="5-ä½¿ç”¨åŸŸåè®¿é—®è§£å†³çš„é—®é¢˜">5. ä½¿ç”¨åŸŸåè®¿é—®è§£å†³çš„é—®é¢˜</h2><ul><li>é…ç½®åŸŸåè®¿é—®åï¼Œåç»­æ— éœ€å†åšé…ç½®ã€‚é˜²æ­¢å› ç”µè„‘é‡å¯åwslçš„IPå˜åŒ–ï¼Œä½¿å¾—éœ€è¦æ¯æ¬¡é‡æ–°åœ¨Linuxå­ç³»ç»Ÿä¸­é…ç½®IP.</li></ul>]]></content>
      
      
      <categories>
          
          <category> ä¸‡æ³•å¤©ä¹¦ </category>
          
          <category> å¦‚ä½•ç™¾ç§‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> wsl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€æ‚è®°ã€‘æµ‹è¯•Katexçš„å…¬å¼æ”¯æŒç¨‹åº¦</title>
      <link href="/news/1678109183215.html"/>
      <url>/news/1678109183215.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-æµ‹è¯•ä»£æ•°ï¼ˆä¸æ”¯æŒåŒå±‚å¤§æ‹¬å·ï¼‰">1. æµ‹è¯•ä»£æ•°ï¼ˆä¸æ”¯æŒåŒå±‚å¤§æ‹¬å·ï¼‰</h2><ul><li>å¼å­ä¸€</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>å¯¹äºæ–¹ç¨‹å½¢å¦‚ï¼š</mtext><msup><mi>x</mi><mn>3</mn></msup><mo>âˆ’</mo><mn>1</mn><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>è®¾:</mtext><mi>Ï‰</mi><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><mn>1</mn><mo>+</mo><msqrt><mn>3</mn></msqrt><mi>i</mi></mrow><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mn>1</mn></msub><mo>=</mo><mn>1</mn><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>=</mo><mi>Ï‰</mi><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><mn>1</mn><mo>+</mo><msqrt><mn>3</mn></msqrt><mi>i</mi></mrow><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mn>3</mn></msub><mo>=</mo><msup><mi>Ï‰</mi><mn>2</mn></msup><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><mn>1</mn><mo>âˆ’</mo><msqrt><mn>3</mn></msqrt><mi>i</mi></mrow><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}  \text{å¯¹äºæ–¹ç¨‹å½¢å¦‚ï¼š}x^{3}-1=0 \\  \text{è®¾}\text{:}\omega =\frac{-1+\sqrt{3}i}{2} \\  x_{1}=1,x_{2}= \omega =\frac{-1+\sqrt{3}i}{2} \\  x_{3}= \omega ^{2}=\frac{-1-\sqrt{3}i}{2}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.394em;vertical-align:-2.447em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.947em;"><span style="top:-5.145em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">å¯¹äºæ–¹ç¨‹å½¢å¦‚ï¼š</span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-3.747em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord text"><span class="mord cjk_fallback">è®¾</span></span><span class="mord text"><span class="mord">:</span></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï‰</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-2.349em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">Ï‰</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-0.951em;"><span class="pstrut" style="height:3.038em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">Ï‰</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.038em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.399em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">1</span><span class="mbin mtight">âˆ’</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9128em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">3</span></span></span><span style="top:-2.8728em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1272em;"><span></span></span></span></span></span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.447em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><ul><li>å¼å­äºŒ</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><msup><mo><mi>x</mi></mo><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>=</mo><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Î”</mi><mo>=</mo><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mo><mi>x</mi></mo><mrow><mn>1</mn><mo separator="true">,</mo><mn>2</mn></mrow></msub><mo>=</mo><mfrac><mrow><mo>âˆ’</mo><mi>b</mi><mo>Â±</mo><msqrt><mrow><msup><mo><mi>b</mi></mo><mn>2</mn></msup><mo>âˆ’</mo><mn>4</mn><mi>a</mi><mi>c</mi></mrow></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mo><mi>x</mi></mo><mn>1</mn></msub><mo>+</mo><msub><mo><mi>x</mi></mo><mn>2</mn></msub><mo>=</mo><mo>âˆ’</mo><mfrac><mi>b</mi><mi>a</mi></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mo><mi>x</mi></mo><mn>1</mn></msub><msub><mo><mi>x</mi></mo><mn>2</mn></msub><mo>=</mo><mfrac><mi>c</mi><mi>a</mi></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}  a\mathop{x}\nolimits^{2}+bx+c=0 \\  \Delta =\mathop{b}\nolimits^{2}-4ac \\  \Delta =\mathop{b}\nolimits^{2}-4ac \\  \mathop{x}\nolimits_{1,2}=\frac{-b\pm \sqrt{\mathop{b}\nolimits^{2}-4ac}}{2a} \\  \mathop{x}\nolimits_{1}+\mathop{x}\nolimits_{2}=-\frac{b}{a} \\  \mathop{x}\nolimits_{1}\mathop{x}\nolimits_{2}=\frac{c}{a}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:7.5759em;vertical-align:-3.538em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.038em;"><span style="top:-6.2569em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">+</span><span class="mord mathnormal">b</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">c</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-4.9985em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:0.0972em;">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span style="top:-3.1473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">âˆ’</span><span class="mord">4</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mord">Î”</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:0.0972em;">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8984em;"><span style="top:-3.1473em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">âˆ’</span><span class="mord">4</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span></span></span><span style="top:-2.3211em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mpunct mtight">,</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0589em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mathnormal mtight">b</span><span class="mbin mtight">Â±</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9499em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mop mtight"><span class="mop mathnormal mtight" style="position:relative;top:0.0972em;">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8019em;"><span style="top:-2.8416em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mtight">âˆ’</span><span class="mord mtight">4</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">c</span></span></span><span style="top:-2.9099em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.0901em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.081em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">+</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8801em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:0.119em;"><span class="pstrut" style="height:3.0589em;"></span><span class="mord"><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop"><span class="mop mathnormal" style="position:relative;top:-0.0347em;">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">c</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:3.538em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><ul><li>æ³¨ï¼šä½¿ç”¨<mark class="hl-label blue">latex(katex)</mark> æ—¶åº”ä½¿ç”¨<code>a\mathop&#123;x&#125;\nolimits^&#123;2&#125;+bx+c=0</code>ï¼Œè€Œä¸æ˜¯<code>a\mathop&#123;&#123;x&#125;&#125;\nolimits^&#123;&#123;2&#125;&#125;+bx+c=0</code></li><li>å³ä½¿ç”¨<mark class="hl-label green">å•å±‚</mark> å¤§æ‹¬å·<code>&#123;x&#125;</code>åŒ…è£¹å‚æ•°ï¼Œè€Œä¸æ˜¯<mark class="hl-label red">åŒå±‚</mark> å¤§æ‹¬å·<code>&#123;&#123;x&#125;&#125;</code>åŒ…è£¹å‚æ•°ã€‚</li></ul><h2 id="2-æµ‹è¯•å‡ ä½•">2. æµ‹è¯•å‡ ä½•</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mrow><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>m</mi><mo>âŠ‚</mo><mi>Î±</mi><mo separator="true">,</mo><mi>n</mi><mo>âŠ‚</mo><mi>Î±</mi><mo separator="true">,</mo><mi>m</mi><mo>âˆ©</mo><mi>n</mi><mo>=</mo><mi>P</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>a</mi><mo>âŠ¥</mo><mi>m</mi><mo separator="true">,</mo><mi>a</mi><mo>âŠ¥</mo><mi>n</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">}</mo></mrow><mo>â‡’</mo><mi>a</mi><mo>âŠ¥</mo><mi>Î±</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}\left.\begin{matrix}  m \subset \alpha ,n \subset \alpha ,m \cap n=P \\    a \perp m,a \perp n\end{matrix}\right\}\Rightarrow a \perp \alpha\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4em;vertical-align:-0.95em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.45em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="minner"><span class="mopen nulldelimiter"></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em;"><span style="top:-3.61em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ‚</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ‚</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ©</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span><span style="top:-2.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ¥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">m</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ¥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">}</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‡’</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">âŠ¥</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.95em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="3-æµ‹è¯•ä¸ç­‰å¼">3. æµ‹è¯•ä¸ç­‰å¼</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msup><mrow><mo fence="true">(</mo><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>k</mi></msub><msub><mi>b</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mrow><mtext>â€‰â£</mtext><mtext>â€‰â£</mtext><mn>2</mn></mrow></msup><mo>â‰¤</mo><mrow><mo fence="true">(</mo><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>a</mi><mi>k</mi><mn>2</mn></msubsup><mo fence="true">)</mo></mrow><mrow><mo fence="true">(</mo><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msubsup><mi>b</mi><mi>k</mi><mn>2</mn></msubsup><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}\left( \sum_{k=1}^n a_k b_k \right)^{\!\!2}\leq\left( \sum_{k=1}^n a_k^2 \right) \left( \sum_{k=1}^n b_k^2 \right)\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3683em;vertical-align:-0.4341em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9342em;"><span style="top:-2.9342em;"><span class="pstrut" style="height:3.0083em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0083em;"><span style="top:-3.2572em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mspace mtight" style="margin-right:-0.1952em;"></span><span class="mspace mtight" style="margin-right:-0.1952em;"></span><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">â‰¤</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4169em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">âˆ‘</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8043em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-2.4169em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2831em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4341em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="4-æµ‹è¯•ç§¯åˆ†">4. æµ‹è¯•ç§¯åˆ†</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msubsup><mo>âˆ«</mo><mrow><mo>âˆ’</mo><mi mathvariant="normal">âˆ</mi></mrow><mi mathvariant="normal">âˆ</mi></msubsup><mover accent="true"><mi>f</mi><mo>^</mo></mover><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>Î¾</mi><mtext>â€‰</mtext><msup><mi>e</mi><mrow><mn>2</mn><mi>Ï€</mi><mi>i</mi><mi>Î¾</mi><mi>x</mi></mrow></msup><mtext>â€‰</mtext><mi mathvariant="normal">d</mi><mi>Î¾</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}f(x) = \int_{-\infty}^\infty  \hat f(x)\xi\,e^{2 \pi i \xi x}  \,\mathrm{d}\xi\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.372em;vertical-align:-0.436em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span style="top:-2.9781em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop"><span class="mop op-symbol small-op" style="margin-right:0.19445em;position:relative;top:-0.0006em;">âˆ«</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8593em;"><span style="top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">âˆ’</span><span class="mord mtight">âˆ</span></span></span></span><span style="top:-3.2579em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">âˆ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4142em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9579em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span><span style="top:-3.2634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.0833em;"><span class="mord">^</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.04601em;">Î¾</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">Ï€i</span><span class="mord mathnormal mtight" style="margin-right:0.04601em;">Î¾</span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal" style="margin-right:0.04601em;">Î¾</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.436em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="5-æµ‹è¯•çŸ©é˜µ">5. æµ‹è¯•çŸ©é˜µ</h2><ul><li>çŸ©é˜µä¸€</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>A</mi><mrow><mi>m</mi><mo>Ã—</mo><mi>n</mi></mrow></msub><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>12</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">â‹¯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mn>1</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>21</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mn>22</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">â‹¯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mn>2</mn><mi>n</mi></mrow></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">â‹®</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">â‹®</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">â‹±</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi><mi mathvariant="normal">â‹®</mi><mpadded height="0em" voffset="0em"><mspace mathbackground="black" width="0em" height="1.5em"></mspace></mpadded></mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mi>m</mi><mn>1</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mi>m</mi><mn>2</mn></mrow></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mo lspace="0em" rspace="0em">â‹¯</mo></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>a</mi><mrow><mi>m</mi><mi>n</mi></mrow></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo>=</mo><mrow><mo fence="true">[</mo><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}A_{m\times n}=  \begin{bmatrix}    a_{11}&amp; a_{12}&amp; \cdots  &amp; a_{1n} \\    a_{21}&amp; a_{22}&amp; \cdots  &amp; a_{2n} \\    \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\    a_{m1}&amp; a_{m2}&amp; \cdots  &amp; a_{mn}  \end{bmatrix}  =\left [ a_{ij}\right ]\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.46em;vertical-align:-2.48em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-4.98em;"><span class="pstrut" style="height:4.98em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2583em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"></span><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='5.400em' viewBox='0 0 667 5400'><path d='M403 1759 V84 H666 V0 H319 V1759 v1800 v1759 h347 v-84H403z M403 1759 V0 H319 V1759 v1800 v1759 h84z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">â‹®</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">â‹®</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.64em;"><span class="pstrut" style="height:3.5em;"></span><span class="mord"><span class="minner">â‹¯</span></span></span><span style="top:-4.44em;"><span class="pstrut" style="height:3.5em;"></span><span class="mord"><span class="minner">â‹¯</span></span></span><span style="top:-2.58em;"><span class="pstrut" style="height:3.5em;"></span><span class="mord"><span class="minner">â‹±</span></span></span><span style="top:-1.38em;"><span class="pstrut" style="height:3.5em;"></span><span class="mord"><span class="minner">â‹¯</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.98em;"><span style="top:-5.8275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-4.6275em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord">â‹®</span><span class="mord rule" style="border-right-width:0em;border-top-width:1.5em;bottom:0em;"></span></span></span></span><span style="top:-1.5675em;"><span class="pstrut" style="height:3.6875em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">mn</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.95em;"><span style="top:-4.95em;"><span class="pstrut" style="height:7.4em;"></span><span style="width:0.667em;height:5.400em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.667em' height='5.400em' viewBox='0 0 667 5400'><path d='M347 1759 V0 H0 V84 H263 V1759 v1800 v1759 H0 v84 H347zM347 1759 V0 H263 V1759 v1800 v1759 h84z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.45em;"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.48em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><ul><li>çŸ©é˜µäºŒ</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>A</mi><mo>=</mo><msub><mrow><mo fence="true">[</mo><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow><mrow><mi>m</mi><mo>Ã—</mo><mi>n</mi></mrow></msub><mo separator="true">,</mo><mi>B</mi><mo>=</mo><msub><mrow><mo fence="true">[</mo><msub><mi>b</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow><mrow><mi>n</mi><mo>Ã—</mo><mi>s</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>b</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>C</mi><mo>=</mo><mi>A</mi><mi>B</mi><mo>=</mo><msub><mrow><mo fence="true">[</mo><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow><mrow><mi>m</mi><mo>Ã—</mo><mi>s</mi></mrow></msub><mo>=</mo><msub><mrow><mo fence="true">[</mo><msubsup><mo>âˆ‘</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mrow><mi>i</mi><mi>k</mi></mrow></msub><msub><mi>b</mi><mrow><mi>k</mi><mi>j</mi></mrow></msub><mo fence="true">]</mo></mrow><mrow><mi>m</mi><mo>Ã—</mo><mi>s</mi></mrow></msub></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{c}  A={\left[ a_{ij}\right]_{m \times n}},B={\left[ b_{ij}\right]_{n \times s}} \\    c_{ij}= \sum \limits_{k=1}^{n}a_{ik}b_{kj} \\    C=AB=\left[ c_{ij}\right]_{m \times s}    = \left[ \sum \limits_{k=1}^{n}a_{ik}b_{kj}\right]_{m \times s}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6.1478em;vertical-align:-2.8239em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.3239em;"><span style="top:-5.9339em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0725em;"><span style="top:-2.3642em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3941em;"><span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0725em;"><span style="top:-2.3642em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3941em;"><span></span></span></span></span></span></span></span></span></span><span style="top:-4.1884em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3514em;"><span style="top:-2.0979em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span><span style="top:-3.95em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">kj</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-1.7362em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;">[</span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">]</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.0725em;"><span style="top:-2.3642em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3941em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">[</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3514em;"><span style="top:-2.0979em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ‘</span></span></span><span style="top:-3.95em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.0021em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ik</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">kj</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">]</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.6435em;"><span style="top:-1.6482em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span><span class="mbin mtight">Ã—</span><span class="mord mathnormal mtight">s</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.1101em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:2.8239em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="6-æµ‹è¯•ä¸‰è§’">6. æµ‹è¯•ä¸‰è§’</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>sin</mi><mo>â¡</mo><mi>Î±</mi><mo>+</mo><mi>sin</mi><mo>â¡</mo><mi>Î²</mi><mo>=</mo><mn>2</mn><mi>sin</mi><mo>â¡</mo><mfrac><mrow><mi>Î±</mi><mo>+</mo><mi>Î²</mi></mrow><mn>2</mn></mfrac><mi>cos</mi><mo>â¡</mo><mfrac><mrow><mi>Î±</mi><mo>âˆ’</mo><mi>Î²</mi></mrow><mn>2</mn></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}\sin \alpha + \sin \beta =2 \sin \frac{\alpha + \beta}{2}\cos \frac{\alpha - \beta}{2}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.2922em;vertical-align:-0.3961em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8961em;"><span style="top:-2.9639em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">Î±</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">Î²</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">sin</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">Î±</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">Î²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">cos</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.4461em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.0037em;">Î±</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.05278em;">Î²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.3961em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="7-æµ‹è¯•ç»Ÿè®¡">7. æµ‹è¯•ç»Ÿè®¡</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>S</mi><mo>=</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>N</mi><mi>n</mi></mfrac><mo fence="true">)</mo></mrow><mo separator="true">,</mo><msub><mi>A</mi><mi>k</mi></msub><mo>=</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>M</mi><mi>k</mi></mfrac><mo fence="true">)</mo></mrow><mo>â‹…</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>N</mi><mo>âˆ’</mo><mi>M</mi></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mi>k</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>A</mi><mi>k</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><mfrac><mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>M</mi><mi>k</mi></mfrac><mo fence="true">)</mo></mrow><mo>â‹…</mo><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mrow><mi>N</mi><mo>âˆ’</mo><mi>M</mi></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mi>k</mi></mrow></mfrac><mo fence="true">)</mo></mrow></mrow><mrow><mo fence="true">(</mo><mfrac linethickness="0px"><mi>N</mi><mi>n</mi></mfrac><mo fence="true">)</mo></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{c}  S= \binom{N}{n},A_{k}=\binom{M}{k}\cdot \binom{N-M}{n-k} \\  P\left ( A_{k}\right ) = \frac{\binom{M}{k}\cdot \binom{N-M}{n-k}}{\binom{N}{n}}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.8457em;vertical-align:-1.6728em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.1728em;"><span style="top:-4.7605em;"><span class="pstrut" style="height:3.51em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9223em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9223em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9223em;"><span style="top:-2.355em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-3.144em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4033em;"><span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span><span style="top:-2.8472em;"><span class="pstrut" style="height:3.51em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.51em;"><span style="top:-2.3925em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">(</span></span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9591em;"><span style="top:-2.156em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span style="top:-2.971em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">)</span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7125em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">(</span></span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9591em;"><span style="top:-2.156em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-2.971em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.344em;"><span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">)</span></span></span></span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mopen sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">(</span></span></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9591em;"><span style="top:-2.156em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span style="top:-2.971em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span><span class="mbin mtight">âˆ’</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4035em;"><span></span></span></span></span></span><span class="mclose sizing reset-size3 size6 mtight delimcenter" style="top:0.075em;"><span class="delimsizing size1 mtight"><span class="mtight">)</span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:1.6728em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>P</mi><mrow><mo fence="true">(</mo><msubsup><mo>â‹ƒ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>A</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow><mo>=</mo><msubsup><mo>âˆ</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mi>P</mi><mrow><mo fence="true">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}P \left( \bigcup \limits_{i=1}^{n}A_{i}\right) = \prod \limits_{i=1}^{n}P \left( A_{i}\right)\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4277em;vertical-align:-0.9638em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4638em;"><span style="top:-3.4638em;"><span class="pstrut" style="height:3.45em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3514em;"><span style="top:-2.1223em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">â‹ƒ</span></span></span><span style="top:-3.95em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3514em;"><span style="top:-2.1223em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop op-symbol small-op">âˆ</span></span></span><span style="top:-3.95em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.9638em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="8-æµ‹è¯•æ•°åˆ—">8. æµ‹è¯•æ•°åˆ—</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mfrac><mrow><mi>n</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>n</mi><mrow><mo fence="true">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mrow><mo fence="true">)</mo><mo>â‹…</mo><msup><mn>2</mn><mi>n</mi></msup></mrow></mrow></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mrow><mo fence="true">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mrow><mo fence="true">)</mo><mo>â‹…</mo><msup><mn>2</mn><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msup></mrow></mrow></mfrac><mo>âˆ’</mo><mfrac><mn>1</mn><mrow><mi>n</mi><mo>â‹…</mo><msup><mn>2</mn><mi>n</mi></msup></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}\frac{n+1}{n \left( n-1 \left) \cdot 2^{n}\right. \right.}= \frac{1}{\left( n-1 \left) \cdot 2^{n-1}\right. \right.}-\frac{1}{n \cdot 2^{n}}\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3651em;vertical-align:-0.4326em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9326em;"><span style="top:-3.0874em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span><span class="mord mtight">â‹…</span><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">(</span></span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="minner mtight"><span class="mopen mtight delimcenter" style="top:0em;"><span class="mtight">)</span></span><span class="mord mtight">â‹…</span><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7463em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mbin mtight">â‹…</span><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5935em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4326em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>+</mo><mi>x</mi><msup><mo stretchy="false">)</mo><mi>n</mi></msup><mo>=</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mi>n</mi><mi>x</mi></mrow><mrow><mn>1</mn><mo stretchy="false">!</mo></mrow></mfrac><mo>+</mo><mfrac><mrow><mi>n</mi><mo stretchy="false">(</mo><mi>n</mi><mo>âˆ’</mo><mn>1</mn><mo stretchy="false">)</mo><msup><mi>x</mi><mn>2</mn></msup></mrow><mrow><mn>2</mn><mo stretchy="false">!</mo></mrow></mfrac><mo>+</mo><mo>â‹¯</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l}(1+x)^{n} =1 + \frac{nx}{1!} + \frac{n(n-1)x^{2}}{2!} + \cdots\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4689em;vertical-align:-0.4845em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9845em;"><span style="top:-2.9845em;"><span class="pstrut" style="height:3.1089em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal">x</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6954em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mclose mtight">!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">x</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1089em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mclose mtight">!</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mbin mtight">âˆ’</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8913em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="minner">â‹¯</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.4845em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="9-æµ‹è¯•ç‰©ç†-ä¸æ”¯æŒunicodeæ‰©å±•">9. æµ‹è¯•ç‰©ç†(ä¸æ”¯æŒunicodeæ‰©å±•)</h2><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.16em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mstyle mathsize="2.074em"><mo>âˆ¯</mo></mstyle><mi mathvariant="double-struck">S</mi></msub><mi mathvariant="bold">D</mi><mo>â‹…</mo><mi mathvariant="normal">d</mi><mi>s</mi><mo>=</mo><msub><mi>Q</mi><mi>f</mi></msub></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mstyle mathsize="2.074em"><mo>âˆ¯</mo></mstyle><mi mathvariant="double-struck">S</mi></msub><mi mathvariant="bold">B</mi><mo>â‹…</mo><mi mathvariant="normal">d</mi><mi>s</mi><mo>=</mo><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mstyle mathsize="2.074em"><mo>âˆ®</mo></mstyle><mi mathvariant="double-struck">L</mi><mrow></mrow></msubsup><mi mathvariant="bold">E</mi><mo>â‹…</mo><mi mathvariant="normal">d</mi><mi>l</mi><mo>=</mo><mo>âˆ’</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">d</mi><msub><mi mathvariant="normal">Î¦</mi><mi mathvariant="bold">B</mi></msub></mrow><mrow><mi mathvariant="normal">d</mi><mi>t</mi></mrow></mfrac></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msubsup><mstyle mathsize="2.074em"><mo>âˆ®</mo></mstyle><mi mathvariant="double-struck">L</mi><mrow></mrow></msubsup><mi mathvariant="bold">H</mi><mo>â‹…</mo><mi mathvariant="normal">d</mi><mi>l</mi><mo>=</mo><msub><mi>I</mi><mi>f</mi></msub><mo>+</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mi mathvariant="normal">d</mi><msub><mi mathvariant="normal">Î¦</mi><mi mathvariant="bold">D</mi></msub></mrow><mrow><mi mathvariant="normal">d</mi><mi>t</mi></mrow></mfrac></mstyle></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">%æ­¤å…¬å¼éœ€è¦åœ¨è®¾ç½®ä¸­å¼€å¯unicodeæ‰©å±•æ”¯æŒ\begin{array}{l}    {\huge \oiint}_\mathbb{S}  \mathbf{D} \cdot\mathrm{d}s= Q_f \\    {\huge \oiint}_\mathbb{S}  \mathbf{B} \cdot\mathrm{d}s= 0 \\    {\huge \oint}_{\mathbb{L}}^{} \mathbf{E} \cdot \mathrm{d}l=-\cfrac{\mathrm{d}\Phi _{\mathbf{B}}}{\mathrm{d}t }  \\    {\huge \oint}_{\mathbb{L}}^{} \mathbf{H} \cdot \mathrm{d}l=I_f+\cfrac{\mathrm{d}\Phi _{\mathbf{D}}}{\mathrm{d}t }\end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:9.419em;vertical-align:-4.4595em;"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:4.9595em;"><span style="top:-7.3639em;"><span class="pstrut" style="height:4.074em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mop vlist-t vlist-t2 sizing reset-size6 size10" style="position:relative;top:-0.0005em;"><span class="vlist-r"><span class="vlist" style="height:0.805em;"><span style="top:-4.074em;"><span class="pstrut" style="height:4.074em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;">âˆ¬</span></span><span style="top:-4.074em;"><span class="pstrut" style="height:4.074em;"></span><span class="overlay" style="height:0.499em;width:0.957em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.957em' height='0.499em' style='width:0.957em' viewBox='0 0 957 499' preserveAspectRatio='xMinYMin'><path d='M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2zm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.860.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.306em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.2021em;"><span style="top:-2.0157em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6843em;"><span></span></span></span></span></span></span><span class="mord mathbf">D</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.01em;"><span class="pstrut" style="height:4.074em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mop vlist-t vlist-t2 sizing reset-size6 size10" style="position:relative;top:-0.0005em;"><span class="vlist-r"><span class="vlist" style="height:0.805em;"><span style="top:-4.074em;"><span class="pstrut" style="height:4.074em;"></span><span class="mop op-symbol small-op" style="margin-right:0.19445em;">âˆ¬</span></span><span style="top:-4.074em;"><span class="pstrut" style="height:4.074em;"></span><span class="overlay" style="height:0.499em;width:0.957em;"><svg xmlns="http://www.w3.org/2000/svg" width='0.957em' height='0.499em' style='width:0.957em' viewBox='0 0 957 499' preserveAspectRatio='xMinYMin'><path d='M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2zm368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.860.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z'/></svg></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.306em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:-0.2021em;"><span style="top:-2.0157em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathbb mtight">S</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6843em;"><span></span></span></span></span></span></span><span class="mord mathbf">B</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">0</span></span></span><span style="top:-2.6561em;"><span class="pstrut" style="height:4.074em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mop op-symbol small-op sizing reset-size6 size10" style="margin-right:0.19445em;position:relative;top:-0.0006em;">âˆ®</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4225em;"><span style="top:-2.0154em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">L</span></span></span></span><span style="top:-4.1225em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6846em;"><span></span></span></span></span></span></span><span class="mord mathbf">E</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord">âˆ’</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord"><span class="mord">Î¦</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3303em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">B</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span><span style="top:-0.3005em;"><span class="pstrut" style="height:4.074em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mop op-symbol small-op sizing reset-size6 size10" style="margin-right:0.19445em;position:relative;top:-0.0006em;">âˆ®</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4225em;"><span style="top:-2.0154em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbb mtight">L</span></span></span></span><span style="top:-4.1225em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.6846em;"><span></span></span></span></span></span></span><span class="mord mathbf">H</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">â‹…</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathrm">d</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.59em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord mathnormal">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.74em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">d</span><span class="mord"><span class="mord">Î¦</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3303em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathbf mtight">D</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span></span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:4.4595em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span></span></span></span></span></span></span></p><h2 id="10-æµ‹è¯•åŒ–å­¦-ä¸æ”¯æŒmhchemæ‰©å±•">10. æµ‹è¯•åŒ–å­¦(ä¸æ”¯æŒmhchemæ‰©å±•)</h2><ul><li>æºlatexä»£ç å¦‚ä¸‹:</li></ul><p>\begin{array}{l}\ce{Zn^2+  <=>[+ 2OH-][+ 2H+]  $\underset{\text{amphoteres Hydroxid}}{\ce{Zn(OH)2 v}}$  <=>[+ 2OH-][+ 2H+]  $\underset{\text{Hydroxozikat}}{\ce{[Zn(OH)4]^2-}}$}\end{array}</p><ul><li><a href="https://www.latexlive.com">å…¬å¼æ¨¡æ¿æ¥æº</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ··å…ƒåœ£è®° </category>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> katex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€æ‚è®°ã€‘ä½¿ç”¨Githubè®¿é—®Google</title>
      <link href="/news/1677410182753.html"/>
      <url>/news/1677410182753.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-ä»»æ„ä»“åº“æ‰“å¼€Codespaces">1. ä»»æ„ä»“åº“æ‰“å¼€<code>Codespaces</code></h2><h2 id="2-æ‰“å¼€Codespacesçš„ç»ˆç«¯ï¼ˆé¡µé¢ç±»ä¼¼äºvscodeï¼‰">2. æ‰“å¼€<code>Codespaces</code>çš„ç»ˆç«¯ï¼ˆé¡µé¢ç±»ä¼¼äº<code>vscode</code>ï¼‰</h2><h2 id="3-è¿è¡Œå¦‚ä¸‹å‘½ä»¤">3. è¿è¡Œå¦‚ä¸‹å‘½ä»¤</h2><h3 id="3-1-åˆ‡æ¢åˆ°rootæƒé™">3.1 åˆ‡æ¢åˆ°<code>root</code>æƒé™</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-s</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-2-è¿è¡Œdockeråº”ç”¨">3.2 è¿è¡Œ<code>docker</code>åº”ç”¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-p</span> <span class="token number">6080</span>:80 <span class="token parameter variable">-v</span> /dev/shm:/dev/shm dorowu/ubuntu-desktop-lxde-vnc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="4-æ–°çª—å£æ‰“å¼€å¼¹å‡ºçš„ç½‘é¡µ">4. æ–°çª—å£æ‰“å¼€å¼¹å‡ºçš„ç½‘é¡µ</h2><h2 id="5-åœ¨æ–°çš„é¡µé¢ä¸­æ‰“å¼€firefoxæµè§ˆå™¨ï¼ˆå…¶ä»–æµè§ˆå™¨è²Œä¼¼æ— æ³•ä½¿ç”¨ï¼‰ï¼Œå³å¯ä½¿ç”¨">5. åœ¨æ–°çš„é¡µé¢ä¸­æ‰“å¼€<code>firefox</code>æµè§ˆå™¨ï¼ˆå…¶ä»–æµè§ˆå™¨è²Œä¼¼æ— æ³•ä½¿ç”¨ï¼‰ï¼Œå³å¯ä½¿ç”¨</h2>]]></content>
      
      
      <categories>
          
          <category> æ··å…ƒåœ£è®° </category>
          
          <category> æ‚è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> google </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€CVE-2021-42694ã€‘Trojan Sourceæœ¨é©¬æºæ”»å‡»</title>
      <link href="/news/1677410067156.html"/>
      <url>/news/1677410067156.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-RLO-LRI-Î“CÂ«Î“uÂª-å’Œ-PDI-LRI-Î“uâŒÎ“uÂª-ä½¿ç”¨">1. <code>RLO LRI('Î“Ã‡Â«Î“Ã¼Âª')</code> å’Œ <code>PDI LRI('Î“Ã¼âŒÎ“Ã¼Âª')</code> ä½¿ç”¨</h2><h3 id="1-1-ä½¿ç”¨DOS-CP437-ç¼–ç ">1.1 ä½¿ç”¨<code>DOS(CP437)</code>ç¼–ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">access_level <span class="token operator">=</span> <span class="token string">"user"</span><span class="token keyword">if</span> access_level <span class="token operator">!=</span> <span class="token string">'noneÎ“Ã‡Â«Î“Ã¼Âª'</span><span class="token punctuation">:</span> <span class="token comment"># Check if admin Î“Ã¼âŒÎ“Ã¼Âª' and access_level != 'user</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"You are an admin."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-ä½¿ç”¨utf-8-ç¼–ç è½¬æ¢åï¼ˆvscodeï¼š-Reopen-with-Encodingï¼‰">1.2 ä½¿ç”¨<code>utf-8</code> ç¼–ç è½¬æ¢åï¼ˆvscodeï¼š Reopen with Encodingï¼‰</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">access_level <span class="token operator">=</span> <span class="token string">"user"</span><span class="token keyword">if</span> access_level <span class="token operator">!=</span> <span class="token string">'noneâ€®â¦'</span><span class="token punctuation">:</span> <span class="token comment"># Check if admin â©â¦' and access_level != 'user</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"You are an admin."</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-RLIä½¿ç”¨-Î“uÂº">2. RLIä½¿ç”¨<code>('Î“Ã¼Âº')</code></h2><h3 id="2-1-ä½¿ç”¨DOS-CP437-ç¼–ç ">2.1 ä½¿ç”¨<code>DOS(CP437)</code>ç¼–ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">bank <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">'alice'</span><span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">subtract_funds</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">''' Subtract funds from bank account then Î“Ã¼Âº'''</span> <span class="token punctuation">;</span><span class="token keyword">return</span>    bank<span class="token punctuation">[</span>account<span class="token punctuation">]</span> <span class="token operator">-=</span> amount    <span class="token keyword">return</span>subtract_funds<span class="token punctuation">(</span><span class="token string">'alice'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>bank<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-ä½¿ç”¨utf-8-ç¼–ç è½¬æ¢å">2.2 ä½¿ç”¨<code>utf-8</code> ç¼–ç è½¬æ¢å</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">bank <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token string">'alice'</span><span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">subtract_funds</span><span class="token punctuation">(</span>account<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> amount<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">''' Subtract funds from bank account then â§'''</span> <span class="token punctuation">;</span><span class="token keyword">return</span>    bank<span class="token punctuation">[</span>account<span class="token punctuation">]</span> <span class="token operator">-=</span> amount    <span class="token keyword">return</span>subtract_funds<span class="token punctuation">(</span><span class="token string">'alice'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>bank<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-â•¨Â¥-è¥¿é‡Œå°”å­—æ¯H-ä½¿ç”¨">3. <code>'â•¨Â¥'</code>(è¥¿é‡Œå°”å­—æ¯H)ä½¿ç”¨</h2><h3 id="3-1-ä½¿ç”¨DOS-CP437-ç¼–ç ">3.1 ä½¿ç”¨<code>DOS(CP437)</code>ç¼–ç </h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> sayâ•¨Â¥ello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Goodbye, World!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>sayâ•¨Â¥ello<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-ä½¿ç”¨utf-8-ç¼–ç è½¬æ¢å-â•¨Â¥-å˜ä¸ºç±»ä¼¼Hçš„å­—ç¬¦">3.2 ä½¿ç”¨<code>utf-8</code> ç¼–ç è½¬æ¢å <code>â•¨Â¥</code> å˜ä¸ºç±»ä¼¼<code>H</code>çš„å­—ç¬¦</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> sayĞello<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Goodbye, World!"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span>sayĞello<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ">å‚è€ƒ</h2><table><thead><tr><th>Abbreviation</th><th>Code Point</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>LRE</td><td>U+202A</td><td>Left-to-Right Embedding</td><td>å°è¯•å°†ä»¥ä¸‹æ–‡æœ¬è§†ä¸ºä»å·¦åˆ°å³</td></tr><tr><td>RLE</td><td>U+202B</td><td>Right-to-Left Embedding</td><td>å°è¯•å°†ä»¥ä¸‹æ–‡æœ¬è§†ä¸ºä»å³åˆ°å·¦</td></tr><tr><td>LRO</td><td>U+202D</td><td>Left-to-Right Override</td><td>å¼ºåˆ¶å°†ä»¥ä¸‹æ–‡æœ¬è§†ä¸ºä»å·¦åˆ°å³</td></tr><tr><td>RLO</td><td>U+202E</td><td>Right-to-Left Override</td><td>å¼ºåˆ¶å°†ä»¥ä¸‹æ–‡æœ¬è§†ä¸ºä»å³åˆ°å·¦</td></tr><tr><td>LRI</td><td>U+2066</td><td>Left-to-Right Isolate</td><td>å¼ºåˆ¶å°†åç»­æ–‡æœ¬è§†ä¸ºä»å·¦åˆ°å³ï¼Œè€Œä¸å½±å“ç›¸é‚»æ–‡æœ¬</td></tr><tr><td>RLI</td><td>U+2067</td><td>Right-to-Left Isolate</td><td>å¼ºåˆ¶å°†åç»­æ–‡æœ¬è§†ä¸ºä»å³åˆ°å·¦ï¼Œè€Œä¸å½±å“ç›¸é‚»æ–‡æœ¬</td></tr><tr><td>FSI</td><td>U+2068</td><td>First Strong Isolate</td><td>å¼ºåˆ¶æŒ‰ç…§ä¸‹ä¸€ä¸ªå­—ç¬¦æŒ‡ç¤ºçš„æ–¹å‘å¤„ç†åç»­æ–‡æœ¬</td></tr><tr><td>PDF</td><td>U+202C</td><td>Pop Directional Formatting</td><td>ç»ˆæ­¢æœ€è¿‘çš„ LRE.RLE.LRO æˆ– RLO</td></tr><tr><td>PDI</td><td>U+2069</td><td>Pop Directional Isolate</td><td>ç»ˆæ­¢æœ€è¿‘çš„ LRI æˆ– RLI</td></tr></tbody></table><p><a href="https://trojansource.codes/trojan-source.pdf">trojan-sourceè®ºæ–‡</a></p>]]></content>
      
      
      <categories>
          
          <category> ä¿¡æ¯å®‰å…¨ </category>
          
          <category> æ¼æ´åˆ†æ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cve </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€å¦‚ä½•ç™¾ç§‘ã€‘pip ç¦»çº¿å®‰è£…ç¬¬ä¸‰æ–¹åº“åŠä¾èµ–</title>
      <link href="/news/1677407864745.html"/>
      <url>/news/1677407864745.html</url>
      
        <content type="html"><![CDATA[<h2 id="1-å·²å®‰è£…çš„æ¨¡å—åç§°å¯¼å‡ºåˆ°æ–‡ä»¶">1. å·²å®‰è£…çš„æ¨¡å—åç§°å¯¼å‡ºåˆ°æ–‡ä»¶</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip freeze <span class="token operator">></span>requirements.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-åœ¨çº¿ä¸‹è½½ä¾èµ–">2. åœ¨çº¿ä¸‹è½½ä¾èµ–</h2><h3 id="2-1-ç›´æ¥ä¸‹è½½å¯¹åº”åŒ…">2.1 ç›´æ¥ä¸‹è½½å¯¹åº”åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip download <span class="token parameter variable">-d</span> D:<span class="token punctuation">\</span>python<span class="token punctuation">\</span>pip<span class="token punctuation">\</span>package mitmproxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-2-é€šè¿‡requirements-txtç›´æ¥ä¸‹è½½å¯¹åº”åŒ…">2.2 é€šè¿‡requirements.txtç›´æ¥ä¸‹è½½å¯¹åº”åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip download <span class="token parameter variable">-d</span> D:<span class="token punctuation">\</span>python<span class="token punctuation">\</span>pip<span class="token punctuation">\</span>package <span class="token parameter variable">-r</span> requirements.txt <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-å°†åœ¨çº¿ä¸‹è½½çš„åŒ…å¤åˆ¶åˆ°ç¦»çº¿ç”µè„‘ä¸Š">3. å°†åœ¨çº¿ä¸‹è½½çš„åŒ…å¤åˆ¶åˆ°ç¦»çº¿ç”µè„‘ä¸Š</h2><ul><li>æœ¬æ–‡ä¸­ä»åœ¨çº¿ç”µè„‘ä¸Šçš„è·¯å¾„<code>D:\python\pip\package</code> ä¸‹çš„åŒ…æ‹·è´åˆ°ç¦»çº¿ç”µè„‘çš„<code>E:\python\pip\package</code>è·¯å¾„ä¸‹</li></ul><h2 id="4-åœ¨ç¦»çº¿ç”µè„‘ä¸Šå®‰è£…å·²å¯¼å‡ºçš„æ¨¡å—ï¼ŒæŒ‡å®šæ¨¡å—åç§°æˆ–æŒ‡å®šåŒ…å«æ‰€æœ‰æ¨¡å—åˆ—è¡¨çš„æ–‡ä»¶">4. åœ¨ç¦»çº¿ç”µè„‘ä¸Šå®‰è£…å·²å¯¼å‡ºçš„æ¨¡å—ï¼ŒæŒ‡å®šæ¨¡å—åç§°æˆ–æŒ‡å®šåŒ…å«æ‰€æœ‰æ¨¡å—åˆ—è¡¨çš„æ–‡ä»¶</h2><h3 id="4-1-ç›´æ¥å®‰è£…å¯¹åº”åŒ…">4.1 ç›´æ¥å®‰è£…å¯¹åº”åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> --no-index --find-links<span class="token operator">=</span>E:<span class="token punctuation">\</span>python<span class="token punctuation">\</span>pip<span class="token punctuation">\</span>package <span class="token parameter variable">-r</span> requirements<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-2-é€šè¿‡requirements-txtç›´æ¥å®‰è£…å¯¹åº”åŒ…">4.2 é€šè¿‡<code>requirements.txt</code>ç›´æ¥å®‰è£…å¯¹åº”åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> --no-index --find-links<span class="token operator">=</span>E:<span class="token punctuation">\</span>python<span class="token punctuation">\</span>pip<span class="token punctuation">\</span>package mitmproxy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ä¸‡æ³•å¤©ä¹¦ </category>
          
          <category> å¦‚ä½•ç™¾ç§‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pip </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
